
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/plot_0_implementation.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_plot_0_implementation.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_plot_0_implementation.py:


PyLossless Algorithms
=====================

This tutorial explains the calculations that PyLossless performs at each step of the
pipeline. We will use example EEG data to demonstrate the
calculations.

.. note::
    You can open this notebook in
    `Google Colab <https://colab.research.google.com/drive/1ecyNo10oFgpbVNuD7Ztgr2fs8XkpfOYo?usp=sharing>`_!

.. _notation:

Notation 
--------
Before we begin, we define some notation that will be used throughout the text:

- We start with a 3D matrix of EEG data,
  :math:`X \in \mathbb{R}^{S_\mathcal{G} \times E_\mathcal{G} \times T}`,
  where :math:`S_\mathcal{G}` and :math:`E_\mathcal{G}` are the sets of good sensors and
  epochs, respectively, and :math:`T`, is the number of samples(i.e. time-points).

- ``s``, ``e``, and ``t`` are sensor, epochs, and samples, respectively.

- We use superscripts to denote operations across a dimension, and we use subscripts to
  denote indexing a dimension.

- We refer to a single sensor :math:`i` as
  :math:`X\big|_{s=i} \in \mathbb{R}^{E_\mathcal{G} \times T}`,
  with :math:`i \in S_\mathcal{G}`.

- We refer to a single epoch :math:`j` as
  :math:`X\big|_{e=j} \in \mathbb{R}^{S_\mathcal{G} \times T}`,
  with :math:`j \in E_\mathcal{G}`.

- We denote sensor-specific thresholds for rejecting epochs as
  :math:`\tau^e_i \in \mathbb{R}^{S_\mathcal{G}}`

- We denote epoch-specific thresholds for rejecting sensors as
  :math:`\tau^s_j \in \mathbb{R}^{E_\mathcal{G}}`

- We denote *quantiles* as :math:`Q\#^{dim}`: i.e. :math:`Q75^s` is the 75th *quantile*
  along the sensor dimension. The function :math:`Q75^s(X)` computes the 75th quantile
  along the :math:`s` dimension of matrix :math:`X`, resulting in a matrix noted
  :math:`X^{Q75^s} \in \mathbb{R}^{E \times T}`.

Throughout the text, we use capital letters for matrices and lowercase letters for
scalars. For example, the data point for sensor :math:`i`, epoch :math:`j`, and
time :math:`k` is denoted as :math:`X\big|_{s=i; e=j; t=k} = x_{ijk} \in \mathbb{R}`,
and :math:`X=\{x_{ijk}\}`.

.. GENERATED FROM PYTHON SOURCE LINES 56-58

Imports and data loading
------------------------

.. GENERATED FROM PYTHON SOURCE LINES 58-70

.. code-block:: default

    from pathlib import Path

    import numpy as np

    import mne
    from mne.datasets import sample

    import pylossless as ll

    # Load example mne data
    raw = ll.datasets.load_simulated_raw()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Opening raw data file /Users/shuberty/mne_data/MNE-sample-data/MEG/sample/sample_audvis_raw.fif...
        Read a total of 3 projection items:
            PCA-v1 (1 x 102)  idle
            PCA-v2 (1 x 102)  idle
            PCA-v3 (1 x 102)  idle
        Range : 25800 ... 192599 =     42.956 ...   320.670 secs
    Ready.
    EEG channel type selected for re-referencing
    Adding average EEG reference projection.
    1 projection items deactivated
    Reading forward solution from /Users/shuberty/mne_data/MNE-sample-data/MEG/sample/sample_audvis-meg-eeg-oct-6-fwd.fif...
        Reading a source space...
        Computing patch statistics...
        Patch information added...
        Distance information added...
        [done]
        Reading a source space...
        Computing patch statistics...
        Patch information added...
        Distance information added...
        [done]
        2 source spaces read
        Desired named matrix (kind = 3523) not available
        Read MEG forward solution (7498 sources, 306 channels, free orientations)
        Desired named matrix (kind = 3523) not available
        Read EEG forward solution (7498 sources, 60 channels, free orientations)
        Forward solutions combined: MEG, EEG
        Source spaces transformed to the forward solution coordinate frame
    Setting up raw simulation: 1 position, "cos2" interpolation
    Event information stored on channel:              STI 014
        Interval 0.000-2.000 sec
    Setting up forward solutions
    Computing gain matrix for transform #1/1
        Interval 0.000-2.000 sec
        Interval 0.000-2.000 sec
        Interval 0.000-2.000 sec
        Interval 0.000-2.000 sec
        Interval 0.000-2.000 sec
        Interval 0.000-2.000 sec
        Interval 0.000-2.000 sec
        Interval 0.000-2.000 sec
        Interval 0.000-2.000 sec
        10 STC iterations provided
    [done]
    Adding noise to 366/376 channels (366 channels in cov)
    Sphere                : origin at (0.0 0.0 0.0) mm
                  radius  : 0.1 mm
    Source location file  : dict()
    Assuming input in millimeters
    Assuming input in MRI coordinates

    Positions (in meters) and orientations
    1 sources
    ecg simulated and trace not stored
    Setting up forward solutions
    Computing gain matrix for transform #1/1
    Sphere                : origin at (0.0 0.0 0.0) mm
                  radius  : 0.1 mm
    Source location file  : dict()
    Assuming input in millimeters
    Assuming input in MRI coordinates

    Positions (in meters) and orientations
    2 sources
    blink simulated and trace stored on channel:      EOG 061
    Setting up forward solutions
    Computing gain matrix for transform #1/1
    Removing projector <Projection | PCA-v1, active : False, n_channels : 102>
    Removing projector <Projection | PCA-v2, active : False, n_channels : 102>
    Removing projector <Projection | PCA-v3, active : False, n_channels : 102>
    Adding noise to 60/60 channels (60 channels in cov)
    Adding noise to 2/2 channels (2 channels in cov)
    Creating RawArray with float64 data, n_channels=60, n_times=12010
        Range : 0 ... 12009 =      0.000 ...    19.995 secs
    Ready.




.. GENERATED FROM PYTHON SOURCE LINES 71-79

Load a PyLossless configuration file
------------------------------------
Let's load a PyLossless configuration file. This file contains the parameters that
will be used for each step of the pipeline. For example, the ``ch_ch_sd`` section
contains the parameters for the :ref:`noisy_sensors` step. We can modify these
parameters to change the behavior of the pipeline. For example, we can change the
percent of epochs that a sensor must be noisy for it to be flagged via the
``flag_crit`` parameter.

.. GENERATED FROM PYTHON SOURCE LINES 79-86

.. code-block:: default

    config = ll.config.Config()
    config.load_default()
    config["ch_ch_sd"]["outliers_kwargs"]["lower"] = 0.25  # lower quantile
    config["ch_ch_sd"]["outliers_kwargs"]["upper"] = 0.75  # upper quantile
    config["ch_ch_sd"]["flag_crit"] = 0.30  # percent of epochs that a sensor must be noisy
    config.save("test_config.yaml")








.. GENERATED FROM PYTHON SOURCE LINES 87-89

Create a pipeline instance
--------------------------

.. GENERATED FROM PYTHON SOURCE LINES 89-93

.. code-block:: default

    pipeline = ll.LosslessPipeline("test_config.yaml")
    pipeline.raw = raw
    raw.plot()




.. image-sg:: /auto_examples/images/sphx_glr_plot_0_implementation_001.png
   :alt: plot 0 implementation
   :srcset: /auto_examples/images/sphx_glr_plot_0_implementation_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <MNEBrowseFigure size 1440x844 with 4 Axes>



.. GENERATED FROM PYTHON SOURCE LINES 94-102

Input Data
----------

First, we epoch the data to be used for subsequent steps.
Let our 3D matrix below be defined as :math:`X \in \mathbb{R}^{S \times E \times T}`
where :math:`X` is a matrix of real numbers and of dimension :math:`S` sensors
:math:`\times$ E` epochs `\times T` times.


.. GENERATED FROM PYTHON SOURCE LINES 102-104

.. code-block:: default

    epochs = pipeline.get_epochs()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    üßπ Epoching..
    Not setting metadata
    19 matching events found
    No baseline correction applied
    0 projection items activated
    Using data from preloaded Raw for 19 events and 601 original time points ...
    0 bad epochs dropped
    üîç Detecting channels to leave out of reference.
    EEG channel type selected for re-referencing
    Applying a custom ('EEG',) reference.




.. GENERATED FROM PYTHON SOURCE LINES 105-106

Let's convert our epochs object into a named :class:`xarray.DataArray` object.

.. GENERATED FROM PYTHON SOURCE LINES 107-114

.. code-block:: default

    from pylossless.pipeline import epochs_to_xr

    #
    epochs_xr = epochs_to_xr(epochs, kind="ch")
    epochs_xr  # 277 epochs, 50 sensors, 602 samples per epoch







.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
    <defs>
    <symbol id="icon-database" viewBox="0 0 32 32">
    <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
    <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    </symbol>
    <symbol id="icon-file-text2" viewBox="0 0 32 32">
    <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
    <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    </symbol>
    </defs>
    </svg>
    <style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
     *
     */

    :root {
      --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
      --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
      --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
      --xr-border-color: var(--jp-border-color2, #e0e0e0);
      --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
      --xr-background-color: var(--jp-layout-color0, white);
      --xr-background-color-row-even: var(--jp-layout-color1, white);
      --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
    }

    html[theme=dark],
    body[data-theme=dark],
    body.vscode-dark {
      --xr-font-color0: rgba(255, 255, 255, 1);
      --xr-font-color2: rgba(255, 255, 255, 0.54);
      --xr-font-color3: rgba(255, 255, 255, 0.38);
      --xr-border-color: #1F1F1F;
      --xr-disabled-color: #515151;
      --xr-background-color: #111111;
      --xr-background-color-row-even: #111111;
      --xr-background-color-row-odd: #313131;
    }

    .xr-wrap {
      display: block !important;
      min-width: 300px;
      max-width: 700px;
    }

    .xr-text-repr-fallback {
      /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
      display: none;
    }

    .xr-header {
      padding-top: 6px;
      padding-bottom: 6px;
      margin-bottom: 4px;
      border-bottom: solid 1px var(--xr-border-color);
    }

    .xr-header > div,
    .xr-header > ul {
      display: inline;
      margin-top: 0;
      margin-bottom: 0;
    }

    .xr-obj-type,
    .xr-array-name {
      margin-left: 2px;
      margin-right: 10px;
    }

    .xr-obj-type {
      color: var(--xr-font-color2);
    }

    .xr-sections {
      padding-left: 0 !important;
      display: grid;
      grid-template-columns: 150px auto auto 1fr 20px 20px;
    }

    .xr-section-item {
      display: contents;
    }

    .xr-section-item input {
      display: none;
    }

    .xr-section-item input + label {
      color: var(--xr-disabled-color);
    }

    .xr-section-item input:enabled + label {
      cursor: pointer;
      color: var(--xr-font-color2);
    }

    .xr-section-item input:enabled + label:hover {
      color: var(--xr-font-color0);
    }

    .xr-section-summary {
      grid-column: 1;
      color: var(--xr-font-color2);
      font-weight: 500;
    }

    .xr-section-summary > span {
      display: inline-block;
      padding-left: 0.5em;
    }

    .xr-section-summary-in:disabled + label {
      color: var(--xr-font-color2);
    }

    .xr-section-summary-in + label:before {
      display: inline-block;
      content: '‚ñ∫';
      font-size: 11px;
      width: 15px;
      text-align: center;
    }

    .xr-section-summary-in:disabled + label:before {
      color: var(--xr-disabled-color);
    }

    .xr-section-summary-in:checked + label:before {
      content: '‚ñº';
    }

    .xr-section-summary-in:checked + label > span {
      display: none;
    }

    .xr-section-summary,
    .xr-section-inline-details {
      padding-top: 4px;
      padding-bottom: 4px;
    }

    .xr-section-inline-details {
      grid-column: 2 / -1;
    }

    .xr-section-details {
      display: none;
      grid-column: 1 / -1;
      margin-bottom: 5px;
    }

    .xr-section-summary-in:checked ~ .xr-section-details {
      display: contents;
    }

    .xr-array-wrap {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 20px auto;
    }

    .xr-array-wrap > label {
      grid-column: 1;
      vertical-align: top;
    }

    .xr-preview {
      color: var(--xr-font-color3);
    }

    .xr-array-preview,
    .xr-array-data {
      padding: 0 5px !important;
      grid-column: 2;
    }

    .xr-array-data,
    .xr-array-in:checked ~ .xr-array-preview {
      display: none;
    }

    .xr-array-in:checked ~ .xr-array-data,
    .xr-array-preview {
      display: inline-block;
    }

    .xr-dim-list {
      display: inline-block !important;
      list-style: none;
      padding: 0 !important;
      margin: 0;
    }

    .xr-dim-list li {
      display: inline-block;
      padding: 0;
      margin: 0;
    }

    .xr-dim-list:before {
      content: '(';
    }

    .xr-dim-list:after {
      content: ')';
    }

    .xr-dim-list li:not(:last-child):after {
      content: ',';
      padding-right: 5px;
    }

    .xr-has-index {
      font-weight: bold;
    }

    .xr-var-list,
    .xr-var-item {
      display: contents;
    }

    .xr-var-item > div,
    .xr-var-item label,
    .xr-var-item > .xr-var-name span {
      background-color: var(--xr-background-color-row-even);
      margin-bottom: 0;
    }

    .xr-var-item > .xr-var-name:hover span {
      padding-right: 5px;
    }

    .xr-var-list > li:nth-child(odd) > div,
    .xr-var-list > li:nth-child(odd) > label,
    .xr-var-list > li:nth-child(odd) > .xr-var-name span {
      background-color: var(--xr-background-color-row-odd);
    }

    .xr-var-name {
      grid-column: 1;
    }

    .xr-var-dims {
      grid-column: 2;
    }

    .xr-var-dtype {
      grid-column: 3;
      text-align: right;
      color: var(--xr-font-color2);
    }

    .xr-var-preview {
      grid-column: 4;
    }

    .xr-index-preview {
      grid-column: 2 / 5;
      color: var(--xr-font-color2);
    }

    .xr-var-name,
    .xr-var-dims,
    .xr-var-dtype,
    .xr-preview,
    .xr-attrs dt {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-right: 10px;
    }

    .xr-var-name:hover,
    .xr-var-dims:hover,
    .xr-var-dtype:hover,
    .xr-attrs dt:hover {
      overflow: visible;
      width: auto;
      z-index: 1;
    }

    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      display: none;
      background-color: var(--xr-background-color) !important;
      padding-bottom: 5px !important;
    }

    .xr-var-attrs-in:checked ~ .xr-var-attrs,
    .xr-var-data-in:checked ~ .xr-var-data,
    .xr-index-data-in:checked ~ .xr-index-data {
      display: block;
    }

    .xr-var-data > table {
      float: right;
    }

    .xr-var-name span,
    .xr-var-data,
    .xr-index-name div,
    .xr-index-data,
    .xr-attrs {
      padding-left: 25px !important;
    }

    .xr-attrs,
    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      grid-column: 1 / -1;
    }

    dl.xr-attrs {
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: 125px auto;
    }

    .xr-attrs dt,
    .xr-attrs dd {
      padding: 0;
      margin: 0;
      float: left;
      padding-right: 10px;
      width: auto;
    }

    .xr-attrs dt {
      font-weight: normal;
      grid-column: 1;
    }

    .xr-attrs dt:hover span {
      display: inline-block;
      background: var(--xr-background-color);
      padding-right: 10px;
    }

    .xr-attrs dd {
      grid-column: 2;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .xr-icon-database,
    .xr-icon-file-text2,
    .xr-no-icon {
      display: inline-block;
      vertical-align: middle;
      width: 1em;
      height: 1.5em !important;
      stroke-width: 0;
      stroke: currentColor;
      fill: currentColor;
    }
    </style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (epoch: 19, ch: 60, time: 601)&gt;
    array([[[ 4.00911294e-06, -5.48340332e-06, -9.45051006e-06, ...,
             -1.68465495e-05, -2.26908642e-05, -2.02120643e-05],
            [ 6.10364684e-07,  6.58435586e-06,  1.00785325e-05, ...,
              1.81913606e-05,  2.40055459e-05,  1.99677754e-05],
            [ 1.26818569e-06, -2.95193384e-07, -4.41352172e-07, ...,
              1.56890784e-06,  2.15977905e-06,  1.71080947e-06],
            ...,
            [ 3.72638323e-07,  1.13560839e-07,  2.47509171e-07, ...,
             -5.51297348e-07, -2.13128587e-06, -1.04236979e-06],
            [ 1.78497421e-06,  2.79244913e-06,  1.45528260e-06, ...,
              2.00865069e-06,  8.09983839e-07, -5.60638429e-08],
            [ 2.01912032e-07,  3.95276399e-08, -7.08214249e-07, ...,
             -2.95339832e-06, -1.63777564e-06, -8.78084556e-07]],

           [[-2.02120643e-05, -9.66939110e-06, -7.74228235e-06, ...,
             -1.16775814e-05, -1.16067905e-05, -8.99084494e-06],
            [ 1.99677754e-05,  8.82911943e-06,  8.47578250e-06, ...,
              1.21453976e-05,  1.24742321e-05,  9.21610450e-06],
            [ 1.71080947e-06,  6.72569456e-07, -7.72649014e-08, ...,
              1.58995907e-06,  6.32911426e-07,  6.06761363e-07],
    ...
            [-9.60709658e-07, -1.28999161e-06,  3.00890117e-07, ...,
             -3.07944477e-06, -3.87944675e-06, -3.07164432e-06],
            [ 2.99542658e-06,  3.81856384e-06,  2.25180827e-06, ...,
              2.25028835e-06,  3.97960625e-06,  3.06888837e-06],
            [ 3.26730622e-06,  3.03638703e-06,  3.14479428e-06, ...,
             -1.18302539e-06, -8.19082393e-07, -1.00741926e-06]],

           [[ 1.51464329e-06, -1.13187966e-05, -5.97721318e-06, ...,
              3.16045129e-06, -5.20592128e-06, -6.67064564e-06],
            [-3.88637437e-07,  1.27287380e-05,  7.57987111e-06, ...,
             -5.31920587e-06,  2.87437814e-06,  4.31647043e-06],
            [ 3.99580005e-07,  1.42109295e-06,  7.43543121e-07, ...,
              1.00033957e-06,  1.07452946e-07, -1.27252143e-07],
            ...,
            [-2.69173573e-07,  5.68914426e-07,  9.68916951e-07, ...,
             -1.33135540e-06, -9.73821050e-07,  3.20541817e-07],
            [ 3.13103511e-06,  2.46206247e-06,  2.77891339e-06, ...,
             -6.48987435e-08, -3.29346990e-07,  5.82048296e-08],
            [-1.16471733e-06, -9.73515952e-07, -1.14235541e-06, ...,
              1.96080434e-06,  6.97812552e-07,  7.65029587e-07]]])
    Coordinates:
      * epoch    (epoch) int64 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18
      * ch       (ch) &lt;U7 &#x27;EEG 001&#x27; &#x27;EEG 002&#x27; &#x27;EEG 003&#x27; ... &#x27;EEG 059&#x27; &#x27;EEG 060&#x27;
      * time     (time) float64 0.0 0.001665 0.00333 ... 0.9956 0.9973 0.999</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>epoch</span>: 19</li><li><span class='xr-has-index'>ch</span>: 60</li><li><span class='xr-has-index'>time</span>: 601</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-eac4ce86-9712-43fd-aff1-a423fe3fd139' class='xr-array-in' type='checkbox' checked><label for='section-eac4ce86-9712-43fd-aff1-a423fe3fd139' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>4.009e-06 -5.483e-06 -9.451e-06 ... 1.961e-06 6.978e-07 7.65e-07</span></div><div class='xr-array-data'><pre>array([[[ 4.00911294e-06, -5.48340332e-06, -9.45051006e-06, ...,
             -1.68465495e-05, -2.26908642e-05, -2.02120643e-05],
            [ 6.10364684e-07,  6.58435586e-06,  1.00785325e-05, ...,
              1.81913606e-05,  2.40055459e-05,  1.99677754e-05],
            [ 1.26818569e-06, -2.95193384e-07, -4.41352172e-07, ...,
              1.56890784e-06,  2.15977905e-06,  1.71080947e-06],
            ...,
            [ 3.72638323e-07,  1.13560839e-07,  2.47509171e-07, ...,
             -5.51297348e-07, -2.13128587e-06, -1.04236979e-06],
            [ 1.78497421e-06,  2.79244913e-06,  1.45528260e-06, ...,
              2.00865069e-06,  8.09983839e-07, -5.60638429e-08],
            [ 2.01912032e-07,  3.95276399e-08, -7.08214249e-07, ...,
             -2.95339832e-06, -1.63777564e-06, -8.78084556e-07]],

           [[-2.02120643e-05, -9.66939110e-06, -7.74228235e-06, ...,
             -1.16775814e-05, -1.16067905e-05, -8.99084494e-06],
            [ 1.99677754e-05,  8.82911943e-06,  8.47578250e-06, ...,
              1.21453976e-05,  1.24742321e-05,  9.21610450e-06],
            [ 1.71080947e-06,  6.72569456e-07, -7.72649014e-08, ...,
              1.58995907e-06,  6.32911426e-07,  6.06761363e-07],
    ...
            [-9.60709658e-07, -1.28999161e-06,  3.00890117e-07, ...,
             -3.07944477e-06, -3.87944675e-06, -3.07164432e-06],
            [ 2.99542658e-06,  3.81856384e-06,  2.25180827e-06, ...,
              2.25028835e-06,  3.97960625e-06,  3.06888837e-06],
            [ 3.26730622e-06,  3.03638703e-06,  3.14479428e-06, ...,
             -1.18302539e-06, -8.19082393e-07, -1.00741926e-06]],

           [[ 1.51464329e-06, -1.13187966e-05, -5.97721318e-06, ...,
              3.16045129e-06, -5.20592128e-06, -6.67064564e-06],
            [-3.88637437e-07,  1.27287380e-05,  7.57987111e-06, ...,
             -5.31920587e-06,  2.87437814e-06,  4.31647043e-06],
            [ 3.99580005e-07,  1.42109295e-06,  7.43543121e-07, ...,
              1.00033957e-06,  1.07452946e-07, -1.27252143e-07],
            ...,
            [-2.69173573e-07,  5.68914426e-07,  9.68916951e-07, ...,
             -1.33135540e-06, -9.73821050e-07,  3.20541817e-07],
            [ 3.13103511e-06,  2.46206247e-06,  2.77891339e-06, ...,
             -6.48987435e-08, -3.29346990e-07,  5.82048296e-08],
            [-1.16471733e-06, -9.73515952e-07, -1.14235541e-06, ...,
              1.96080434e-06,  6.97812552e-07,  7.65029587e-07]]])</pre></div></div></li><li class='xr-section-item'><input id='section-2fffe4a8-befc-450b-a38a-75a7afc1bdb7' class='xr-section-summary-in' type='checkbox'  checked><label for='section-2fffe4a8-befc-450b-a38a-75a7afc1bdb7' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>epoch</span></div><div class='xr-var-dims'>(epoch)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5 6 ... 13 14 15 16 17 18</div><input id='attrs-1bbdcad0-0bc3-4c62-a66b-8ed82c1c6a89' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-1bbdcad0-0bc3-4c62-a66b-8ed82c1c6a89' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-66421539-c55d-4a59-b58f-48ba5bc6ca56' class='xr-var-data-in' type='checkbox'><label for='data-66421539-c55d-4a59-b58f-48ba5bc6ca56' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17,
           18])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>ch</span></div><div class='xr-var-dims'>(ch)</div><div class='xr-var-dtype'>&lt;U7</div><div class='xr-var-preview xr-preview'>&#x27;EEG 001&#x27; &#x27;EEG 002&#x27; ... &#x27;EEG 060&#x27;</div><input id='attrs-9e13b097-da20-4896-b20f-30bc65bf6e1d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-9e13b097-da20-4896-b20f-30bc65bf6e1d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c3eb2f53-3b47-4230-93f0-3676e8cf9448' class='xr-var-data-in' type='checkbox'><label for='data-c3eb2f53-3b47-4230-93f0-3676e8cf9448' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;EEG 001&#x27;, &#x27;EEG 002&#x27;, &#x27;EEG 003&#x27;, &#x27;EEG 004&#x27;, &#x27;EEG 005&#x27;, &#x27;EEG 006&#x27;,
           &#x27;EEG 007&#x27;, &#x27;EEG 008&#x27;, &#x27;EEG 009&#x27;, &#x27;EEG 010&#x27;, &#x27;EEG 011&#x27;, &#x27;EEG 012&#x27;,
           &#x27;EEG 013&#x27;, &#x27;EEG 014&#x27;, &#x27;EEG 015&#x27;, &#x27;EEG 016&#x27;, &#x27;EEG 017&#x27;, &#x27;EEG 018&#x27;,
           &#x27;EEG 019&#x27;, &#x27;EEG 020&#x27;, &#x27;EEG 021&#x27;, &#x27;EEG 022&#x27;, &#x27;EEG 023&#x27;, &#x27;EEG 024&#x27;,
           &#x27;EEG 025&#x27;, &#x27;EEG 026&#x27;, &#x27;EEG 027&#x27;, &#x27;EEG 028&#x27;, &#x27;EEG 029&#x27;, &#x27;EEG 030&#x27;,
           &#x27;EEG 031&#x27;, &#x27;EEG 032&#x27;, &#x27;EEG 033&#x27;, &#x27;EEG 034&#x27;, &#x27;EEG 035&#x27;, &#x27;EEG 036&#x27;,
           &#x27;EEG 037&#x27;, &#x27;EEG 038&#x27;, &#x27;EEG 039&#x27;, &#x27;EEG 040&#x27;, &#x27;EEG 041&#x27;, &#x27;EEG 042&#x27;,
           &#x27;EEG 043&#x27;, &#x27;EEG 044&#x27;, &#x27;EEG 045&#x27;, &#x27;EEG 046&#x27;, &#x27;EEG 047&#x27;, &#x27;EEG 048&#x27;,
           &#x27;EEG 049&#x27;, &#x27;EEG 050&#x27;, &#x27;EEG 051&#x27;, &#x27;EEG 052&#x27;, &#x27;EEG 053&#x27;, &#x27;EEG 054&#x27;,
           &#x27;EEG 055&#x27;, &#x27;EEG 056&#x27;, &#x27;EEG 057&#x27;, &#x27;EEG 058&#x27;, &#x27;EEG 059&#x27;, &#x27;EEG 060&#x27;],
          dtype=&#x27;&lt;U7&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.0 0.001665 ... 0.9973 0.999</div><input id='attrs-452a260f-8e52-4c8c-8259-093f8ead0c19' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-452a260f-8e52-4c8c-8259-093f8ead0c19' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4f39ae68-484b-4638-9e44-8038eb5e874e' class='xr-var-data-in' type='checkbox'><label for='data-4f39ae68-484b-4638-9e44-8038eb5e874e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0.      , 0.001665, 0.00333 , ..., 0.995646, 0.997311, 0.998976])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-f757f880-f790-4d9e-93be-0d23e855d779' class='xr-section-summary-in' type='checkbox'  ><label for='section-f757f880-f790-4d9e-93be-0d23e855d779' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>epoch</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-8ffc28b8-34aa-4fb7-9ba5-f7c5b9a53f4b' class='xr-index-data-in' type='checkbox'/><label for='index-8ffc28b8-34aa-4fb7-9ba5-f7c5b9a53f4b' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18], dtype=&#x27;int64&#x27;, name=&#x27;epoch&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>ch</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-72629353-cc72-457b-ad8e-77620aac5c4c' class='xr-index-data-in' type='checkbox'/><label for='index-72629353-cc72-457b-ad8e-77620aac5c4c' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;EEG 001&#x27;, &#x27;EEG 002&#x27;, &#x27;EEG 003&#x27;, &#x27;EEG 004&#x27;, &#x27;EEG 005&#x27;, &#x27;EEG 006&#x27;,
           &#x27;EEG 007&#x27;, &#x27;EEG 008&#x27;, &#x27;EEG 009&#x27;, &#x27;EEG 010&#x27;, &#x27;EEG 011&#x27;, &#x27;EEG 012&#x27;,
           &#x27;EEG 013&#x27;, &#x27;EEG 014&#x27;, &#x27;EEG 015&#x27;, &#x27;EEG 016&#x27;, &#x27;EEG 017&#x27;, &#x27;EEG 018&#x27;,
           &#x27;EEG 019&#x27;, &#x27;EEG 020&#x27;, &#x27;EEG 021&#x27;, &#x27;EEG 022&#x27;, &#x27;EEG 023&#x27;, &#x27;EEG 024&#x27;,
           &#x27;EEG 025&#x27;, &#x27;EEG 026&#x27;, &#x27;EEG 027&#x27;, &#x27;EEG 028&#x27;, &#x27;EEG 029&#x27;, &#x27;EEG 030&#x27;,
           &#x27;EEG 031&#x27;, &#x27;EEG 032&#x27;, &#x27;EEG 033&#x27;, &#x27;EEG 034&#x27;, &#x27;EEG 035&#x27;, &#x27;EEG 036&#x27;,
           &#x27;EEG 037&#x27;, &#x27;EEG 038&#x27;, &#x27;EEG 039&#x27;, &#x27;EEG 040&#x27;, &#x27;EEG 041&#x27;, &#x27;EEG 042&#x27;,
           &#x27;EEG 043&#x27;, &#x27;EEG 044&#x27;, &#x27;EEG 045&#x27;, &#x27;EEG 046&#x27;, &#x27;EEG 047&#x27;, &#x27;EEG 048&#x27;,
           &#x27;EEG 049&#x27;, &#x27;EEG 050&#x27;, &#x27;EEG 051&#x27;, &#x27;EEG 052&#x27;, &#x27;EEG 053&#x27;, &#x27;EEG 054&#x27;,
           &#x27;EEG 055&#x27;, &#x27;EEG 056&#x27;, &#x27;EEG 057&#x27;, &#x27;EEG 058&#x27;, &#x27;EEG 059&#x27;, &#x27;EEG 060&#x27;],
          dtype=&#x27;object&#x27;, name=&#x27;ch&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-a6629c4b-838e-4099-9574-a9846a6e843a' class='xr-index-data-in' type='checkbox'/><label for='index-a6629c4b-838e-4099-9574-a9846a6e843a' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([                  0.0, 0.0016649601096532323, 0.0033299202193064646,
           0.0049948803289596964,  0.006659840438612929,  0.008324800548266162,
            0.009989760657919393,  0.011654720767572626,  0.013319680877225858,
             0.01498464098687909,
           ...
              0.9839914248050602,    0.9856563849147135,    0.9873213450243667,
                0.98898630513402,    0.9906512652436732,    0.9923162253533264,
              0.9939811854629796,    0.9956461455726329,    0.9973111056822861,
              0.9989760657919393],
          dtype=&#x27;float64&#x27;, name=&#x27;time&#x27;, length=601))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-729c5d8d-64e3-4f79-8aad-d4ac0939c884' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-729c5d8d-64e3-4f79-8aad-d4ac0939c884' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 115-135

.. _robust_reference:

Robust Average Reference
------------------------

.. figure:: https://raw.githubusercontent.com/scott-huberty/wip_pipeline-figures/main/robust_rereference.png
   :align: center
   :alt: Robust Average Reference graphic.

   Robust Average Reference. The figure shows the steps for robust average referencing.
   See the text below for descriptions of mathematical notation.

Before the pipeline can begin, we must average reference the data. This is because
the pipeline uses data distributions to identify noisy sensors, and For EEG data that
uses an online reference to a single electrode, sensors that are further from the
reference will have a higher voltage variance, and the pipeline will be biased to
flag these sensors as noisy. The average reference, which subtracts the average
signal across sensors from each individual sensor, will ensure an even playing field.
Howeer, we dont want to include noisy sensors in the average reference signal. So we
will identify noisy sensors and and leave them out of the average reference signal.

.. GENERATED FROM PYTHON SOURCE LINES 137-154

.. code-block:: default

    sample_std = epochs_xr.std("time")
    q25_ch = sample_std.quantile(0.25, dim="ch")
    q50_ch = sample_std.median(dim="ch")
    q75_ch = sample_std.quantile(0.75, dim="ch")
    ch_dist = sample_std - q50_ch  # center the data
    ch_dist /= q75_ch - q25_ch  # shape (chans, epoch)

    mean_ch_dist = ch_dist.mean(dim="epoch")  # shape (chans)

    # find the median and 25 and 75 percentiles
    # of the mean of the channel distributions
    mdn = np.median(mean_ch_dist)
    deviation = np.diff(np.quantile(mean_ch_dist, [0.25, 0.75]))

    leave_out = mean_ch_dist.ch[mean_ch_dist > mdn + 6 * deviation].values.tolist()
    leave_out





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    ['EEG 001', 'EEG 002', 'EEG 007']



.. GENERATED FROM PYTHON SOURCE LINES 155-158

.. code-block:: default

    ref_chans = [ch for ch in epochs.pick("eeg").ch_names if ch not in leave_out]
    pipeline.raw.set_eeg_reference(ref_channels=ref_chans)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    EEG channel type selected for re-referencing
    Applying a custom ('EEG',) reference.


.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <table class="table table-hover table-striped table-sm table-responsive small">
        <tr>
            <th>Measurement date</th>
        
            <td>Unknown</td>
        
        </tr>
        <tr>
            <th>Experimenter</th>
        
            <td>Unknown</td>
        
        </tr>
            <th>Participant</th>
        
            <td>Unknown</td>
        
        </tr>
        <tr>
            <th>Digitized points</th>
        
            <td>145 points</td>
        
        </tr>
        <tr>
            <th>Good channels</th>
            <td>60 EEG</td>
        </tr>
        <tr>
            <th>Bad channels</th>
            <td>None</td>
        </tr>
        <tr>
            <th>EOG channels</th>
            <td>Not available</td>
        </tr>
        <tr>
            <th>ECG channels</th>
            <td>Not available</td>
    
        <tr>
            <th>Sampling frequency</th>
            <td>600.61 Hz</td>
        </tr>
    
    
        <tr>
            <th>Highpass</th>
            <td>0.00 Hz</td>
        </tr>
    
    
        <tr>
            <th>Lowpass</th>
            <td>300.31 Hz</td>
        </tr>
    
    
    
        <tr>
            <th>Duration</th>
            <td>00:00:20 (HH:MM:SS)</td>
        </tr>
    </table>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 159-170

.. _noisy_sensors:

Flag Noisy Sensors
------------------
.. figure:: https://raw.githubusercontent.com/scott-huberty/wip_pipeline-figures/main/Flag_noisy_sensors.png
   :align: center
   :alt: Flag Noisy Sensors graphic.

   Flag Noisy Sensors. The figure shows the steps for flagging noisy sensors. See the text below
   for descriptions of mathematical notation.


.. GENERATED FROM PYTHON SOURCE LINES 173-175

Since we applied a robust average reference to the raw data, we will need to re-epoch
the data:

.. GENERATED FROM PYTHON SOURCE LINES 175-184

.. code-block:: default

    epochs = pipeline.get_epochs()
    epochs_xr = epochs_to_xr(epochs, kind="ch")

    # First we take standard deviation of
    # :math:`X \in \mathbb{R}^{S \times E \times T}` across the samples dimension :math:`t`
    # resulting in a 2D matrix :math:`X^{\sigma_{t}} \in \mathbb{R}^{S \times E}`
    trim_ch_sd = epochs_xr.std("time")
    trim_ch_sd





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    üßπ Epoching..
    Not setting metadata
    19 matching events found
    No baseline correction applied
    0 projection items activated
    Using data from preloaded Raw for 19 events and 601 original time points ...
    0 bad epochs dropped
    üîç Detecting channels to leave out of reference.
    EEG channel type selected for re-referencing
    Applying a custom ('EEG',) reference.


.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
    <defs>
    <symbol id="icon-database" viewBox="0 0 32 32">
    <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
    <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    </symbol>
    <symbol id="icon-file-text2" viewBox="0 0 32 32">
    <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
    <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    </symbol>
    </defs>
    </svg>
    <style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
     *
     */

    :root {
      --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
      --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
      --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
      --xr-border-color: var(--jp-border-color2, #e0e0e0);
      --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
      --xr-background-color: var(--jp-layout-color0, white);
      --xr-background-color-row-even: var(--jp-layout-color1, white);
      --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
    }

    html[theme=dark],
    body[data-theme=dark],
    body.vscode-dark {
      --xr-font-color0: rgba(255, 255, 255, 1);
      --xr-font-color2: rgba(255, 255, 255, 0.54);
      --xr-font-color3: rgba(255, 255, 255, 0.38);
      --xr-border-color: #1F1F1F;
      --xr-disabled-color: #515151;
      --xr-background-color: #111111;
      --xr-background-color-row-even: #111111;
      --xr-background-color-row-odd: #313131;
    }

    .xr-wrap {
      display: block !important;
      min-width: 300px;
      max-width: 700px;
    }

    .xr-text-repr-fallback {
      /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
      display: none;
    }

    .xr-header {
      padding-top: 6px;
      padding-bottom: 6px;
      margin-bottom: 4px;
      border-bottom: solid 1px var(--xr-border-color);
    }

    .xr-header > div,
    .xr-header > ul {
      display: inline;
      margin-top: 0;
      margin-bottom: 0;
    }

    .xr-obj-type,
    .xr-array-name {
      margin-left: 2px;
      margin-right: 10px;
    }

    .xr-obj-type {
      color: var(--xr-font-color2);
    }

    .xr-sections {
      padding-left: 0 !important;
      display: grid;
      grid-template-columns: 150px auto auto 1fr 20px 20px;
    }

    .xr-section-item {
      display: contents;
    }

    .xr-section-item input {
      display: none;
    }

    .xr-section-item input + label {
      color: var(--xr-disabled-color);
    }

    .xr-section-item input:enabled + label {
      cursor: pointer;
      color: var(--xr-font-color2);
    }

    .xr-section-item input:enabled + label:hover {
      color: var(--xr-font-color0);
    }

    .xr-section-summary {
      grid-column: 1;
      color: var(--xr-font-color2);
      font-weight: 500;
    }

    .xr-section-summary > span {
      display: inline-block;
      padding-left: 0.5em;
    }

    .xr-section-summary-in:disabled + label {
      color: var(--xr-font-color2);
    }

    .xr-section-summary-in + label:before {
      display: inline-block;
      content: '‚ñ∫';
      font-size: 11px;
      width: 15px;
      text-align: center;
    }

    .xr-section-summary-in:disabled + label:before {
      color: var(--xr-disabled-color);
    }

    .xr-section-summary-in:checked + label:before {
      content: '‚ñº';
    }

    .xr-section-summary-in:checked + label > span {
      display: none;
    }

    .xr-section-summary,
    .xr-section-inline-details {
      padding-top: 4px;
      padding-bottom: 4px;
    }

    .xr-section-inline-details {
      grid-column: 2 / -1;
    }

    .xr-section-details {
      display: none;
      grid-column: 1 / -1;
      margin-bottom: 5px;
    }

    .xr-section-summary-in:checked ~ .xr-section-details {
      display: contents;
    }

    .xr-array-wrap {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 20px auto;
    }

    .xr-array-wrap > label {
      grid-column: 1;
      vertical-align: top;
    }

    .xr-preview {
      color: var(--xr-font-color3);
    }

    .xr-array-preview,
    .xr-array-data {
      padding: 0 5px !important;
      grid-column: 2;
    }

    .xr-array-data,
    .xr-array-in:checked ~ .xr-array-preview {
      display: none;
    }

    .xr-array-in:checked ~ .xr-array-data,
    .xr-array-preview {
      display: inline-block;
    }

    .xr-dim-list {
      display: inline-block !important;
      list-style: none;
      padding: 0 !important;
      margin: 0;
    }

    .xr-dim-list li {
      display: inline-block;
      padding: 0;
      margin: 0;
    }

    .xr-dim-list:before {
      content: '(';
    }

    .xr-dim-list:after {
      content: ')';
    }

    .xr-dim-list li:not(:last-child):after {
      content: ',';
      padding-right: 5px;
    }

    .xr-has-index {
      font-weight: bold;
    }

    .xr-var-list,
    .xr-var-item {
      display: contents;
    }

    .xr-var-item > div,
    .xr-var-item label,
    .xr-var-item > .xr-var-name span {
      background-color: var(--xr-background-color-row-even);
      margin-bottom: 0;
    }

    .xr-var-item > .xr-var-name:hover span {
      padding-right: 5px;
    }

    .xr-var-list > li:nth-child(odd) > div,
    .xr-var-list > li:nth-child(odd) > label,
    .xr-var-list > li:nth-child(odd) > .xr-var-name span {
      background-color: var(--xr-background-color-row-odd);
    }

    .xr-var-name {
      grid-column: 1;
    }

    .xr-var-dims {
      grid-column: 2;
    }

    .xr-var-dtype {
      grid-column: 3;
      text-align: right;
      color: var(--xr-font-color2);
    }

    .xr-var-preview {
      grid-column: 4;
    }

    .xr-index-preview {
      grid-column: 2 / 5;
      color: var(--xr-font-color2);
    }

    .xr-var-name,
    .xr-var-dims,
    .xr-var-dtype,
    .xr-preview,
    .xr-attrs dt {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-right: 10px;
    }

    .xr-var-name:hover,
    .xr-var-dims:hover,
    .xr-var-dtype:hover,
    .xr-attrs dt:hover {
      overflow: visible;
      width: auto;
      z-index: 1;
    }

    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      display: none;
      background-color: var(--xr-background-color) !important;
      padding-bottom: 5px !important;
    }

    .xr-var-attrs-in:checked ~ .xr-var-attrs,
    .xr-var-data-in:checked ~ .xr-var-data,
    .xr-index-data-in:checked ~ .xr-index-data {
      display: block;
    }

    .xr-var-data > table {
      float: right;
    }

    .xr-var-name span,
    .xr-var-data,
    .xr-index-name div,
    .xr-index-data,
    .xr-attrs {
      padding-left: 25px !important;
    }

    .xr-attrs,
    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      grid-column: 1 / -1;
    }

    dl.xr-attrs {
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: 125px auto;
    }

    .xr-attrs dt,
    .xr-attrs dd {
      padding: 0;
      margin: 0;
      float: left;
      padding-right: 10px;
      width: auto;
    }

    .xr-attrs dt {
      font-weight: normal;
      grid-column: 1;
    }

    .xr-attrs dt:hover span {
      display: inline-block;
      background: var(--xr-background-color);
      padding-right: 10px;
    }

    .xr-attrs dd {
      grid-column: 2;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .xr-icon-database,
    .xr-icon-file-text2,
    .xr-no-icon {
      display: inline-block;
      vertical-align: middle;
      width: 1em;
      height: 1.5em !important;
      stroke-width: 0;
      stroke: currentColor;
      fill: currentColor;
    }
    </style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (epoch: 19, ch: 60)&gt;
    array([[1.35597731e-05, 1.31233129e-05, 2.17448808e-06, ...,
            2.07993971e-06, 2.09577463e-06, 2.27223549e-06],
           [1.35394729e-05, 1.37257656e-05, 1.64089851e-06, ...,
            1.76830287e-06, 1.65367856e-06, 2.05796040e-06],
           [2.74948447e-05, 2.16517832e-05, 1.91004306e-05, ...,
            1.99198567e-05, 1.77970269e-05, 1.75321191e-05],
           ...,
           [1.25750225e-05, 1.26298395e-05, 2.36381227e-06, ...,
            2.08182038e-06, 2.19127750e-06, 2.05935719e-06],
           [1.20437007e-05, 1.21352730e-05, 1.87728424e-06, ...,
            2.19306677e-06, 1.73715072e-06, 1.71135942e-06],
           [1.92649383e-05, 1.36625648e-05, 6.17138490e-06, ...,
            2.76631344e-06, 2.83171087e-06, 3.15860482e-06]])
    Coordinates:
      * epoch    (epoch) int64 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18
      * ch       (ch) &lt;U7 &#x27;EEG 001&#x27; &#x27;EEG 002&#x27; &#x27;EEG 003&#x27; ... &#x27;EEG 059&#x27; &#x27;EEG 060&#x27;</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>epoch</span>: 19</li><li><span class='xr-has-index'>ch</span>: 60</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-20c248e0-3e99-4215-a000-6c49af0be782' class='xr-array-in' type='checkbox' checked><label for='section-20c248e0-3e99-4215-a000-6c49af0be782' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>1.356e-05 1.312e-05 2.174e-06 ... 2.766e-06 2.832e-06 3.159e-06</span></div><div class='xr-array-data'><pre>array([[1.35597731e-05, 1.31233129e-05, 2.17448808e-06, ...,
            2.07993971e-06, 2.09577463e-06, 2.27223549e-06],
           [1.35394729e-05, 1.37257656e-05, 1.64089851e-06, ...,
            1.76830287e-06, 1.65367856e-06, 2.05796040e-06],
           [2.74948447e-05, 2.16517832e-05, 1.91004306e-05, ...,
            1.99198567e-05, 1.77970269e-05, 1.75321191e-05],
           ...,
           [1.25750225e-05, 1.26298395e-05, 2.36381227e-06, ...,
            2.08182038e-06, 2.19127750e-06, 2.05935719e-06],
           [1.20437007e-05, 1.21352730e-05, 1.87728424e-06, ...,
            2.19306677e-06, 1.73715072e-06, 1.71135942e-06],
           [1.92649383e-05, 1.36625648e-05, 6.17138490e-06, ...,
            2.76631344e-06, 2.83171087e-06, 3.15860482e-06]])</pre></div></div></li><li class='xr-section-item'><input id='section-2f04af43-2142-4b0c-b902-fdcc27a29223' class='xr-section-summary-in' type='checkbox'  checked><label for='section-2f04af43-2142-4b0c-b902-fdcc27a29223' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>epoch</span></div><div class='xr-var-dims'>(epoch)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5 6 ... 13 14 15 16 17 18</div><input id='attrs-ef60dab9-8d65-4c2a-9274-d467fa478846' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ef60dab9-8d65-4c2a-9274-d467fa478846' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1b152dfe-9bbb-4622-861d-28844b128227' class='xr-var-data-in' type='checkbox'><label for='data-1b152dfe-9bbb-4622-861d-28844b128227' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17,
           18])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>ch</span></div><div class='xr-var-dims'>(ch)</div><div class='xr-var-dtype'>&lt;U7</div><div class='xr-var-preview xr-preview'>&#x27;EEG 001&#x27; &#x27;EEG 002&#x27; ... &#x27;EEG 060&#x27;</div><input id='attrs-ce2d471e-d96e-40c9-b3f4-b0e22bdcbe95' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ce2d471e-d96e-40c9-b3f4-b0e22bdcbe95' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-dec26335-3810-46a4-aa99-16aa3de9c3e4' class='xr-var-data-in' type='checkbox'><label for='data-dec26335-3810-46a4-aa99-16aa3de9c3e4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;EEG 001&#x27;, &#x27;EEG 002&#x27;, &#x27;EEG 003&#x27;, &#x27;EEG 004&#x27;, &#x27;EEG 005&#x27;, &#x27;EEG 006&#x27;,
           &#x27;EEG 007&#x27;, &#x27;EEG 008&#x27;, &#x27;EEG 009&#x27;, &#x27;EEG 010&#x27;, &#x27;EEG 011&#x27;, &#x27;EEG 012&#x27;,
           &#x27;EEG 013&#x27;, &#x27;EEG 014&#x27;, &#x27;EEG 015&#x27;, &#x27;EEG 016&#x27;, &#x27;EEG 017&#x27;, &#x27;EEG 018&#x27;,
           &#x27;EEG 019&#x27;, &#x27;EEG 020&#x27;, &#x27;EEG 021&#x27;, &#x27;EEG 022&#x27;, &#x27;EEG 023&#x27;, &#x27;EEG 024&#x27;,
           &#x27;EEG 025&#x27;, &#x27;EEG 026&#x27;, &#x27;EEG 027&#x27;, &#x27;EEG 028&#x27;, &#x27;EEG 029&#x27;, &#x27;EEG 030&#x27;,
           &#x27;EEG 031&#x27;, &#x27;EEG 032&#x27;, &#x27;EEG 033&#x27;, &#x27;EEG 034&#x27;, &#x27;EEG 035&#x27;, &#x27;EEG 036&#x27;,
           &#x27;EEG 037&#x27;, &#x27;EEG 038&#x27;, &#x27;EEG 039&#x27;, &#x27;EEG 040&#x27;, &#x27;EEG 041&#x27;, &#x27;EEG 042&#x27;,
           &#x27;EEG 043&#x27;, &#x27;EEG 044&#x27;, &#x27;EEG 045&#x27;, &#x27;EEG 046&#x27;, &#x27;EEG 047&#x27;, &#x27;EEG 048&#x27;,
           &#x27;EEG 049&#x27;, &#x27;EEG 050&#x27;, &#x27;EEG 051&#x27;, &#x27;EEG 052&#x27;, &#x27;EEG 053&#x27;, &#x27;EEG 054&#x27;,
           &#x27;EEG 055&#x27;, &#x27;EEG 056&#x27;, &#x27;EEG 057&#x27;, &#x27;EEG 058&#x27;, &#x27;EEG 059&#x27;, &#x27;EEG 060&#x27;],
          dtype=&#x27;&lt;U7&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-41d52ed9-33e0-4e26-aa39-5731e6ebd28a' class='xr-section-summary-in' type='checkbox'  ><label for='section-41d52ed9-33e0-4e26-aa39-5731e6ebd28a' class='xr-section-summary' >Indexes: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>epoch</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-f1b59ec4-bf62-4272-a3f3-039381f8f11b' class='xr-index-data-in' type='checkbox'/><label for='index-f1b59ec4-bf62-4272-a3f3-039381f8f11b' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18], dtype=&#x27;int64&#x27;, name=&#x27;epoch&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>ch</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-31048c83-afb8-4cd2-af11-c1f3aa593d6b' class='xr-index-data-in' type='checkbox'/><label for='index-31048c83-afb8-4cd2-af11-c1f3aa593d6b' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;EEG 001&#x27;, &#x27;EEG 002&#x27;, &#x27;EEG 003&#x27;, &#x27;EEG 004&#x27;, &#x27;EEG 005&#x27;, &#x27;EEG 006&#x27;,
           &#x27;EEG 007&#x27;, &#x27;EEG 008&#x27;, &#x27;EEG 009&#x27;, &#x27;EEG 010&#x27;, &#x27;EEG 011&#x27;, &#x27;EEG 012&#x27;,
           &#x27;EEG 013&#x27;, &#x27;EEG 014&#x27;, &#x27;EEG 015&#x27;, &#x27;EEG 016&#x27;, &#x27;EEG 017&#x27;, &#x27;EEG 018&#x27;,
           &#x27;EEG 019&#x27;, &#x27;EEG 020&#x27;, &#x27;EEG 021&#x27;, &#x27;EEG 022&#x27;, &#x27;EEG 023&#x27;, &#x27;EEG 024&#x27;,
           &#x27;EEG 025&#x27;, &#x27;EEG 026&#x27;, &#x27;EEG 027&#x27;, &#x27;EEG 028&#x27;, &#x27;EEG 029&#x27;, &#x27;EEG 030&#x27;,
           &#x27;EEG 031&#x27;, &#x27;EEG 032&#x27;, &#x27;EEG 033&#x27;, &#x27;EEG 034&#x27;, &#x27;EEG 035&#x27;, &#x27;EEG 036&#x27;,
           &#x27;EEG 037&#x27;, &#x27;EEG 038&#x27;, &#x27;EEG 039&#x27;, &#x27;EEG 040&#x27;, &#x27;EEG 041&#x27;, &#x27;EEG 042&#x27;,
           &#x27;EEG 043&#x27;, &#x27;EEG 044&#x27;, &#x27;EEG 045&#x27;, &#x27;EEG 046&#x27;, &#x27;EEG 047&#x27;, &#x27;EEG 048&#x27;,
           &#x27;EEG 049&#x27;, &#x27;EEG 050&#x27;, &#x27;EEG 051&#x27;, &#x27;EEG 052&#x27;, &#x27;EEG 053&#x27;, &#x27;EEG 054&#x27;,
           &#x27;EEG 055&#x27;, &#x27;EEG 056&#x27;, &#x27;EEG 057&#x27;, &#x27;EEG 058&#x27;, &#x27;EEG 059&#x27;, &#x27;EEG 060&#x27;],
          dtype=&#x27;object&#x27;, name=&#x27;ch&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-f98994d2-f139-4d43-a4cb-f82a7936329f' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-f98994d2-f139-4d43-a4cb-f82a7936329f' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 185-194

a) Take the 50th and 75th quantile across dimension sensor of :math:`X^{\sigma_{t}}`
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

This operation results in two 1D vectors of size :math:`E`:

.. math::
   X^{{\sigma}_t{Q50^s}} = Q50^s(X^{\sigma_{t}}) \in \mathbb{R}^{E}
.. math::
   X^{{\sigma}_t{Q75^s}} = Q75^s(X^{\sigma_{t}}) \in \mathbb{R}^{E}

.. GENERATED FROM PYTHON SOURCE LINES 196-199

.. code-block:: default

    q50, q75 = trim_ch_sd.quantile([0.5, 0.75], dim="ch")
    q50  # a 1D array of median standard deviation values across channels for each epoch






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
    <defs>
    <symbol id="icon-database" viewBox="0 0 32 32">
    <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
    <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    </symbol>
    <symbol id="icon-file-text2" viewBox="0 0 32 32">
    <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
    <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    </symbol>
    </defs>
    </svg>
    <style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
     *
     */

    :root {
      --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
      --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
      --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
      --xr-border-color: var(--jp-border-color2, #e0e0e0);
      --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
      --xr-background-color: var(--jp-layout-color0, white);
      --xr-background-color-row-even: var(--jp-layout-color1, white);
      --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
    }

    html[theme=dark],
    body[data-theme=dark],
    body.vscode-dark {
      --xr-font-color0: rgba(255, 255, 255, 1);
      --xr-font-color2: rgba(255, 255, 255, 0.54);
      --xr-font-color3: rgba(255, 255, 255, 0.38);
      --xr-border-color: #1F1F1F;
      --xr-disabled-color: #515151;
      --xr-background-color: #111111;
      --xr-background-color-row-even: #111111;
      --xr-background-color-row-odd: #313131;
    }

    .xr-wrap {
      display: block !important;
      min-width: 300px;
      max-width: 700px;
    }

    .xr-text-repr-fallback {
      /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
      display: none;
    }

    .xr-header {
      padding-top: 6px;
      padding-bottom: 6px;
      margin-bottom: 4px;
      border-bottom: solid 1px var(--xr-border-color);
    }

    .xr-header > div,
    .xr-header > ul {
      display: inline;
      margin-top: 0;
      margin-bottom: 0;
    }

    .xr-obj-type,
    .xr-array-name {
      margin-left: 2px;
      margin-right: 10px;
    }

    .xr-obj-type {
      color: var(--xr-font-color2);
    }

    .xr-sections {
      padding-left: 0 !important;
      display: grid;
      grid-template-columns: 150px auto auto 1fr 20px 20px;
    }

    .xr-section-item {
      display: contents;
    }

    .xr-section-item input {
      display: none;
    }

    .xr-section-item input + label {
      color: var(--xr-disabled-color);
    }

    .xr-section-item input:enabled + label {
      cursor: pointer;
      color: var(--xr-font-color2);
    }

    .xr-section-item input:enabled + label:hover {
      color: var(--xr-font-color0);
    }

    .xr-section-summary {
      grid-column: 1;
      color: var(--xr-font-color2);
      font-weight: 500;
    }

    .xr-section-summary > span {
      display: inline-block;
      padding-left: 0.5em;
    }

    .xr-section-summary-in:disabled + label {
      color: var(--xr-font-color2);
    }

    .xr-section-summary-in + label:before {
      display: inline-block;
      content: '‚ñ∫';
      font-size: 11px;
      width: 15px;
      text-align: center;
    }

    .xr-section-summary-in:disabled + label:before {
      color: var(--xr-disabled-color);
    }

    .xr-section-summary-in:checked + label:before {
      content: '‚ñº';
    }

    .xr-section-summary-in:checked + label > span {
      display: none;
    }

    .xr-section-summary,
    .xr-section-inline-details {
      padding-top: 4px;
      padding-bottom: 4px;
    }

    .xr-section-inline-details {
      grid-column: 2 / -1;
    }

    .xr-section-details {
      display: none;
      grid-column: 1 / -1;
      margin-bottom: 5px;
    }

    .xr-section-summary-in:checked ~ .xr-section-details {
      display: contents;
    }

    .xr-array-wrap {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 20px auto;
    }

    .xr-array-wrap > label {
      grid-column: 1;
      vertical-align: top;
    }

    .xr-preview {
      color: var(--xr-font-color3);
    }

    .xr-array-preview,
    .xr-array-data {
      padding: 0 5px !important;
      grid-column: 2;
    }

    .xr-array-data,
    .xr-array-in:checked ~ .xr-array-preview {
      display: none;
    }

    .xr-array-in:checked ~ .xr-array-data,
    .xr-array-preview {
      display: inline-block;
    }

    .xr-dim-list {
      display: inline-block !important;
      list-style: none;
      padding: 0 !important;
      margin: 0;
    }

    .xr-dim-list li {
      display: inline-block;
      padding: 0;
      margin: 0;
    }

    .xr-dim-list:before {
      content: '(';
    }

    .xr-dim-list:after {
      content: ')';
    }

    .xr-dim-list li:not(:last-child):after {
      content: ',';
      padding-right: 5px;
    }

    .xr-has-index {
      font-weight: bold;
    }

    .xr-var-list,
    .xr-var-item {
      display: contents;
    }

    .xr-var-item > div,
    .xr-var-item label,
    .xr-var-item > .xr-var-name span {
      background-color: var(--xr-background-color-row-even);
      margin-bottom: 0;
    }

    .xr-var-item > .xr-var-name:hover span {
      padding-right: 5px;
    }

    .xr-var-list > li:nth-child(odd) > div,
    .xr-var-list > li:nth-child(odd) > label,
    .xr-var-list > li:nth-child(odd) > .xr-var-name span {
      background-color: var(--xr-background-color-row-odd);
    }

    .xr-var-name {
      grid-column: 1;
    }

    .xr-var-dims {
      grid-column: 2;
    }

    .xr-var-dtype {
      grid-column: 3;
      text-align: right;
      color: var(--xr-font-color2);
    }

    .xr-var-preview {
      grid-column: 4;
    }

    .xr-index-preview {
      grid-column: 2 / 5;
      color: var(--xr-font-color2);
    }

    .xr-var-name,
    .xr-var-dims,
    .xr-var-dtype,
    .xr-preview,
    .xr-attrs dt {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-right: 10px;
    }

    .xr-var-name:hover,
    .xr-var-dims:hover,
    .xr-var-dtype:hover,
    .xr-attrs dt:hover {
      overflow: visible;
      width: auto;
      z-index: 1;
    }

    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      display: none;
      background-color: var(--xr-background-color) !important;
      padding-bottom: 5px !important;
    }

    .xr-var-attrs-in:checked ~ .xr-var-attrs,
    .xr-var-data-in:checked ~ .xr-var-data,
    .xr-index-data-in:checked ~ .xr-index-data {
      display: block;
    }

    .xr-var-data > table {
      float: right;
    }

    .xr-var-name span,
    .xr-var-data,
    .xr-index-name div,
    .xr-index-data,
    .xr-attrs {
      padding-left: 25px !important;
    }

    .xr-attrs,
    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      grid-column: 1 / -1;
    }

    dl.xr-attrs {
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: 125px auto;
    }

    .xr-attrs dt,
    .xr-attrs dd {
      padding: 0;
      margin: 0;
      float: left;
      padding-right: 10px;
      width: auto;
    }

    .xr-attrs dt {
      font-weight: normal;
      grid-column: 1;
    }

    .xr-attrs dt:hover span {
      display: inline-block;
      background: var(--xr-background-color);
      padding-right: 10px;
    }

    .xr-attrs dd {
      grid-column: 2;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .xr-icon-database,
    .xr-icon-file-text2,
    .xr-no-icon {
      display: inline-block;
      vertical-align: middle;
      width: 1em;
      height: 1.5em !important;
      stroke-width: 0;
      stroke: currentColor;
      fill: currentColor;
    }
    </style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (epoch: 19)&gt;
    array([1.99141036e-06, 1.83063886e-06, 1.86114393e-05, 1.89186104e-06,
           2.55449412e-06, 1.80468126e-06, 1.93964364e-06, 1.79148107e-06,
           3.37745624e-06, 1.98064889e-06, 2.16996676e-06, 1.82618774e-06,
           1.95808177e-06, 1.85464649e-06, 1.99954088e-06, 1.81492303e-06,
           2.01018179e-06, 1.80651964e-06, 2.81241015e-06])
    Coordinates:
      * epoch     (epoch) int64 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18
        quantile  float64 0.5</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>epoch</span>: 19</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-6489e264-9024-4f71-8ca9-f6deccc512c8' class='xr-array-in' type='checkbox' checked><label for='section-6489e264-9024-4f71-8ca9-f6deccc512c8' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>1.991e-06 1.831e-06 1.861e-05 ... 2.01e-06 1.807e-06 2.812e-06</span></div><div class='xr-array-data'><pre>array([1.99141036e-06, 1.83063886e-06, 1.86114393e-05, 1.89186104e-06,
           2.55449412e-06, 1.80468126e-06, 1.93964364e-06, 1.79148107e-06,
           3.37745624e-06, 1.98064889e-06, 2.16996676e-06, 1.82618774e-06,
           1.95808177e-06, 1.85464649e-06, 1.99954088e-06, 1.81492303e-06,
           2.01018179e-06, 1.80651964e-06, 2.81241015e-06])</pre></div></div></li><li class='xr-section-item'><input id='section-d387c467-a330-44b8-90db-74849b448af7' class='xr-section-summary-in' type='checkbox'  checked><label for='section-d387c467-a330-44b8-90db-74849b448af7' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>epoch</span></div><div class='xr-var-dims'>(epoch)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5 6 ... 13 14 15 16 17 18</div><input id='attrs-713faf9c-7b98-4dc0-ab08-760df514c8ca' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-713faf9c-7b98-4dc0-ab08-760df514c8ca' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ee3401bd-63df-42c0-a9b5-4e71bd12a420' class='xr-var-data-in' type='checkbox'><label for='data-ee3401bd-63df-42c0-a9b5-4e71bd12a420' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17,
           18])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>quantile</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.5</div><input id='attrs-e887d092-30e0-4f54-8384-70682ba4e519' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e887d092-30e0-4f54-8384-70682ba4e519' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e064b5ad-e181-4e23-acd6-ac81e8ad412a' class='xr-var-data-in' type='checkbox'><label for='data-e064b5ad-e181-4e23-acd6-ac81e8ad412a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0.5)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-a5b3b718-76a9-4e1c-a07d-821f8c806338' class='xr-section-summary-in' type='checkbox'  ><label for='section-a5b3b718-76a9-4e1c-a07d-821f8c806338' class='xr-section-summary' >Indexes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>epoch</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-be11828d-76df-4762-9110-cd9a11f0984a' class='xr-index-data-in' type='checkbox'/><label for='index-be11828d-76df-4762-9110-cd9a11f0984a' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18], dtype=&#x27;int64&#x27;, name=&#x27;epoch&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-fde99e74-43af-48dc-b906-a5bf6e0b506d' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-fde99e74-43af-48dc-b906-a5bf6e0b506d' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 200-207

b) Define an Upper Quantile Range as :math:`Q75 - Q50`
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. math::
   UQR^s = X^{{\sigma}_T{Q75}^s} - X^{{\sigma}_T{Q50}^s}

This operation results in a 1D vector of size :math:`E`.

.. GENERATED FROM PYTHON SOURCE LINES 207-210

.. code-block:: default

    uqr = q75 - q50
    uqr






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
    <defs>
    <symbol id="icon-database" viewBox="0 0 32 32">
    <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
    <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    </symbol>
    <symbol id="icon-file-text2" viewBox="0 0 32 32">
    <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
    <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    </symbol>
    </defs>
    </svg>
    <style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
     *
     */

    :root {
      --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
      --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
      --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
      --xr-border-color: var(--jp-border-color2, #e0e0e0);
      --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
      --xr-background-color: var(--jp-layout-color0, white);
      --xr-background-color-row-even: var(--jp-layout-color1, white);
      --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
    }

    html[theme=dark],
    body[data-theme=dark],
    body.vscode-dark {
      --xr-font-color0: rgba(255, 255, 255, 1);
      --xr-font-color2: rgba(255, 255, 255, 0.54);
      --xr-font-color3: rgba(255, 255, 255, 0.38);
      --xr-border-color: #1F1F1F;
      --xr-disabled-color: #515151;
      --xr-background-color: #111111;
      --xr-background-color-row-even: #111111;
      --xr-background-color-row-odd: #313131;
    }

    .xr-wrap {
      display: block !important;
      min-width: 300px;
      max-width: 700px;
    }

    .xr-text-repr-fallback {
      /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
      display: none;
    }

    .xr-header {
      padding-top: 6px;
      padding-bottom: 6px;
      margin-bottom: 4px;
      border-bottom: solid 1px var(--xr-border-color);
    }

    .xr-header > div,
    .xr-header > ul {
      display: inline;
      margin-top: 0;
      margin-bottom: 0;
    }

    .xr-obj-type,
    .xr-array-name {
      margin-left: 2px;
      margin-right: 10px;
    }

    .xr-obj-type {
      color: var(--xr-font-color2);
    }

    .xr-sections {
      padding-left: 0 !important;
      display: grid;
      grid-template-columns: 150px auto auto 1fr 20px 20px;
    }

    .xr-section-item {
      display: contents;
    }

    .xr-section-item input {
      display: none;
    }

    .xr-section-item input + label {
      color: var(--xr-disabled-color);
    }

    .xr-section-item input:enabled + label {
      cursor: pointer;
      color: var(--xr-font-color2);
    }

    .xr-section-item input:enabled + label:hover {
      color: var(--xr-font-color0);
    }

    .xr-section-summary {
      grid-column: 1;
      color: var(--xr-font-color2);
      font-weight: 500;
    }

    .xr-section-summary > span {
      display: inline-block;
      padding-left: 0.5em;
    }

    .xr-section-summary-in:disabled + label {
      color: var(--xr-font-color2);
    }

    .xr-section-summary-in + label:before {
      display: inline-block;
      content: '‚ñ∫';
      font-size: 11px;
      width: 15px;
      text-align: center;
    }

    .xr-section-summary-in:disabled + label:before {
      color: var(--xr-disabled-color);
    }

    .xr-section-summary-in:checked + label:before {
      content: '‚ñº';
    }

    .xr-section-summary-in:checked + label > span {
      display: none;
    }

    .xr-section-summary,
    .xr-section-inline-details {
      padding-top: 4px;
      padding-bottom: 4px;
    }

    .xr-section-inline-details {
      grid-column: 2 / -1;
    }

    .xr-section-details {
      display: none;
      grid-column: 1 / -1;
      margin-bottom: 5px;
    }

    .xr-section-summary-in:checked ~ .xr-section-details {
      display: contents;
    }

    .xr-array-wrap {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 20px auto;
    }

    .xr-array-wrap > label {
      grid-column: 1;
      vertical-align: top;
    }

    .xr-preview {
      color: var(--xr-font-color3);
    }

    .xr-array-preview,
    .xr-array-data {
      padding: 0 5px !important;
      grid-column: 2;
    }

    .xr-array-data,
    .xr-array-in:checked ~ .xr-array-preview {
      display: none;
    }

    .xr-array-in:checked ~ .xr-array-data,
    .xr-array-preview {
      display: inline-block;
    }

    .xr-dim-list {
      display: inline-block !important;
      list-style: none;
      padding: 0 !important;
      margin: 0;
    }

    .xr-dim-list li {
      display: inline-block;
      padding: 0;
      margin: 0;
    }

    .xr-dim-list:before {
      content: '(';
    }

    .xr-dim-list:after {
      content: ')';
    }

    .xr-dim-list li:not(:last-child):after {
      content: ',';
      padding-right: 5px;
    }

    .xr-has-index {
      font-weight: bold;
    }

    .xr-var-list,
    .xr-var-item {
      display: contents;
    }

    .xr-var-item > div,
    .xr-var-item label,
    .xr-var-item > .xr-var-name span {
      background-color: var(--xr-background-color-row-even);
      margin-bottom: 0;
    }

    .xr-var-item > .xr-var-name:hover span {
      padding-right: 5px;
    }

    .xr-var-list > li:nth-child(odd) > div,
    .xr-var-list > li:nth-child(odd) > label,
    .xr-var-list > li:nth-child(odd) > .xr-var-name span {
      background-color: var(--xr-background-color-row-odd);
    }

    .xr-var-name {
      grid-column: 1;
    }

    .xr-var-dims {
      grid-column: 2;
    }

    .xr-var-dtype {
      grid-column: 3;
      text-align: right;
      color: var(--xr-font-color2);
    }

    .xr-var-preview {
      grid-column: 4;
    }

    .xr-index-preview {
      grid-column: 2 / 5;
      color: var(--xr-font-color2);
    }

    .xr-var-name,
    .xr-var-dims,
    .xr-var-dtype,
    .xr-preview,
    .xr-attrs dt {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-right: 10px;
    }

    .xr-var-name:hover,
    .xr-var-dims:hover,
    .xr-var-dtype:hover,
    .xr-attrs dt:hover {
      overflow: visible;
      width: auto;
      z-index: 1;
    }

    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      display: none;
      background-color: var(--xr-background-color) !important;
      padding-bottom: 5px !important;
    }

    .xr-var-attrs-in:checked ~ .xr-var-attrs,
    .xr-var-data-in:checked ~ .xr-var-data,
    .xr-index-data-in:checked ~ .xr-index-data {
      display: block;
    }

    .xr-var-data > table {
      float: right;
    }

    .xr-var-name span,
    .xr-var-data,
    .xr-index-name div,
    .xr-index-data,
    .xr-attrs {
      padding-left: 25px !important;
    }

    .xr-attrs,
    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      grid-column: 1 / -1;
    }

    dl.xr-attrs {
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: 125px auto;
    }

    .xr-attrs dt,
    .xr-attrs dd {
      padding: 0;
      margin: 0;
      float: left;
      padding-right: 10px;
      width: auto;
    }

    .xr-attrs dt {
      font-weight: normal;
      grid-column: 1;
    }

    .xr-attrs dt:hover span {
      display: inline-block;
      background: var(--xr-background-color);
      padding-right: 10px;
    }

    .xr-attrs dd {
      grid-column: 2;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .xr-icon-database,
    .xr-icon-file-text2,
    .xr-no-icon {
      display: inline-block;
      vertical-align: middle;
      width: 1em;
      height: 1.5em !important;
      stroke-width: 0;
      stroke: currentColor;
      fill: currentColor;
    }
    </style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (epoch: 19)&gt;
    array([1.53594947e-07, 6.87874051e-08, 8.75110742e-07, 1.24569956e-07,
           1.03378647e-06, 8.81164058e-08, 2.66992044e-07, 8.09917575e-08,
           1.38935505e-06, 2.71423352e-07, 4.18733627e-07, 8.29864322e-08,
           1.49008576e-07, 9.98650835e-08, 1.95358984e-07, 1.19914337e-07,
           1.16793260e-07, 1.02318657e-07, 1.20395236e-06])
    Coordinates:
      * epoch    (epoch) int64 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>epoch</span>: 19</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-80f98fc0-5550-4aec-a2dd-1ee52e33a141' class='xr-array-in' type='checkbox' checked><label for='section-80f98fc0-5550-4aec-a2dd-1ee52e33a141' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>1.536e-07 6.879e-08 8.751e-07 ... 1.168e-07 1.023e-07 1.204e-06</span></div><div class='xr-array-data'><pre>array([1.53594947e-07, 6.87874051e-08, 8.75110742e-07, 1.24569956e-07,
           1.03378647e-06, 8.81164058e-08, 2.66992044e-07, 8.09917575e-08,
           1.38935505e-06, 2.71423352e-07, 4.18733627e-07, 8.29864322e-08,
           1.49008576e-07, 9.98650835e-08, 1.95358984e-07, 1.19914337e-07,
           1.16793260e-07, 1.02318657e-07, 1.20395236e-06])</pre></div></div></li><li class='xr-section-item'><input id='section-2539a9c9-f4ac-4190-a4d0-1ce7ef7925fa' class='xr-section-summary-in' type='checkbox'  checked><label for='section-2539a9c9-f4ac-4190-a4d0-1ce7ef7925fa' class='xr-section-summary' >Coordinates: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>epoch</span></div><div class='xr-var-dims'>(epoch)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5 6 ... 13 14 15 16 17 18</div><input id='attrs-b26f9aaa-9404-4807-9711-2a707b4ac316' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-b26f9aaa-9404-4807-9711-2a707b4ac316' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9a301973-61f1-4eb5-a517-870061ec2f3f' class='xr-var-data-in' type='checkbox'><label for='data-9a301973-61f1-4eb5-a517-870061ec2f3f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17,
           18])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-52b1ace4-c14d-4497-9194-fe60597d8a21' class='xr-section-summary-in' type='checkbox'  ><label for='section-52b1ace4-c14d-4497-9194-fe60597d8a21' class='xr-section-summary' >Indexes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>epoch</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-d2308f4f-e9b5-44b7-9cfa-960b6cd5db5d' class='xr-index-data-in' type='checkbox'/><label for='index-d2308f4f-e9b5-44b7-9cfa-960b6cd5db5d' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18], dtype=&#x27;int64&#x27;, name=&#x27;epoch&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-61054dd5-2730-41bc-936d-92a12bc8ea7a' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-61054dd5-2730-41bc-936d-92a12bc8ea7a' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 211-223

c) Identify outlier Indices :math:`(i, j)`
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

We multiply a constant :math:`k` by the :math:`UQR` to define a measure for the
spread of the right tail of the distribution of :math:`X^{\sigma_{t}}` values and
add it to the median of :math:`X^{\sigma_{t}}` to obtain epoch-specific standard
deviation threshold for outliers:

.. math::
   \tau^s_j = X^{{\sigma}_T{Q50}^S} + UQR^s\times k

That is, :math:`\tau^s_j` is the epoch-specific threshold for the epoch :math:`j`

.. GENERATED FROM PYTHON SOURCE LINES 223-227

.. code-block:: default

    k = 3
    upper_threshold = q50 + q75 * k
    upper_threshold  # epoch specific thresholds






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
    <defs>
    <symbol id="icon-database" viewBox="0 0 32 32">
    <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
    <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    </symbol>
    <symbol id="icon-file-text2" viewBox="0 0 32 32">
    <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
    <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    </symbol>
    </defs>
    </svg>
    <style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
     *
     */

    :root {
      --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
      --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
      --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
      --xr-border-color: var(--jp-border-color2, #e0e0e0);
      --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
      --xr-background-color: var(--jp-layout-color0, white);
      --xr-background-color-row-even: var(--jp-layout-color1, white);
      --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
    }

    html[theme=dark],
    body[data-theme=dark],
    body.vscode-dark {
      --xr-font-color0: rgba(255, 255, 255, 1);
      --xr-font-color2: rgba(255, 255, 255, 0.54);
      --xr-font-color3: rgba(255, 255, 255, 0.38);
      --xr-border-color: #1F1F1F;
      --xr-disabled-color: #515151;
      --xr-background-color: #111111;
      --xr-background-color-row-even: #111111;
      --xr-background-color-row-odd: #313131;
    }

    .xr-wrap {
      display: block !important;
      min-width: 300px;
      max-width: 700px;
    }

    .xr-text-repr-fallback {
      /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
      display: none;
    }

    .xr-header {
      padding-top: 6px;
      padding-bottom: 6px;
      margin-bottom: 4px;
      border-bottom: solid 1px var(--xr-border-color);
    }

    .xr-header > div,
    .xr-header > ul {
      display: inline;
      margin-top: 0;
      margin-bottom: 0;
    }

    .xr-obj-type,
    .xr-array-name {
      margin-left: 2px;
      margin-right: 10px;
    }

    .xr-obj-type {
      color: var(--xr-font-color2);
    }

    .xr-sections {
      padding-left: 0 !important;
      display: grid;
      grid-template-columns: 150px auto auto 1fr 20px 20px;
    }

    .xr-section-item {
      display: contents;
    }

    .xr-section-item input {
      display: none;
    }

    .xr-section-item input + label {
      color: var(--xr-disabled-color);
    }

    .xr-section-item input:enabled + label {
      cursor: pointer;
      color: var(--xr-font-color2);
    }

    .xr-section-item input:enabled + label:hover {
      color: var(--xr-font-color0);
    }

    .xr-section-summary {
      grid-column: 1;
      color: var(--xr-font-color2);
      font-weight: 500;
    }

    .xr-section-summary > span {
      display: inline-block;
      padding-left: 0.5em;
    }

    .xr-section-summary-in:disabled + label {
      color: var(--xr-font-color2);
    }

    .xr-section-summary-in + label:before {
      display: inline-block;
      content: '‚ñ∫';
      font-size: 11px;
      width: 15px;
      text-align: center;
    }

    .xr-section-summary-in:disabled + label:before {
      color: var(--xr-disabled-color);
    }

    .xr-section-summary-in:checked + label:before {
      content: '‚ñº';
    }

    .xr-section-summary-in:checked + label > span {
      display: none;
    }

    .xr-section-summary,
    .xr-section-inline-details {
      padding-top: 4px;
      padding-bottom: 4px;
    }

    .xr-section-inline-details {
      grid-column: 2 / -1;
    }

    .xr-section-details {
      display: none;
      grid-column: 1 / -1;
      margin-bottom: 5px;
    }

    .xr-section-summary-in:checked ~ .xr-section-details {
      display: contents;
    }

    .xr-array-wrap {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 20px auto;
    }

    .xr-array-wrap > label {
      grid-column: 1;
      vertical-align: top;
    }

    .xr-preview {
      color: var(--xr-font-color3);
    }

    .xr-array-preview,
    .xr-array-data {
      padding: 0 5px !important;
      grid-column: 2;
    }

    .xr-array-data,
    .xr-array-in:checked ~ .xr-array-preview {
      display: none;
    }

    .xr-array-in:checked ~ .xr-array-data,
    .xr-array-preview {
      display: inline-block;
    }

    .xr-dim-list {
      display: inline-block !important;
      list-style: none;
      padding: 0 !important;
      margin: 0;
    }

    .xr-dim-list li {
      display: inline-block;
      padding: 0;
      margin: 0;
    }

    .xr-dim-list:before {
      content: '(';
    }

    .xr-dim-list:after {
      content: ')';
    }

    .xr-dim-list li:not(:last-child):after {
      content: ',';
      padding-right: 5px;
    }

    .xr-has-index {
      font-weight: bold;
    }

    .xr-var-list,
    .xr-var-item {
      display: contents;
    }

    .xr-var-item > div,
    .xr-var-item label,
    .xr-var-item > .xr-var-name span {
      background-color: var(--xr-background-color-row-even);
      margin-bottom: 0;
    }

    .xr-var-item > .xr-var-name:hover span {
      padding-right: 5px;
    }

    .xr-var-list > li:nth-child(odd) > div,
    .xr-var-list > li:nth-child(odd) > label,
    .xr-var-list > li:nth-child(odd) > .xr-var-name span {
      background-color: var(--xr-background-color-row-odd);
    }

    .xr-var-name {
      grid-column: 1;
    }

    .xr-var-dims {
      grid-column: 2;
    }

    .xr-var-dtype {
      grid-column: 3;
      text-align: right;
      color: var(--xr-font-color2);
    }

    .xr-var-preview {
      grid-column: 4;
    }

    .xr-index-preview {
      grid-column: 2 / 5;
      color: var(--xr-font-color2);
    }

    .xr-var-name,
    .xr-var-dims,
    .xr-var-dtype,
    .xr-preview,
    .xr-attrs dt {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-right: 10px;
    }

    .xr-var-name:hover,
    .xr-var-dims:hover,
    .xr-var-dtype:hover,
    .xr-attrs dt:hover {
      overflow: visible;
      width: auto;
      z-index: 1;
    }

    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      display: none;
      background-color: var(--xr-background-color) !important;
      padding-bottom: 5px !important;
    }

    .xr-var-attrs-in:checked ~ .xr-var-attrs,
    .xr-var-data-in:checked ~ .xr-var-data,
    .xr-index-data-in:checked ~ .xr-index-data {
      display: block;
    }

    .xr-var-data > table {
      float: right;
    }

    .xr-var-name span,
    .xr-var-data,
    .xr-index-name div,
    .xr-index-data,
    .xr-attrs {
      padding-left: 25px !important;
    }

    .xr-attrs,
    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      grid-column: 1 / -1;
    }

    dl.xr-attrs {
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: 125px auto;
    }

    .xr-attrs dt,
    .xr-attrs dd {
      padding: 0;
      margin: 0;
      float: left;
      padding-right: 10px;
      width: auto;
    }

    .xr-attrs dt {
      font-weight: normal;
      grid-column: 1;
    }

    .xr-attrs dt:hover span {
      display: inline-block;
      background: var(--xr-background-color);
      padding-right: 10px;
    }

    .xr-attrs dd {
      grid-column: 2;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .xr-icon-database,
    .xr-icon-file-text2,
    .xr-no-icon {
      display: inline-block;
      vertical-align: middle;
      width: 1em;
      height: 1.5em !important;
      stroke-width: 0;
      stroke: currentColor;
      fill: currentColor;
    }
    </style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (epoch: 19)&gt;
    array([8.42642627e-06, 7.52891764e-06, 7.70710893e-05, 7.94115403e-06,
           1.33193359e-05, 7.48307428e-06, 8.55955070e-06, 7.40889955e-06,
           1.76778901e-05, 8.73686562e-06, 9.93606791e-06, 7.55371026e-06,
           8.27935281e-06, 7.71818121e-06, 8.58424048e-06, 7.61943515e-06,
           8.39110692e-06, 7.53303452e-06, 1.48614977e-05])
    Coordinates:
      * epoch    (epoch) int64 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>epoch</span>: 19</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-8ad40c08-7a41-41c8-8165-52be671f724e' class='xr-array-in' type='checkbox' checked><label for='section-8ad40c08-7a41-41c8-8165-52be671f724e' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>8.426e-06 7.529e-06 7.707e-05 ... 8.391e-06 7.533e-06 1.486e-05</span></div><div class='xr-array-data'><pre>array([8.42642627e-06, 7.52891764e-06, 7.70710893e-05, 7.94115403e-06,
           1.33193359e-05, 7.48307428e-06, 8.55955070e-06, 7.40889955e-06,
           1.76778901e-05, 8.73686562e-06, 9.93606791e-06, 7.55371026e-06,
           8.27935281e-06, 7.71818121e-06, 8.58424048e-06, 7.61943515e-06,
           8.39110692e-06, 7.53303452e-06, 1.48614977e-05])</pre></div></div></li><li class='xr-section-item'><input id='section-8b63c312-ca37-4897-bc57-2daee85e727f' class='xr-section-summary-in' type='checkbox'  checked><label for='section-8b63c312-ca37-4897-bc57-2daee85e727f' class='xr-section-summary' >Coordinates: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>epoch</span></div><div class='xr-var-dims'>(epoch)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5 6 ... 13 14 15 16 17 18</div><input id='attrs-c3f37167-a99b-4dc0-8e59-ec936695c64b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-c3f37167-a99b-4dc0-8e59-ec936695c64b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c2cfe26d-81d3-45b0-8fe4-4c1ca5074525' class='xr-var-data-in' type='checkbox'><label for='data-c2cfe26d-81d3-45b0-8fe4-4c1ca5074525' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17,
           18])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-6507c0c8-9daf-4ef8-b337-846f038f6e20' class='xr-section-summary-in' type='checkbox'  ><label for='section-6507c0c8-9daf-4ef8-b337-846f038f6e20' class='xr-section-summary' >Indexes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>epoch</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-c4132c73-af2c-4a0e-bf81-718785856ee0' class='xr-index-data-in' type='checkbox'/><label for='index-c4132c73-af2c-4a0e-bf81-718785856ee0' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18], dtype=&#x27;int64&#x27;, name=&#x27;epoch&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-90405292-3b01-48ac-9dfd-f8caacf8e8f6' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-90405292-3b01-48ac-9dfd-f8caacf8e8f6' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 228-245

Now, we compare our 2D standard deviation matrix to the threshold vector of
:math:`\tau^e_j`:

.. math::
   X^{\sigma_{t}} \big|_{e=j}  > \tau^s_j

resulting in the indicator matrix :math:`C \in \{0, 1\}^{S \times E}=\{c_{ij}\}`:

.. math::
   c_{ij} =
   \begin{cases}
   0 & \text{if } x^{\sigma_{t}}_{ij} < \tau^s_j \\
   1 & \text{if } x^{\sigma_{t}}_{ij} \geq \tau^s_j
   \end{cases}

Each element of this matrix indicates whether sensor :math:`i` is an outlier at an epoch
:math:`j`.

.. GENERATED FROM PYTHON SOURCE LINES 245-248

.. code-block:: default

    outlier_mask = trim_ch_sd > upper_threshold
    outlier_mask






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
    <defs>
    <symbol id="icon-database" viewBox="0 0 32 32">
    <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
    <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    </symbol>
    <symbol id="icon-file-text2" viewBox="0 0 32 32">
    <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
    <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    </symbol>
    </defs>
    </svg>
    <style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
     *
     */

    :root {
      --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
      --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
      --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
      --xr-border-color: var(--jp-border-color2, #e0e0e0);
      --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
      --xr-background-color: var(--jp-layout-color0, white);
      --xr-background-color-row-even: var(--jp-layout-color1, white);
      --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
    }

    html[theme=dark],
    body[data-theme=dark],
    body.vscode-dark {
      --xr-font-color0: rgba(255, 255, 255, 1);
      --xr-font-color2: rgba(255, 255, 255, 0.54);
      --xr-font-color3: rgba(255, 255, 255, 0.38);
      --xr-border-color: #1F1F1F;
      --xr-disabled-color: #515151;
      --xr-background-color: #111111;
      --xr-background-color-row-even: #111111;
      --xr-background-color-row-odd: #313131;
    }

    .xr-wrap {
      display: block !important;
      min-width: 300px;
      max-width: 700px;
    }

    .xr-text-repr-fallback {
      /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
      display: none;
    }

    .xr-header {
      padding-top: 6px;
      padding-bottom: 6px;
      margin-bottom: 4px;
      border-bottom: solid 1px var(--xr-border-color);
    }

    .xr-header > div,
    .xr-header > ul {
      display: inline;
      margin-top: 0;
      margin-bottom: 0;
    }

    .xr-obj-type,
    .xr-array-name {
      margin-left: 2px;
      margin-right: 10px;
    }

    .xr-obj-type {
      color: var(--xr-font-color2);
    }

    .xr-sections {
      padding-left: 0 !important;
      display: grid;
      grid-template-columns: 150px auto auto 1fr 20px 20px;
    }

    .xr-section-item {
      display: contents;
    }

    .xr-section-item input {
      display: none;
    }

    .xr-section-item input + label {
      color: var(--xr-disabled-color);
    }

    .xr-section-item input:enabled + label {
      cursor: pointer;
      color: var(--xr-font-color2);
    }

    .xr-section-item input:enabled + label:hover {
      color: var(--xr-font-color0);
    }

    .xr-section-summary {
      grid-column: 1;
      color: var(--xr-font-color2);
      font-weight: 500;
    }

    .xr-section-summary > span {
      display: inline-block;
      padding-left: 0.5em;
    }

    .xr-section-summary-in:disabled + label {
      color: var(--xr-font-color2);
    }

    .xr-section-summary-in + label:before {
      display: inline-block;
      content: '‚ñ∫';
      font-size: 11px;
      width: 15px;
      text-align: center;
    }

    .xr-section-summary-in:disabled + label:before {
      color: var(--xr-disabled-color);
    }

    .xr-section-summary-in:checked + label:before {
      content: '‚ñº';
    }

    .xr-section-summary-in:checked + label > span {
      display: none;
    }

    .xr-section-summary,
    .xr-section-inline-details {
      padding-top: 4px;
      padding-bottom: 4px;
    }

    .xr-section-inline-details {
      grid-column: 2 / -1;
    }

    .xr-section-details {
      display: none;
      grid-column: 1 / -1;
      margin-bottom: 5px;
    }

    .xr-section-summary-in:checked ~ .xr-section-details {
      display: contents;
    }

    .xr-array-wrap {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 20px auto;
    }

    .xr-array-wrap > label {
      grid-column: 1;
      vertical-align: top;
    }

    .xr-preview {
      color: var(--xr-font-color3);
    }

    .xr-array-preview,
    .xr-array-data {
      padding: 0 5px !important;
      grid-column: 2;
    }

    .xr-array-data,
    .xr-array-in:checked ~ .xr-array-preview {
      display: none;
    }

    .xr-array-in:checked ~ .xr-array-data,
    .xr-array-preview {
      display: inline-block;
    }

    .xr-dim-list {
      display: inline-block !important;
      list-style: none;
      padding: 0 !important;
      margin: 0;
    }

    .xr-dim-list li {
      display: inline-block;
      padding: 0;
      margin: 0;
    }

    .xr-dim-list:before {
      content: '(';
    }

    .xr-dim-list:after {
      content: ')';
    }

    .xr-dim-list li:not(:last-child):after {
      content: ',';
      padding-right: 5px;
    }

    .xr-has-index {
      font-weight: bold;
    }

    .xr-var-list,
    .xr-var-item {
      display: contents;
    }

    .xr-var-item > div,
    .xr-var-item label,
    .xr-var-item > .xr-var-name span {
      background-color: var(--xr-background-color-row-even);
      margin-bottom: 0;
    }

    .xr-var-item > .xr-var-name:hover span {
      padding-right: 5px;
    }

    .xr-var-list > li:nth-child(odd) > div,
    .xr-var-list > li:nth-child(odd) > label,
    .xr-var-list > li:nth-child(odd) > .xr-var-name span {
      background-color: var(--xr-background-color-row-odd);
    }

    .xr-var-name {
      grid-column: 1;
    }

    .xr-var-dims {
      grid-column: 2;
    }

    .xr-var-dtype {
      grid-column: 3;
      text-align: right;
      color: var(--xr-font-color2);
    }

    .xr-var-preview {
      grid-column: 4;
    }

    .xr-index-preview {
      grid-column: 2 / 5;
      color: var(--xr-font-color2);
    }

    .xr-var-name,
    .xr-var-dims,
    .xr-var-dtype,
    .xr-preview,
    .xr-attrs dt {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-right: 10px;
    }

    .xr-var-name:hover,
    .xr-var-dims:hover,
    .xr-var-dtype:hover,
    .xr-attrs dt:hover {
      overflow: visible;
      width: auto;
      z-index: 1;
    }

    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      display: none;
      background-color: var(--xr-background-color) !important;
      padding-bottom: 5px !important;
    }

    .xr-var-attrs-in:checked ~ .xr-var-attrs,
    .xr-var-data-in:checked ~ .xr-var-data,
    .xr-index-data-in:checked ~ .xr-index-data {
      display: block;
    }

    .xr-var-data > table {
      float: right;
    }

    .xr-var-name span,
    .xr-var-data,
    .xr-index-name div,
    .xr-index-data,
    .xr-attrs {
      padding-left: 25px !important;
    }

    .xr-attrs,
    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      grid-column: 1 / -1;
    }

    dl.xr-attrs {
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: 125px auto;
    }

    .xr-attrs dt,
    .xr-attrs dd {
      padding: 0;
      margin: 0;
      float: left;
      padding-right: 10px;
      width: auto;
    }

    .xr-attrs dt {
      font-weight: normal;
      grid-column: 1;
    }

    .xr-attrs dt:hover span {
      display: inline-block;
      background: var(--xr-background-color);
      padding-right: 10px;
    }

    .xr-attrs dd {
      grid-column: 2;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .xr-icon-database,
    .xr-icon-file-text2,
    .xr-no-icon {
      display: inline-block;
      vertical-align: middle;
      width: 1em;
      height: 1.5em !important;
      stroke-width: 0;
      stroke: currentColor;
      fill: currentColor;
    }
    </style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (epoch: 19, ch: 60)&gt;
    array([[ True,  True, False, ..., False, False, False],
           [ True,  True, False, ..., False, False, False],
           [False, False, False, ..., False, False, False],
           ...,
           [ True,  True, False, ..., False, False, False],
           [ True,  True, False, ..., False, False, False],
           [ True, False, False, ..., False, False, False]])
    Coordinates:
      * epoch    (epoch) int64 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18
      * ch       (ch) &lt;U7 &#x27;EEG 001&#x27; &#x27;EEG 002&#x27; &#x27;EEG 003&#x27; ... &#x27;EEG 059&#x27; &#x27;EEG 060&#x27;</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>epoch</span>: 19</li><li><span class='xr-has-index'>ch</span>: 60</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-d0445d1d-bdf7-4a06-bb26-fd71a47e5bc9' class='xr-array-in' type='checkbox' checked><label for='section-d0445d1d-bdf7-4a06-bb26-fd71a47e5bc9' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>True True False False False False ... False False False False False</span></div><div class='xr-array-data'><pre>array([[ True,  True, False, ..., False, False, False],
           [ True,  True, False, ..., False, False, False],
           [False, False, False, ..., False, False, False],
           ...,
           [ True,  True, False, ..., False, False, False],
           [ True,  True, False, ..., False, False, False],
           [ True, False, False, ..., False, False, False]])</pre></div></div></li><li class='xr-section-item'><input id='section-19a803b0-9a96-40a7-b021-7ca6a36e0b9f' class='xr-section-summary-in' type='checkbox'  checked><label for='section-19a803b0-9a96-40a7-b021-7ca6a36e0b9f' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>epoch</span></div><div class='xr-var-dims'>(epoch)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5 6 ... 13 14 15 16 17 18</div><input id='attrs-2a6a8417-c63f-418e-8b50-c7cc655cd96b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2a6a8417-c63f-418e-8b50-c7cc655cd96b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-fc45b0fb-eece-4d72-84a6-172169316b81' class='xr-var-data-in' type='checkbox'><label for='data-fc45b0fb-eece-4d72-84a6-172169316b81' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17,
           18])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>ch</span></div><div class='xr-var-dims'>(ch)</div><div class='xr-var-dtype'>&lt;U7</div><div class='xr-var-preview xr-preview'>&#x27;EEG 001&#x27; &#x27;EEG 002&#x27; ... &#x27;EEG 060&#x27;</div><input id='attrs-3bb800cb-6754-4740-afe2-b94c36fa1113' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3bb800cb-6754-4740-afe2-b94c36fa1113' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-734d4fcf-5ab0-4956-8f78-1f3c91f1f6fc' class='xr-var-data-in' type='checkbox'><label for='data-734d4fcf-5ab0-4956-8f78-1f3c91f1f6fc' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;EEG 001&#x27;, &#x27;EEG 002&#x27;, &#x27;EEG 003&#x27;, &#x27;EEG 004&#x27;, &#x27;EEG 005&#x27;, &#x27;EEG 006&#x27;,
           &#x27;EEG 007&#x27;, &#x27;EEG 008&#x27;, &#x27;EEG 009&#x27;, &#x27;EEG 010&#x27;, &#x27;EEG 011&#x27;, &#x27;EEG 012&#x27;,
           &#x27;EEG 013&#x27;, &#x27;EEG 014&#x27;, &#x27;EEG 015&#x27;, &#x27;EEG 016&#x27;, &#x27;EEG 017&#x27;, &#x27;EEG 018&#x27;,
           &#x27;EEG 019&#x27;, &#x27;EEG 020&#x27;, &#x27;EEG 021&#x27;, &#x27;EEG 022&#x27;, &#x27;EEG 023&#x27;, &#x27;EEG 024&#x27;,
           &#x27;EEG 025&#x27;, &#x27;EEG 026&#x27;, &#x27;EEG 027&#x27;, &#x27;EEG 028&#x27;, &#x27;EEG 029&#x27;, &#x27;EEG 030&#x27;,
           &#x27;EEG 031&#x27;, &#x27;EEG 032&#x27;, &#x27;EEG 033&#x27;, &#x27;EEG 034&#x27;, &#x27;EEG 035&#x27;, &#x27;EEG 036&#x27;,
           &#x27;EEG 037&#x27;, &#x27;EEG 038&#x27;, &#x27;EEG 039&#x27;, &#x27;EEG 040&#x27;, &#x27;EEG 041&#x27;, &#x27;EEG 042&#x27;,
           &#x27;EEG 043&#x27;, &#x27;EEG 044&#x27;, &#x27;EEG 045&#x27;, &#x27;EEG 046&#x27;, &#x27;EEG 047&#x27;, &#x27;EEG 048&#x27;,
           &#x27;EEG 049&#x27;, &#x27;EEG 050&#x27;, &#x27;EEG 051&#x27;, &#x27;EEG 052&#x27;, &#x27;EEG 053&#x27;, &#x27;EEG 054&#x27;,
           &#x27;EEG 055&#x27;, &#x27;EEG 056&#x27;, &#x27;EEG 057&#x27;, &#x27;EEG 058&#x27;, &#x27;EEG 059&#x27;, &#x27;EEG 060&#x27;],
          dtype=&#x27;&lt;U7&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-59b3e30f-9dca-4297-8477-c9679880df77' class='xr-section-summary-in' type='checkbox'  ><label for='section-59b3e30f-9dca-4297-8477-c9679880df77' class='xr-section-summary' >Indexes: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>epoch</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-67ecbdc4-982d-4527-b952-25d997cd0c00' class='xr-index-data-in' type='checkbox'/><label for='index-67ecbdc4-982d-4527-b952-25d997cd0c00' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18], dtype=&#x27;int64&#x27;, name=&#x27;epoch&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>ch</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-e9e2819a-cfd5-4512-bc65-85ac89e9bb8d' class='xr-index-data-in' type='checkbox'/><label for='index-e9e2819a-cfd5-4512-bc65-85ac89e9bb8d' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;EEG 001&#x27;, &#x27;EEG 002&#x27;, &#x27;EEG 003&#x27;, &#x27;EEG 004&#x27;, &#x27;EEG 005&#x27;, &#x27;EEG 006&#x27;,
           &#x27;EEG 007&#x27;, &#x27;EEG 008&#x27;, &#x27;EEG 009&#x27;, &#x27;EEG 010&#x27;, &#x27;EEG 011&#x27;, &#x27;EEG 012&#x27;,
           &#x27;EEG 013&#x27;, &#x27;EEG 014&#x27;, &#x27;EEG 015&#x27;, &#x27;EEG 016&#x27;, &#x27;EEG 017&#x27;, &#x27;EEG 018&#x27;,
           &#x27;EEG 019&#x27;, &#x27;EEG 020&#x27;, &#x27;EEG 021&#x27;, &#x27;EEG 022&#x27;, &#x27;EEG 023&#x27;, &#x27;EEG 024&#x27;,
           &#x27;EEG 025&#x27;, &#x27;EEG 026&#x27;, &#x27;EEG 027&#x27;, &#x27;EEG 028&#x27;, &#x27;EEG 029&#x27;, &#x27;EEG 030&#x27;,
           &#x27;EEG 031&#x27;, &#x27;EEG 032&#x27;, &#x27;EEG 033&#x27;, &#x27;EEG 034&#x27;, &#x27;EEG 035&#x27;, &#x27;EEG 036&#x27;,
           &#x27;EEG 037&#x27;, &#x27;EEG 038&#x27;, &#x27;EEG 039&#x27;, &#x27;EEG 040&#x27;, &#x27;EEG 041&#x27;, &#x27;EEG 042&#x27;,
           &#x27;EEG 043&#x27;, &#x27;EEG 044&#x27;, &#x27;EEG 045&#x27;, &#x27;EEG 046&#x27;, &#x27;EEG 047&#x27;, &#x27;EEG 048&#x27;,
           &#x27;EEG 049&#x27;, &#x27;EEG 050&#x27;, &#x27;EEG 051&#x27;, &#x27;EEG 052&#x27;, &#x27;EEG 053&#x27;, &#x27;EEG 054&#x27;,
           &#x27;EEG 055&#x27;, &#x27;EEG 056&#x27;, &#x27;EEG 057&#x27;, &#x27;EEG 058&#x27;, &#x27;EEG 059&#x27;, &#x27;EEG 060&#x27;],
          dtype=&#x27;object&#x27;, name=&#x27;ch&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-17a4ff46-f421-46d0-a8a3-da4f7c11f335' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-17a4ff46-f421-46d0-a8a3-da4f7c11f335' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 249-256

d) Identify noisy sensors part 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

To identify outlier sensors, we average across the epoch dimension of our indicator
matrix :math:`C` and obtain :math:`C^{\mu_e} \in \mathbb{R}^{S_\mathcal{G}}`, which
is a vector of fractional numbers :math:`c^{\mu_e}_i` representing the percentage of
epochs for which that sensor is an outlier.

.. GENERATED FROM PYTHON SOURCE LINES 256-259

.. code-block:: default

    percent_outliers = outlier_mask.astype(float).mean("epoch")
    percent_outliers  # percent of epochs that sensor is an outlier






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
    <defs>
    <symbol id="icon-database" viewBox="0 0 32 32">
    <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
    <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    </symbol>
    <symbol id="icon-file-text2" viewBox="0 0 32 32">
    <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
    <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    </symbol>
    </defs>
    </svg>
    <style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
     *
     */

    :root {
      --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
      --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
      --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
      --xr-border-color: var(--jp-border-color2, #e0e0e0);
      --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
      --xr-background-color: var(--jp-layout-color0, white);
      --xr-background-color-row-even: var(--jp-layout-color1, white);
      --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
    }

    html[theme=dark],
    body[data-theme=dark],
    body.vscode-dark {
      --xr-font-color0: rgba(255, 255, 255, 1);
      --xr-font-color2: rgba(255, 255, 255, 0.54);
      --xr-font-color3: rgba(255, 255, 255, 0.38);
      --xr-border-color: #1F1F1F;
      --xr-disabled-color: #515151;
      --xr-background-color: #111111;
      --xr-background-color-row-even: #111111;
      --xr-background-color-row-odd: #313131;
    }

    .xr-wrap {
      display: block !important;
      min-width: 300px;
      max-width: 700px;
    }

    .xr-text-repr-fallback {
      /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
      display: none;
    }

    .xr-header {
      padding-top: 6px;
      padding-bottom: 6px;
      margin-bottom: 4px;
      border-bottom: solid 1px var(--xr-border-color);
    }

    .xr-header > div,
    .xr-header > ul {
      display: inline;
      margin-top: 0;
      margin-bottom: 0;
    }

    .xr-obj-type,
    .xr-array-name {
      margin-left: 2px;
      margin-right: 10px;
    }

    .xr-obj-type {
      color: var(--xr-font-color2);
    }

    .xr-sections {
      padding-left: 0 !important;
      display: grid;
      grid-template-columns: 150px auto auto 1fr 20px 20px;
    }

    .xr-section-item {
      display: contents;
    }

    .xr-section-item input {
      display: none;
    }

    .xr-section-item input + label {
      color: var(--xr-disabled-color);
    }

    .xr-section-item input:enabled + label {
      cursor: pointer;
      color: var(--xr-font-color2);
    }

    .xr-section-item input:enabled + label:hover {
      color: var(--xr-font-color0);
    }

    .xr-section-summary {
      grid-column: 1;
      color: var(--xr-font-color2);
      font-weight: 500;
    }

    .xr-section-summary > span {
      display: inline-block;
      padding-left: 0.5em;
    }

    .xr-section-summary-in:disabled + label {
      color: var(--xr-font-color2);
    }

    .xr-section-summary-in + label:before {
      display: inline-block;
      content: '‚ñ∫';
      font-size: 11px;
      width: 15px;
      text-align: center;
    }

    .xr-section-summary-in:disabled + label:before {
      color: var(--xr-disabled-color);
    }

    .xr-section-summary-in:checked + label:before {
      content: '‚ñº';
    }

    .xr-section-summary-in:checked + label > span {
      display: none;
    }

    .xr-section-summary,
    .xr-section-inline-details {
      padding-top: 4px;
      padding-bottom: 4px;
    }

    .xr-section-inline-details {
      grid-column: 2 / -1;
    }

    .xr-section-details {
      display: none;
      grid-column: 1 / -1;
      margin-bottom: 5px;
    }

    .xr-section-summary-in:checked ~ .xr-section-details {
      display: contents;
    }

    .xr-array-wrap {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 20px auto;
    }

    .xr-array-wrap > label {
      grid-column: 1;
      vertical-align: top;
    }

    .xr-preview {
      color: var(--xr-font-color3);
    }

    .xr-array-preview,
    .xr-array-data {
      padding: 0 5px !important;
      grid-column: 2;
    }

    .xr-array-data,
    .xr-array-in:checked ~ .xr-array-preview {
      display: none;
    }

    .xr-array-in:checked ~ .xr-array-data,
    .xr-array-preview {
      display: inline-block;
    }

    .xr-dim-list {
      display: inline-block !important;
      list-style: none;
      padding: 0 !important;
      margin: 0;
    }

    .xr-dim-list li {
      display: inline-block;
      padding: 0;
      margin: 0;
    }

    .xr-dim-list:before {
      content: '(';
    }

    .xr-dim-list:after {
      content: ')';
    }

    .xr-dim-list li:not(:last-child):after {
      content: ',';
      padding-right: 5px;
    }

    .xr-has-index {
      font-weight: bold;
    }

    .xr-var-list,
    .xr-var-item {
      display: contents;
    }

    .xr-var-item > div,
    .xr-var-item label,
    .xr-var-item > .xr-var-name span {
      background-color: var(--xr-background-color-row-even);
      margin-bottom: 0;
    }

    .xr-var-item > .xr-var-name:hover span {
      padding-right: 5px;
    }

    .xr-var-list > li:nth-child(odd) > div,
    .xr-var-list > li:nth-child(odd) > label,
    .xr-var-list > li:nth-child(odd) > .xr-var-name span {
      background-color: var(--xr-background-color-row-odd);
    }

    .xr-var-name {
      grid-column: 1;
    }

    .xr-var-dims {
      grid-column: 2;
    }

    .xr-var-dtype {
      grid-column: 3;
      text-align: right;
      color: var(--xr-font-color2);
    }

    .xr-var-preview {
      grid-column: 4;
    }

    .xr-index-preview {
      grid-column: 2 / 5;
      color: var(--xr-font-color2);
    }

    .xr-var-name,
    .xr-var-dims,
    .xr-var-dtype,
    .xr-preview,
    .xr-attrs dt {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-right: 10px;
    }

    .xr-var-name:hover,
    .xr-var-dims:hover,
    .xr-var-dtype:hover,
    .xr-attrs dt:hover {
      overflow: visible;
      width: auto;
      z-index: 1;
    }

    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      display: none;
      background-color: var(--xr-background-color) !important;
      padding-bottom: 5px !important;
    }

    .xr-var-attrs-in:checked ~ .xr-var-attrs,
    .xr-var-data-in:checked ~ .xr-var-data,
    .xr-index-data-in:checked ~ .xr-index-data {
      display: block;
    }

    .xr-var-data > table {
      float: right;
    }

    .xr-var-name span,
    .xr-var-data,
    .xr-index-name div,
    .xr-index-data,
    .xr-attrs {
      padding-left: 25px !important;
    }

    .xr-attrs,
    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      grid-column: 1 / -1;
    }

    dl.xr-attrs {
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: 125px auto;
    }

    .xr-attrs dt,
    .xr-attrs dd {
      padding: 0;
      margin: 0;
      float: left;
      padding-right: 10px;
      width: auto;
    }

    .xr-attrs dt {
      font-weight: normal;
      grid-column: 1;
    }

    .xr-attrs dt:hover span {
      display: inline-block;
      background: var(--xr-background-color);
      padding-right: 10px;
    }

    .xr-attrs dd {
      grid-column: 2;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .xr-icon-database,
    .xr-icon-file-text2,
    .xr-no-icon {
      display: inline-block;
      vertical-align: middle;
      width: 1em;
      height: 1.5em !important;
      stroke-width: 0;
      stroke: currentColor;
      fill: currentColor;
    }
    </style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (ch: 60)&gt;
    array([0.94736842, 0.84210526, 0.        , 0.        , 0.        ,
           0.        , 0.26315789, 0.        , 0.        , 0.        ,
           0.        , 0.        , 0.        , 0.        , 0.        ,
           0.        , 0.        , 0.        , 0.        , 0.        ,
           0.        , 0.        , 0.        , 0.        , 0.        ,
           0.        , 0.        , 0.        , 0.        , 0.        ,
           0.        , 0.        , 0.        , 0.        , 0.        ,
           0.        , 0.        , 0.        , 0.        , 0.        ,
           0.        , 0.        , 0.        , 0.        , 0.        ,
           0.        , 0.        , 0.        , 0.        , 0.        ,
           0.        , 0.        , 0.        , 0.        , 0.        ,
           0.        , 0.        , 0.        , 0.        , 0.        ])
    Coordinates:
      * ch       (ch) &lt;U7 &#x27;EEG 001&#x27; &#x27;EEG 002&#x27; &#x27;EEG 003&#x27; ... &#x27;EEG 059&#x27; &#x27;EEG 060&#x27;</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>ch</span>: 60</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-108b25f1-aad7-45f2-9727-29509dc049a8' class='xr-array-in' type='checkbox' checked><label for='section-108b25f1-aad7-45f2-9727-29509dc049a8' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>0.9474 0.8421 0.0 0.0 0.0 0.0 0.2632 ... 0.0 0.0 0.0 0.0 0.0 0.0 0.0</span></div><div class='xr-array-data'><pre>array([0.94736842, 0.84210526, 0.        , 0.        , 0.        ,
           0.        , 0.26315789, 0.        , 0.        , 0.        ,
           0.        , 0.        , 0.        , 0.        , 0.        ,
           0.        , 0.        , 0.        , 0.        , 0.        ,
           0.        , 0.        , 0.        , 0.        , 0.        ,
           0.        , 0.        , 0.        , 0.        , 0.        ,
           0.        , 0.        , 0.        , 0.        , 0.        ,
           0.        , 0.        , 0.        , 0.        , 0.        ,
           0.        , 0.        , 0.        , 0.        , 0.        ,
           0.        , 0.        , 0.        , 0.        , 0.        ,
           0.        , 0.        , 0.        , 0.        , 0.        ,
           0.        , 0.        , 0.        , 0.        , 0.        ])</pre></div></div></li><li class='xr-section-item'><input id='section-238b3647-c465-4678-98da-e30187876208' class='xr-section-summary-in' type='checkbox'  checked><label for='section-238b3647-c465-4678-98da-e30187876208' class='xr-section-summary' >Coordinates: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>ch</span></div><div class='xr-var-dims'>(ch)</div><div class='xr-var-dtype'>&lt;U7</div><div class='xr-var-preview xr-preview'>&#x27;EEG 001&#x27; &#x27;EEG 002&#x27; ... &#x27;EEG 060&#x27;</div><input id='attrs-dd66e44c-cfc6-428f-8d57-0c1352c1e718' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-dd66e44c-cfc6-428f-8d57-0c1352c1e718' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-88805a1c-23b0-4ac8-b257-0749f3f67a57' class='xr-var-data-in' type='checkbox'><label for='data-88805a1c-23b0-4ac8-b257-0749f3f67a57' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;EEG 001&#x27;, &#x27;EEG 002&#x27;, &#x27;EEG 003&#x27;, &#x27;EEG 004&#x27;, &#x27;EEG 005&#x27;, &#x27;EEG 006&#x27;,
           &#x27;EEG 007&#x27;, &#x27;EEG 008&#x27;, &#x27;EEG 009&#x27;, &#x27;EEG 010&#x27;, &#x27;EEG 011&#x27;, &#x27;EEG 012&#x27;,
           &#x27;EEG 013&#x27;, &#x27;EEG 014&#x27;, &#x27;EEG 015&#x27;, &#x27;EEG 016&#x27;, &#x27;EEG 017&#x27;, &#x27;EEG 018&#x27;,
           &#x27;EEG 019&#x27;, &#x27;EEG 020&#x27;, &#x27;EEG 021&#x27;, &#x27;EEG 022&#x27;, &#x27;EEG 023&#x27;, &#x27;EEG 024&#x27;,
           &#x27;EEG 025&#x27;, &#x27;EEG 026&#x27;, &#x27;EEG 027&#x27;, &#x27;EEG 028&#x27;, &#x27;EEG 029&#x27;, &#x27;EEG 030&#x27;,
           &#x27;EEG 031&#x27;, &#x27;EEG 032&#x27;, &#x27;EEG 033&#x27;, &#x27;EEG 034&#x27;, &#x27;EEG 035&#x27;, &#x27;EEG 036&#x27;,
           &#x27;EEG 037&#x27;, &#x27;EEG 038&#x27;, &#x27;EEG 039&#x27;, &#x27;EEG 040&#x27;, &#x27;EEG 041&#x27;, &#x27;EEG 042&#x27;,
           &#x27;EEG 043&#x27;, &#x27;EEG 044&#x27;, &#x27;EEG 045&#x27;, &#x27;EEG 046&#x27;, &#x27;EEG 047&#x27;, &#x27;EEG 048&#x27;,
           &#x27;EEG 049&#x27;, &#x27;EEG 050&#x27;, &#x27;EEG 051&#x27;, &#x27;EEG 052&#x27;, &#x27;EEG 053&#x27;, &#x27;EEG 054&#x27;,
           &#x27;EEG 055&#x27;, &#x27;EEG 056&#x27;, &#x27;EEG 057&#x27;, &#x27;EEG 058&#x27;, &#x27;EEG 059&#x27;, &#x27;EEG 060&#x27;],
          dtype=&#x27;&lt;U7&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-15a922b8-b8f4-4c52-8c64-41ad9529ccac' class='xr-section-summary-in' type='checkbox'  ><label for='section-15a922b8-b8f4-4c52-8c64-41ad9529ccac' class='xr-section-summary' >Indexes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>ch</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-a4113541-2b6f-40cd-9ba7-bf0a84acb817' class='xr-index-data-in' type='checkbox'/><label for='index-a4113541-2b6f-40cd-9ba7-bf0a84acb817' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;EEG 001&#x27;, &#x27;EEG 002&#x27;, &#x27;EEG 003&#x27;, &#x27;EEG 004&#x27;, &#x27;EEG 005&#x27;, &#x27;EEG 006&#x27;,
           &#x27;EEG 007&#x27;, &#x27;EEG 008&#x27;, &#x27;EEG 009&#x27;, &#x27;EEG 010&#x27;, &#x27;EEG 011&#x27;, &#x27;EEG 012&#x27;,
           &#x27;EEG 013&#x27;, &#x27;EEG 014&#x27;, &#x27;EEG 015&#x27;, &#x27;EEG 016&#x27;, &#x27;EEG 017&#x27;, &#x27;EEG 018&#x27;,
           &#x27;EEG 019&#x27;, &#x27;EEG 020&#x27;, &#x27;EEG 021&#x27;, &#x27;EEG 022&#x27;, &#x27;EEG 023&#x27;, &#x27;EEG 024&#x27;,
           &#x27;EEG 025&#x27;, &#x27;EEG 026&#x27;, &#x27;EEG 027&#x27;, &#x27;EEG 028&#x27;, &#x27;EEG 029&#x27;, &#x27;EEG 030&#x27;,
           &#x27;EEG 031&#x27;, &#x27;EEG 032&#x27;, &#x27;EEG 033&#x27;, &#x27;EEG 034&#x27;, &#x27;EEG 035&#x27;, &#x27;EEG 036&#x27;,
           &#x27;EEG 037&#x27;, &#x27;EEG 038&#x27;, &#x27;EEG 039&#x27;, &#x27;EEG 040&#x27;, &#x27;EEG 041&#x27;, &#x27;EEG 042&#x27;,
           &#x27;EEG 043&#x27;, &#x27;EEG 044&#x27;, &#x27;EEG 045&#x27;, &#x27;EEG 046&#x27;, &#x27;EEG 047&#x27;, &#x27;EEG 048&#x27;,
           &#x27;EEG 049&#x27;, &#x27;EEG 050&#x27;, &#x27;EEG 051&#x27;, &#x27;EEG 052&#x27;, &#x27;EEG 053&#x27;, &#x27;EEG 054&#x27;,
           &#x27;EEG 055&#x27;, &#x27;EEG 056&#x27;, &#x27;EEG 057&#x27;, &#x27;EEG 058&#x27;, &#x27;EEG 059&#x27;, &#x27;EEG 060&#x27;],
          dtype=&#x27;object&#x27;, name=&#x27;ch&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-71b644b7-6f92-4ffe-961f-31c425d4db38' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-71b644b7-6f92-4ffe-961f-31c425d4db38' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 260-268

e) Identify noisy sensors part 2
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Next, we define a threshold :math:`\tau^{p}` (:math:`p` for percentile;
default, ``.20``) as a cutoff point for determining if a sensor should be marked
artifactual. The sensor :math:`i` is flagged as noisy if
:math:`c^{\mu_e}_i > \tau^{p}`. That is, if the sensor is an outlier for more than
:math:`\tau^{p}` percent of the epochs, it is flagged as noisy.

.. GENERATED FROM PYTHON SOURCE LINES 268-272

.. code-block:: default

    p_threshold = config["ch_ch_sd"]["flag_crit"]  # 0.3, or 30%
    noisy_chs = percent_outliers[percent_outliers > p_threshold].coords.to_index().values
    noisy_chs





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    array(['EEG 001', 'EEG 002'], dtype=object)



.. GENERATED FROM PYTHON SOURCE LINES 273-277

f) Add the noisy sensors to the pipeline flags
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Let's add the noisy sensors to the pipeline flags.

.. GENERATED FROM PYTHON SOURCE LINES 277-281

.. code-block:: default

    pipeline.flags["ch"].add_flag_cat(kind="ch_sd", bad_ch_names=noisy_chs)
    pipeline.raw.info["bads"].extend(pipeline.flags["ch"]["ch_sd"].tolist())
    pipeline.flags["ch"]





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    Flagged channels: |
      Noisy: ['EEG 001' 'EEG 002']
      Bridged: None
      Uncorrelated: None
      Rank: None




.. GENERATED FROM PYTHON SOURCE LINES 282-289

.. _noisy_epochs:

Flag Noisy Epochs
-----------------

This step closely resembles the :ref:`noisy_sensors` step. For the sake of brevity
we will be more concise in the documentation.

.. GENERATED FROM PYTHON SOURCE LINES 292-298

.. figure:: https://raw.githubusercontent.com/scott-huberty/wip_pipeline-figures/main/Flag_noisy_epochs.png
   :align: center

   Flag Noisy Epochs. The figure shows the steps for flagging noisy epochs. See the text below
   for descriptions of mathematical notation.


.. GENERATED FROM PYTHON SOURCE LINES 301-306

a) Take standard deviation across the samples dimension :math:`t`
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Take a moment below to notice that the sensors flagged in the prior setp are not in
``epochs_xr`` below:

.. GENERATED FROM PYTHON SOURCE LINES 306-312

.. code-block:: default

    epochs = pipeline.get_epochs()
    # Let's make our epochs array into a named Array
    epochs_xr = epochs_to_xr(epochs, kind="ch")
    trim_ch_sd = epochs_xr.std("time")
    trim_ch_sd.coords["ch"]





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    üßπ Epoching..
    Not setting metadata
    19 matching events found
    No baseline correction applied
    0 projection items activated
    Using data from preloaded Raw for 19 events and 601 original time points ...
    0 bad epochs dropped
    üîç Detecting channels to leave out of reference.
    EEG channel type selected for re-referencing
    Applying a custom ('EEG',) reference.


.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
    <defs>
    <symbol id="icon-database" viewBox="0 0 32 32">
    <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
    <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    </symbol>
    <symbol id="icon-file-text2" viewBox="0 0 32 32">
    <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
    <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    </symbol>
    </defs>
    </svg>
    <style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
     *
     */

    :root {
      --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
      --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
      --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
      --xr-border-color: var(--jp-border-color2, #e0e0e0);
      --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
      --xr-background-color: var(--jp-layout-color0, white);
      --xr-background-color-row-even: var(--jp-layout-color1, white);
      --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
    }

    html[theme=dark],
    body[data-theme=dark],
    body.vscode-dark {
      --xr-font-color0: rgba(255, 255, 255, 1);
      --xr-font-color2: rgba(255, 255, 255, 0.54);
      --xr-font-color3: rgba(255, 255, 255, 0.38);
      --xr-border-color: #1F1F1F;
      --xr-disabled-color: #515151;
      --xr-background-color: #111111;
      --xr-background-color-row-even: #111111;
      --xr-background-color-row-odd: #313131;
    }

    .xr-wrap {
      display: block !important;
      min-width: 300px;
      max-width: 700px;
    }

    .xr-text-repr-fallback {
      /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
      display: none;
    }

    .xr-header {
      padding-top: 6px;
      padding-bottom: 6px;
      margin-bottom: 4px;
      border-bottom: solid 1px var(--xr-border-color);
    }

    .xr-header > div,
    .xr-header > ul {
      display: inline;
      margin-top: 0;
      margin-bottom: 0;
    }

    .xr-obj-type,
    .xr-array-name {
      margin-left: 2px;
      margin-right: 10px;
    }

    .xr-obj-type {
      color: var(--xr-font-color2);
    }

    .xr-sections {
      padding-left: 0 !important;
      display: grid;
      grid-template-columns: 150px auto auto 1fr 20px 20px;
    }

    .xr-section-item {
      display: contents;
    }

    .xr-section-item input {
      display: none;
    }

    .xr-section-item input + label {
      color: var(--xr-disabled-color);
    }

    .xr-section-item input:enabled + label {
      cursor: pointer;
      color: var(--xr-font-color2);
    }

    .xr-section-item input:enabled + label:hover {
      color: var(--xr-font-color0);
    }

    .xr-section-summary {
      grid-column: 1;
      color: var(--xr-font-color2);
      font-weight: 500;
    }

    .xr-section-summary > span {
      display: inline-block;
      padding-left: 0.5em;
    }

    .xr-section-summary-in:disabled + label {
      color: var(--xr-font-color2);
    }

    .xr-section-summary-in + label:before {
      display: inline-block;
      content: '‚ñ∫';
      font-size: 11px;
      width: 15px;
      text-align: center;
    }

    .xr-section-summary-in:disabled + label:before {
      color: var(--xr-disabled-color);
    }

    .xr-section-summary-in:checked + label:before {
      content: '‚ñº';
    }

    .xr-section-summary-in:checked + label > span {
      display: none;
    }

    .xr-section-summary,
    .xr-section-inline-details {
      padding-top: 4px;
      padding-bottom: 4px;
    }

    .xr-section-inline-details {
      grid-column: 2 / -1;
    }

    .xr-section-details {
      display: none;
      grid-column: 1 / -1;
      margin-bottom: 5px;
    }

    .xr-section-summary-in:checked ~ .xr-section-details {
      display: contents;
    }

    .xr-array-wrap {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 20px auto;
    }

    .xr-array-wrap > label {
      grid-column: 1;
      vertical-align: top;
    }

    .xr-preview {
      color: var(--xr-font-color3);
    }

    .xr-array-preview,
    .xr-array-data {
      padding: 0 5px !important;
      grid-column: 2;
    }

    .xr-array-data,
    .xr-array-in:checked ~ .xr-array-preview {
      display: none;
    }

    .xr-array-in:checked ~ .xr-array-data,
    .xr-array-preview {
      display: inline-block;
    }

    .xr-dim-list {
      display: inline-block !important;
      list-style: none;
      padding: 0 !important;
      margin: 0;
    }

    .xr-dim-list li {
      display: inline-block;
      padding: 0;
      margin: 0;
    }

    .xr-dim-list:before {
      content: '(';
    }

    .xr-dim-list:after {
      content: ')';
    }

    .xr-dim-list li:not(:last-child):after {
      content: ',';
      padding-right: 5px;
    }

    .xr-has-index {
      font-weight: bold;
    }

    .xr-var-list,
    .xr-var-item {
      display: contents;
    }

    .xr-var-item > div,
    .xr-var-item label,
    .xr-var-item > .xr-var-name span {
      background-color: var(--xr-background-color-row-even);
      margin-bottom: 0;
    }

    .xr-var-item > .xr-var-name:hover span {
      padding-right: 5px;
    }

    .xr-var-list > li:nth-child(odd) > div,
    .xr-var-list > li:nth-child(odd) > label,
    .xr-var-list > li:nth-child(odd) > .xr-var-name span {
      background-color: var(--xr-background-color-row-odd);
    }

    .xr-var-name {
      grid-column: 1;
    }

    .xr-var-dims {
      grid-column: 2;
    }

    .xr-var-dtype {
      grid-column: 3;
      text-align: right;
      color: var(--xr-font-color2);
    }

    .xr-var-preview {
      grid-column: 4;
    }

    .xr-index-preview {
      grid-column: 2 / 5;
      color: var(--xr-font-color2);
    }

    .xr-var-name,
    .xr-var-dims,
    .xr-var-dtype,
    .xr-preview,
    .xr-attrs dt {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-right: 10px;
    }

    .xr-var-name:hover,
    .xr-var-dims:hover,
    .xr-var-dtype:hover,
    .xr-attrs dt:hover {
      overflow: visible;
      width: auto;
      z-index: 1;
    }

    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      display: none;
      background-color: var(--xr-background-color) !important;
      padding-bottom: 5px !important;
    }

    .xr-var-attrs-in:checked ~ .xr-var-attrs,
    .xr-var-data-in:checked ~ .xr-var-data,
    .xr-index-data-in:checked ~ .xr-index-data {
      display: block;
    }

    .xr-var-data > table {
      float: right;
    }

    .xr-var-name span,
    .xr-var-data,
    .xr-index-name div,
    .xr-index-data,
    .xr-attrs {
      padding-left: 25px !important;
    }

    .xr-attrs,
    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      grid-column: 1 / -1;
    }

    dl.xr-attrs {
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: 125px auto;
    }

    .xr-attrs dt,
    .xr-attrs dd {
      padding: 0;
      margin: 0;
      float: left;
      padding-right: 10px;
      width: auto;
    }

    .xr-attrs dt {
      font-weight: normal;
      grid-column: 1;
    }

    .xr-attrs dt:hover span {
      display: inline-block;
      background: var(--xr-background-color);
      padding-right: 10px;
    }

    .xr-attrs dd {
      grid-column: 2;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .xr-icon-database,
    .xr-icon-file-text2,
    .xr-no-icon {
      display: inline-block;
      vertical-align: middle;
      width: 1em;
      height: 1.5em !important;
      stroke-width: 0;
      stroke: currentColor;
      fill: currentColor;
    }
    </style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;ch&#x27; (ch: 58)&gt;
    array([&#x27;EEG 003&#x27;, &#x27;EEG 004&#x27;, &#x27;EEG 005&#x27;, &#x27;EEG 006&#x27;, &#x27;EEG 007&#x27;, &#x27;EEG 008&#x27;,
           &#x27;EEG 009&#x27;, &#x27;EEG 010&#x27;, &#x27;EEG 011&#x27;, &#x27;EEG 012&#x27;, &#x27;EEG 013&#x27;, &#x27;EEG 014&#x27;,
           &#x27;EEG 015&#x27;, &#x27;EEG 016&#x27;, &#x27;EEG 017&#x27;, &#x27;EEG 018&#x27;, &#x27;EEG 019&#x27;, &#x27;EEG 020&#x27;,
           &#x27;EEG 021&#x27;, &#x27;EEG 022&#x27;, &#x27;EEG 023&#x27;, &#x27;EEG 024&#x27;, &#x27;EEG 025&#x27;, &#x27;EEG 026&#x27;,
           &#x27;EEG 027&#x27;, &#x27;EEG 028&#x27;, &#x27;EEG 029&#x27;, &#x27;EEG 030&#x27;, &#x27;EEG 031&#x27;, &#x27;EEG 032&#x27;,
           &#x27;EEG 033&#x27;, &#x27;EEG 034&#x27;, &#x27;EEG 035&#x27;, &#x27;EEG 036&#x27;, &#x27;EEG 037&#x27;, &#x27;EEG 038&#x27;,
           &#x27;EEG 039&#x27;, &#x27;EEG 040&#x27;, &#x27;EEG 041&#x27;, &#x27;EEG 042&#x27;, &#x27;EEG 043&#x27;, &#x27;EEG 044&#x27;,
           &#x27;EEG 045&#x27;, &#x27;EEG 046&#x27;, &#x27;EEG 047&#x27;, &#x27;EEG 048&#x27;, &#x27;EEG 049&#x27;, &#x27;EEG 050&#x27;,
           &#x27;EEG 051&#x27;, &#x27;EEG 052&#x27;, &#x27;EEG 053&#x27;, &#x27;EEG 054&#x27;, &#x27;EEG 055&#x27;, &#x27;EEG 056&#x27;,
           &#x27;EEG 057&#x27;, &#x27;EEG 058&#x27;, &#x27;EEG 059&#x27;, &#x27;EEG 060&#x27;], dtype=&#x27;&lt;U7&#x27;)
    Coordinates:
      * ch       (ch) &lt;U7 &#x27;EEG 003&#x27; &#x27;EEG 004&#x27; &#x27;EEG 005&#x27; ... &#x27;EEG 059&#x27; &#x27;EEG 060&#x27;</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'ch'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>ch</span>: 58</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-8ad762c1-a330-4154-99ae-5df9755734ed' class='xr-array-in' type='checkbox' checked><label for='section-8ad762c1-a330-4154-99ae-5df9755734ed' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>&#x27;EEG 003&#x27; &#x27;EEG 004&#x27; &#x27;EEG 005&#x27; ... &#x27;EEG 058&#x27; &#x27;EEG 059&#x27; &#x27;EEG 060&#x27;</span></div><div class='xr-array-data'><pre>array([&#x27;EEG 003&#x27;, &#x27;EEG 004&#x27;, &#x27;EEG 005&#x27;, &#x27;EEG 006&#x27;, &#x27;EEG 007&#x27;, &#x27;EEG 008&#x27;,
           &#x27;EEG 009&#x27;, &#x27;EEG 010&#x27;, &#x27;EEG 011&#x27;, &#x27;EEG 012&#x27;, &#x27;EEG 013&#x27;, &#x27;EEG 014&#x27;,
           &#x27;EEG 015&#x27;, &#x27;EEG 016&#x27;, &#x27;EEG 017&#x27;, &#x27;EEG 018&#x27;, &#x27;EEG 019&#x27;, &#x27;EEG 020&#x27;,
           &#x27;EEG 021&#x27;, &#x27;EEG 022&#x27;, &#x27;EEG 023&#x27;, &#x27;EEG 024&#x27;, &#x27;EEG 025&#x27;, &#x27;EEG 026&#x27;,
           &#x27;EEG 027&#x27;, &#x27;EEG 028&#x27;, &#x27;EEG 029&#x27;, &#x27;EEG 030&#x27;, &#x27;EEG 031&#x27;, &#x27;EEG 032&#x27;,
           &#x27;EEG 033&#x27;, &#x27;EEG 034&#x27;, &#x27;EEG 035&#x27;, &#x27;EEG 036&#x27;, &#x27;EEG 037&#x27;, &#x27;EEG 038&#x27;,
           &#x27;EEG 039&#x27;, &#x27;EEG 040&#x27;, &#x27;EEG 041&#x27;, &#x27;EEG 042&#x27;, &#x27;EEG 043&#x27;, &#x27;EEG 044&#x27;,
           &#x27;EEG 045&#x27;, &#x27;EEG 046&#x27;, &#x27;EEG 047&#x27;, &#x27;EEG 048&#x27;, &#x27;EEG 049&#x27;, &#x27;EEG 050&#x27;,
           &#x27;EEG 051&#x27;, &#x27;EEG 052&#x27;, &#x27;EEG 053&#x27;, &#x27;EEG 054&#x27;, &#x27;EEG 055&#x27;, &#x27;EEG 056&#x27;,
           &#x27;EEG 057&#x27;, &#x27;EEG 058&#x27;, &#x27;EEG 059&#x27;, &#x27;EEG 060&#x27;], dtype=&#x27;&lt;U7&#x27;)</pre></div></div></li><li class='xr-section-item'><input id='section-dfebca1c-f776-4096-9a00-e5417cf73cb1' class='xr-section-summary-in' type='checkbox'  checked><label for='section-dfebca1c-f776-4096-9a00-e5417cf73cb1' class='xr-section-summary' >Coordinates: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>ch</span></div><div class='xr-var-dims'>(ch)</div><div class='xr-var-dtype'>&lt;U7</div><div class='xr-var-preview xr-preview'>&#x27;EEG 003&#x27; &#x27;EEG 004&#x27; ... &#x27;EEG 060&#x27;</div><input id='attrs-006420c8-bcc0-4212-bbb3-b18773e751bb' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-006420c8-bcc0-4212-bbb3-b18773e751bb' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-24fa0e4f-0984-4f07-a75a-28e7852355cc' class='xr-var-data-in' type='checkbox'><label for='data-24fa0e4f-0984-4f07-a75a-28e7852355cc' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;EEG 003&#x27;, &#x27;EEG 004&#x27;, &#x27;EEG 005&#x27;, &#x27;EEG 006&#x27;, &#x27;EEG 007&#x27;, &#x27;EEG 008&#x27;,
           &#x27;EEG 009&#x27;, &#x27;EEG 010&#x27;, &#x27;EEG 011&#x27;, &#x27;EEG 012&#x27;, &#x27;EEG 013&#x27;, &#x27;EEG 014&#x27;,
           &#x27;EEG 015&#x27;, &#x27;EEG 016&#x27;, &#x27;EEG 017&#x27;, &#x27;EEG 018&#x27;, &#x27;EEG 019&#x27;, &#x27;EEG 020&#x27;,
           &#x27;EEG 021&#x27;, &#x27;EEG 022&#x27;, &#x27;EEG 023&#x27;, &#x27;EEG 024&#x27;, &#x27;EEG 025&#x27;, &#x27;EEG 026&#x27;,
           &#x27;EEG 027&#x27;, &#x27;EEG 028&#x27;, &#x27;EEG 029&#x27;, &#x27;EEG 030&#x27;, &#x27;EEG 031&#x27;, &#x27;EEG 032&#x27;,
           &#x27;EEG 033&#x27;, &#x27;EEG 034&#x27;, &#x27;EEG 035&#x27;, &#x27;EEG 036&#x27;, &#x27;EEG 037&#x27;, &#x27;EEG 038&#x27;,
           &#x27;EEG 039&#x27;, &#x27;EEG 040&#x27;, &#x27;EEG 041&#x27;, &#x27;EEG 042&#x27;, &#x27;EEG 043&#x27;, &#x27;EEG 044&#x27;,
           &#x27;EEG 045&#x27;, &#x27;EEG 046&#x27;, &#x27;EEG 047&#x27;, &#x27;EEG 048&#x27;, &#x27;EEG 049&#x27;, &#x27;EEG 050&#x27;,
           &#x27;EEG 051&#x27;, &#x27;EEG 052&#x27;, &#x27;EEG 053&#x27;, &#x27;EEG 054&#x27;, &#x27;EEG 055&#x27;, &#x27;EEG 056&#x27;,
           &#x27;EEG 057&#x27;, &#x27;EEG 058&#x27;, &#x27;EEG 059&#x27;, &#x27;EEG 060&#x27;], dtype=&#x27;&lt;U7&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-578199ce-6270-4e3f-babf-af5e7fe5bffb' class='xr-section-summary-in' type='checkbox'  ><label for='section-578199ce-6270-4e3f-babf-af5e7fe5bffb' class='xr-section-summary' >Indexes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>ch</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-9b5ae6a6-e268-48cf-8262-bc17ff6cc89e' class='xr-index-data-in' type='checkbox'/><label for='index-9b5ae6a6-e268-48cf-8262-bc17ff6cc89e' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;EEG 003&#x27;, &#x27;EEG 004&#x27;, &#x27;EEG 005&#x27;, &#x27;EEG 006&#x27;, &#x27;EEG 007&#x27;, &#x27;EEG 008&#x27;,
           &#x27;EEG 009&#x27;, &#x27;EEG 010&#x27;, &#x27;EEG 011&#x27;, &#x27;EEG 012&#x27;, &#x27;EEG 013&#x27;, &#x27;EEG 014&#x27;,
           &#x27;EEG 015&#x27;, &#x27;EEG 016&#x27;, &#x27;EEG 017&#x27;, &#x27;EEG 018&#x27;, &#x27;EEG 019&#x27;, &#x27;EEG 020&#x27;,
           &#x27;EEG 021&#x27;, &#x27;EEG 022&#x27;, &#x27;EEG 023&#x27;, &#x27;EEG 024&#x27;, &#x27;EEG 025&#x27;, &#x27;EEG 026&#x27;,
           &#x27;EEG 027&#x27;, &#x27;EEG 028&#x27;, &#x27;EEG 029&#x27;, &#x27;EEG 030&#x27;, &#x27;EEG 031&#x27;, &#x27;EEG 032&#x27;,
           &#x27;EEG 033&#x27;, &#x27;EEG 034&#x27;, &#x27;EEG 035&#x27;, &#x27;EEG 036&#x27;, &#x27;EEG 037&#x27;, &#x27;EEG 038&#x27;,
           &#x27;EEG 039&#x27;, &#x27;EEG 040&#x27;, &#x27;EEG 041&#x27;, &#x27;EEG 042&#x27;, &#x27;EEG 043&#x27;, &#x27;EEG 044&#x27;,
           &#x27;EEG 045&#x27;, &#x27;EEG 046&#x27;, &#x27;EEG 047&#x27;, &#x27;EEG 048&#x27;, &#x27;EEG 049&#x27;, &#x27;EEG 050&#x27;,
           &#x27;EEG 051&#x27;, &#x27;EEG 052&#x27;, &#x27;EEG 053&#x27;, &#x27;EEG 054&#x27;, &#x27;EEG 055&#x27;, &#x27;EEG 056&#x27;,
           &#x27;EEG 057&#x27;, &#x27;EEG 058&#x27;, &#x27;EEG 059&#x27;, &#x27;EEG 060&#x27;],
          dtype=&#x27;object&#x27;, name=&#x27;ch&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-017bd173-7b0a-4e34-b402-73d15b57b0d9' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-017bd173-7b0a-4e34-b402-73d15b57b0d9' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 313-325

b) Compute 50th and 75th quantile across epochs and the UQR
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Like before, We Take the median and 70th quantile, but now we operate across epochs,
resulting in two 1D vector's of size ``n_good_sensors`` :math:`S_\mathcal{G}`

.. math::
   X^{{\sigma}_t{Q50^e}} = Q50^e(X^{\sigma_{t}}) \in \mathbb{R}^{S_\mathcal{G}}
.. math::
   X^{{\sigma}_t{Q75^e}} = Q75^e(X^{\sigma_{t}}) \in \mathbb{R}^{S_\mathcal{G}}
.. math::
   UQR^e = (X^{{\sigma}_T{Q75}^e} - X^{{\sigma}_T{Q50}^e})

.. GENERATED FROM PYTHON SOURCE LINES 328-335

c) Define sensor-specific thresholds for rejecting epochs :math:`\tau^e_i`
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Our sensor-specifc threshold for rejecting epochs is defined by:

.. math::
   \tau^e_i = X^{{\sigma}_T{Q50}^e} + UQR^e\times k

.. GENERATED FROM PYTHON SOURCE LINES 335-339

.. code-block:: default

    q50, q75 = trim_ch_sd.quantile([0.5, 0.75], dim="epoch")
    uqr_epoch = q75 - q50
    uqr_epoch






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
    <defs>
    <symbol id="icon-database" viewBox="0 0 32 32">
    <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
    <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    </symbol>
    <symbol id="icon-file-text2" viewBox="0 0 32 32">
    <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
    <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    </symbol>
    </defs>
    </svg>
    <style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
     *
     */

    :root {
      --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
      --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
      --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
      --xr-border-color: var(--jp-border-color2, #e0e0e0);
      --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
      --xr-background-color: var(--jp-layout-color0, white);
      --xr-background-color-row-even: var(--jp-layout-color1, white);
      --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
    }

    html[theme=dark],
    body[data-theme=dark],
    body.vscode-dark {
      --xr-font-color0: rgba(255, 255, 255, 1);
      --xr-font-color2: rgba(255, 255, 255, 0.54);
      --xr-font-color3: rgba(255, 255, 255, 0.38);
      --xr-border-color: #1F1F1F;
      --xr-disabled-color: #515151;
      --xr-background-color: #111111;
      --xr-background-color-row-even: #111111;
      --xr-background-color-row-odd: #313131;
    }

    .xr-wrap {
      display: block !important;
      min-width: 300px;
      max-width: 700px;
    }

    .xr-text-repr-fallback {
      /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
      display: none;
    }

    .xr-header {
      padding-top: 6px;
      padding-bottom: 6px;
      margin-bottom: 4px;
      border-bottom: solid 1px var(--xr-border-color);
    }

    .xr-header > div,
    .xr-header > ul {
      display: inline;
      margin-top: 0;
      margin-bottom: 0;
    }

    .xr-obj-type,
    .xr-array-name {
      margin-left: 2px;
      margin-right: 10px;
    }

    .xr-obj-type {
      color: var(--xr-font-color2);
    }

    .xr-sections {
      padding-left: 0 !important;
      display: grid;
      grid-template-columns: 150px auto auto 1fr 20px 20px;
    }

    .xr-section-item {
      display: contents;
    }

    .xr-section-item input {
      display: none;
    }

    .xr-section-item input + label {
      color: var(--xr-disabled-color);
    }

    .xr-section-item input:enabled + label {
      cursor: pointer;
      color: var(--xr-font-color2);
    }

    .xr-section-item input:enabled + label:hover {
      color: var(--xr-font-color0);
    }

    .xr-section-summary {
      grid-column: 1;
      color: var(--xr-font-color2);
      font-weight: 500;
    }

    .xr-section-summary > span {
      display: inline-block;
      padding-left: 0.5em;
    }

    .xr-section-summary-in:disabled + label {
      color: var(--xr-font-color2);
    }

    .xr-section-summary-in + label:before {
      display: inline-block;
      content: '‚ñ∫';
      font-size: 11px;
      width: 15px;
      text-align: center;
    }

    .xr-section-summary-in:disabled + label:before {
      color: var(--xr-disabled-color);
    }

    .xr-section-summary-in:checked + label:before {
      content: '‚ñº';
    }

    .xr-section-summary-in:checked + label > span {
      display: none;
    }

    .xr-section-summary,
    .xr-section-inline-details {
      padding-top: 4px;
      padding-bottom: 4px;
    }

    .xr-section-inline-details {
      grid-column: 2 / -1;
    }

    .xr-section-details {
      display: none;
      grid-column: 1 / -1;
      margin-bottom: 5px;
    }

    .xr-section-summary-in:checked ~ .xr-section-details {
      display: contents;
    }

    .xr-array-wrap {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 20px auto;
    }

    .xr-array-wrap > label {
      grid-column: 1;
      vertical-align: top;
    }

    .xr-preview {
      color: var(--xr-font-color3);
    }

    .xr-array-preview,
    .xr-array-data {
      padding: 0 5px !important;
      grid-column: 2;
    }

    .xr-array-data,
    .xr-array-in:checked ~ .xr-array-preview {
      display: none;
    }

    .xr-array-in:checked ~ .xr-array-data,
    .xr-array-preview {
      display: inline-block;
    }

    .xr-dim-list {
      display: inline-block !important;
      list-style: none;
      padding: 0 !important;
      margin: 0;
    }

    .xr-dim-list li {
      display: inline-block;
      padding: 0;
      margin: 0;
    }

    .xr-dim-list:before {
      content: '(';
    }

    .xr-dim-list:after {
      content: ')';
    }

    .xr-dim-list li:not(:last-child):after {
      content: ',';
      padding-right: 5px;
    }

    .xr-has-index {
      font-weight: bold;
    }

    .xr-var-list,
    .xr-var-item {
      display: contents;
    }

    .xr-var-item > div,
    .xr-var-item label,
    .xr-var-item > .xr-var-name span {
      background-color: var(--xr-background-color-row-even);
      margin-bottom: 0;
    }

    .xr-var-item > .xr-var-name:hover span {
      padding-right: 5px;
    }

    .xr-var-list > li:nth-child(odd) > div,
    .xr-var-list > li:nth-child(odd) > label,
    .xr-var-list > li:nth-child(odd) > .xr-var-name span {
      background-color: var(--xr-background-color-row-odd);
    }

    .xr-var-name {
      grid-column: 1;
    }

    .xr-var-dims {
      grid-column: 2;
    }

    .xr-var-dtype {
      grid-column: 3;
      text-align: right;
      color: var(--xr-font-color2);
    }

    .xr-var-preview {
      grid-column: 4;
    }

    .xr-index-preview {
      grid-column: 2 / 5;
      color: var(--xr-font-color2);
    }

    .xr-var-name,
    .xr-var-dims,
    .xr-var-dtype,
    .xr-preview,
    .xr-attrs dt {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-right: 10px;
    }

    .xr-var-name:hover,
    .xr-var-dims:hover,
    .xr-var-dtype:hover,
    .xr-attrs dt:hover {
      overflow: visible;
      width: auto;
      z-index: 1;
    }

    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      display: none;
      background-color: var(--xr-background-color) !important;
      padding-bottom: 5px !important;
    }

    .xr-var-attrs-in:checked ~ .xr-var-attrs,
    .xr-var-data-in:checked ~ .xr-var-data,
    .xr-index-data-in:checked ~ .xr-index-data {
      display: block;
    }

    .xr-var-data > table {
      float: right;
    }

    .xr-var-name span,
    .xr-var-data,
    .xr-index-name div,
    .xr-index-data,
    .xr-attrs {
      padding-left: 25px !important;
    }

    .xr-attrs,
    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      grid-column: 1 / -1;
    }

    dl.xr-attrs {
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: 125px auto;
    }

    .xr-attrs dt,
    .xr-attrs dd {
      padding: 0;
      margin: 0;
      float: left;
      padding-right: 10px;
      width: auto;
    }

    .xr-attrs dt {
      font-weight: normal;
      grid-column: 1;
    }

    .xr-attrs dt:hover span {
      display: inline-block;
      background: var(--xr-background-color);
      padding-right: 10px;
    }

    .xr-attrs dd {
      grid-column: 2;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .xr-icon-database,
    .xr-icon-file-text2,
    .xr-no-icon {
      display: inline-block;
      vertical-align: middle;
      width: 1em;
      height: 1.5em !important;
      stroke-width: 0;
      stroke: currentColor;
      fill: currentColor;
    }
    </style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (ch: 58)&gt;
    array([8.29818761e-07, 3.34591601e-06, 3.67640410e-06, 1.35297092e-06,
           8.50413590e-06, 6.91786248e-08, 4.69592874e-07, 6.76865783e-07,
           4.16057474e-07, 3.58207163e-07, 5.15843769e-07, 4.04562276e-07,
           1.44940681e-06, 2.08037267e-07, 4.82564471e-07, 1.61894841e-07,
           7.73969476e-08, 1.49708270e-07, 1.58099701e-07, 1.19148369e-07,
           9.68870448e-08, 2.80417610e-07, 3.07829046e-07, 3.18655769e-07,
           9.62263046e-08, 7.26675369e-08, 1.22401095e-06, 8.18916361e-08,
           1.78953890e-07, 1.27239198e-07, 5.86520384e-08, 2.08562461e-07,
           1.21390091e-07, 3.06647970e-07, 2.72332668e-07, 1.06578238e-07,
           6.27519394e-08, 9.77273618e-08, 1.68174860e-07, 1.22557753e-07,
           5.88796005e-07, 3.48372014e-07, 2.13806710e-07, 1.19009385e-07,
           2.53772401e-07, 7.05876089e-08, 1.21862255e-07, 1.01071084e-07,
           1.00586261e-07, 2.62792622e-07, 1.57019747e-07, 1.57019747e-07,
           1.81274564e-07, 3.00407521e-07, 1.44776579e-07, 2.10022312e-07,
           2.23607817e-07, 3.57043933e-07])
    Coordinates:
      * ch       (ch) &lt;U7 &#x27;EEG 003&#x27; &#x27;EEG 004&#x27; &#x27;EEG 005&#x27; ... &#x27;EEG 059&#x27; &#x27;EEG 060&#x27;</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>ch</span>: 58</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-35992e68-ac87-4462-961b-ba6e8d45ac86' class='xr-array-in' type='checkbox' checked><label for='section-35992e68-ac87-4462-961b-ba6e8d45ac86' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>8.298e-07 3.346e-06 3.676e-06 1.353e-06 ... 2.1e-07 2.236e-07 3.57e-07</span></div><div class='xr-array-data'><pre>array([8.29818761e-07, 3.34591601e-06, 3.67640410e-06, 1.35297092e-06,
           8.50413590e-06, 6.91786248e-08, 4.69592874e-07, 6.76865783e-07,
           4.16057474e-07, 3.58207163e-07, 5.15843769e-07, 4.04562276e-07,
           1.44940681e-06, 2.08037267e-07, 4.82564471e-07, 1.61894841e-07,
           7.73969476e-08, 1.49708270e-07, 1.58099701e-07, 1.19148369e-07,
           9.68870448e-08, 2.80417610e-07, 3.07829046e-07, 3.18655769e-07,
           9.62263046e-08, 7.26675369e-08, 1.22401095e-06, 8.18916361e-08,
           1.78953890e-07, 1.27239198e-07, 5.86520384e-08, 2.08562461e-07,
           1.21390091e-07, 3.06647970e-07, 2.72332668e-07, 1.06578238e-07,
           6.27519394e-08, 9.77273618e-08, 1.68174860e-07, 1.22557753e-07,
           5.88796005e-07, 3.48372014e-07, 2.13806710e-07, 1.19009385e-07,
           2.53772401e-07, 7.05876089e-08, 1.21862255e-07, 1.01071084e-07,
           1.00586261e-07, 2.62792622e-07, 1.57019747e-07, 1.57019747e-07,
           1.81274564e-07, 3.00407521e-07, 1.44776579e-07, 2.10022312e-07,
           2.23607817e-07, 3.57043933e-07])</pre></div></div></li><li class='xr-section-item'><input id='section-15bb5666-892e-42f9-94d6-8d76e1e28792' class='xr-section-summary-in' type='checkbox'  checked><label for='section-15bb5666-892e-42f9-94d6-8d76e1e28792' class='xr-section-summary' >Coordinates: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>ch</span></div><div class='xr-var-dims'>(ch)</div><div class='xr-var-dtype'>&lt;U7</div><div class='xr-var-preview xr-preview'>&#x27;EEG 003&#x27; &#x27;EEG 004&#x27; ... &#x27;EEG 060&#x27;</div><input id='attrs-0e13fe93-0dff-4275-9ca3-b3cb7c772464' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-0e13fe93-0dff-4275-9ca3-b3cb7c772464' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-59fe7b2f-c00f-49ea-adff-c27d82efd364' class='xr-var-data-in' type='checkbox'><label for='data-59fe7b2f-c00f-49ea-adff-c27d82efd364' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;EEG 003&#x27;, &#x27;EEG 004&#x27;, &#x27;EEG 005&#x27;, &#x27;EEG 006&#x27;, &#x27;EEG 007&#x27;, &#x27;EEG 008&#x27;,
           &#x27;EEG 009&#x27;, &#x27;EEG 010&#x27;, &#x27;EEG 011&#x27;, &#x27;EEG 012&#x27;, &#x27;EEG 013&#x27;, &#x27;EEG 014&#x27;,
           &#x27;EEG 015&#x27;, &#x27;EEG 016&#x27;, &#x27;EEG 017&#x27;, &#x27;EEG 018&#x27;, &#x27;EEG 019&#x27;, &#x27;EEG 020&#x27;,
           &#x27;EEG 021&#x27;, &#x27;EEG 022&#x27;, &#x27;EEG 023&#x27;, &#x27;EEG 024&#x27;, &#x27;EEG 025&#x27;, &#x27;EEG 026&#x27;,
           &#x27;EEG 027&#x27;, &#x27;EEG 028&#x27;, &#x27;EEG 029&#x27;, &#x27;EEG 030&#x27;, &#x27;EEG 031&#x27;, &#x27;EEG 032&#x27;,
           &#x27;EEG 033&#x27;, &#x27;EEG 034&#x27;, &#x27;EEG 035&#x27;, &#x27;EEG 036&#x27;, &#x27;EEG 037&#x27;, &#x27;EEG 038&#x27;,
           &#x27;EEG 039&#x27;, &#x27;EEG 040&#x27;, &#x27;EEG 041&#x27;, &#x27;EEG 042&#x27;, &#x27;EEG 043&#x27;, &#x27;EEG 044&#x27;,
           &#x27;EEG 045&#x27;, &#x27;EEG 046&#x27;, &#x27;EEG 047&#x27;, &#x27;EEG 048&#x27;, &#x27;EEG 049&#x27;, &#x27;EEG 050&#x27;,
           &#x27;EEG 051&#x27;, &#x27;EEG 052&#x27;, &#x27;EEG 053&#x27;, &#x27;EEG 054&#x27;, &#x27;EEG 055&#x27;, &#x27;EEG 056&#x27;,
           &#x27;EEG 057&#x27;, &#x27;EEG 058&#x27;, &#x27;EEG 059&#x27;, &#x27;EEG 060&#x27;], dtype=&#x27;&lt;U7&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-ab7021a9-819f-4373-b54b-af3175854146' class='xr-section-summary-in' type='checkbox'  ><label for='section-ab7021a9-819f-4373-b54b-af3175854146' class='xr-section-summary' >Indexes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>ch</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-ff806cf5-03ce-4b5f-ad6a-5caddc20eb7f' class='xr-index-data-in' type='checkbox'/><label for='index-ff806cf5-03ce-4b5f-ad6a-5caddc20eb7f' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;EEG 003&#x27;, &#x27;EEG 004&#x27;, &#x27;EEG 005&#x27;, &#x27;EEG 006&#x27;, &#x27;EEG 007&#x27;, &#x27;EEG 008&#x27;,
           &#x27;EEG 009&#x27;, &#x27;EEG 010&#x27;, &#x27;EEG 011&#x27;, &#x27;EEG 012&#x27;, &#x27;EEG 013&#x27;, &#x27;EEG 014&#x27;,
           &#x27;EEG 015&#x27;, &#x27;EEG 016&#x27;, &#x27;EEG 017&#x27;, &#x27;EEG 018&#x27;, &#x27;EEG 019&#x27;, &#x27;EEG 020&#x27;,
           &#x27;EEG 021&#x27;, &#x27;EEG 022&#x27;, &#x27;EEG 023&#x27;, &#x27;EEG 024&#x27;, &#x27;EEG 025&#x27;, &#x27;EEG 026&#x27;,
           &#x27;EEG 027&#x27;, &#x27;EEG 028&#x27;, &#x27;EEG 029&#x27;, &#x27;EEG 030&#x27;, &#x27;EEG 031&#x27;, &#x27;EEG 032&#x27;,
           &#x27;EEG 033&#x27;, &#x27;EEG 034&#x27;, &#x27;EEG 035&#x27;, &#x27;EEG 036&#x27;, &#x27;EEG 037&#x27;, &#x27;EEG 038&#x27;,
           &#x27;EEG 039&#x27;, &#x27;EEG 040&#x27;, &#x27;EEG 041&#x27;, &#x27;EEG 042&#x27;, &#x27;EEG 043&#x27;, &#x27;EEG 044&#x27;,
           &#x27;EEG 045&#x27;, &#x27;EEG 046&#x27;, &#x27;EEG 047&#x27;, &#x27;EEG 048&#x27;, &#x27;EEG 049&#x27;, &#x27;EEG 050&#x27;,
           &#x27;EEG 051&#x27;, &#x27;EEG 052&#x27;, &#x27;EEG 053&#x27;, &#x27;EEG 054&#x27;, &#x27;EEG 055&#x27;, &#x27;EEG 056&#x27;,
           &#x27;EEG 057&#x27;, &#x27;EEG 058&#x27;, &#x27;EEG 059&#x27;, &#x27;EEG 060&#x27;],
          dtype=&#x27;object&#x27;, name=&#x27;ch&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-2b49d6fe-a80f-4080-be09-b0325b5db5ad' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-2b49d6fe-a80f-4080-be09-b0325b5db5ad' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 340-344

.. code-block:: default

    k = 8
    upper_threshold = q50 + uqr_epoch * k
    upper_threshold






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
    <defs>
    <symbol id="icon-database" viewBox="0 0 32 32">
    <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
    <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    </symbol>
    <symbol id="icon-file-text2" viewBox="0 0 32 32">
    <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
    <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    </symbol>
    </defs>
    </svg>
    <style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
     *
     */

    :root {
      --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
      --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
      --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
      --xr-border-color: var(--jp-border-color2, #e0e0e0);
      --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
      --xr-background-color: var(--jp-layout-color0, white);
      --xr-background-color-row-even: var(--jp-layout-color1, white);
      --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
    }

    html[theme=dark],
    body[data-theme=dark],
    body.vscode-dark {
      --xr-font-color0: rgba(255, 255, 255, 1);
      --xr-font-color2: rgba(255, 255, 255, 0.54);
      --xr-font-color3: rgba(255, 255, 255, 0.38);
      --xr-border-color: #1F1F1F;
      --xr-disabled-color: #515151;
      --xr-background-color: #111111;
      --xr-background-color-row-even: #111111;
      --xr-background-color-row-odd: #313131;
    }

    .xr-wrap {
      display: block !important;
      min-width: 300px;
      max-width: 700px;
    }

    .xr-text-repr-fallback {
      /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
      display: none;
    }

    .xr-header {
      padding-top: 6px;
      padding-bottom: 6px;
      margin-bottom: 4px;
      border-bottom: solid 1px var(--xr-border-color);
    }

    .xr-header > div,
    .xr-header > ul {
      display: inline;
      margin-top: 0;
      margin-bottom: 0;
    }

    .xr-obj-type,
    .xr-array-name {
      margin-left: 2px;
      margin-right: 10px;
    }

    .xr-obj-type {
      color: var(--xr-font-color2);
    }

    .xr-sections {
      padding-left: 0 !important;
      display: grid;
      grid-template-columns: 150px auto auto 1fr 20px 20px;
    }

    .xr-section-item {
      display: contents;
    }

    .xr-section-item input {
      display: none;
    }

    .xr-section-item input + label {
      color: var(--xr-disabled-color);
    }

    .xr-section-item input:enabled + label {
      cursor: pointer;
      color: var(--xr-font-color2);
    }

    .xr-section-item input:enabled + label:hover {
      color: var(--xr-font-color0);
    }

    .xr-section-summary {
      grid-column: 1;
      color: var(--xr-font-color2);
      font-weight: 500;
    }

    .xr-section-summary > span {
      display: inline-block;
      padding-left: 0.5em;
    }

    .xr-section-summary-in:disabled + label {
      color: var(--xr-font-color2);
    }

    .xr-section-summary-in + label:before {
      display: inline-block;
      content: '‚ñ∫';
      font-size: 11px;
      width: 15px;
      text-align: center;
    }

    .xr-section-summary-in:disabled + label:before {
      color: var(--xr-disabled-color);
    }

    .xr-section-summary-in:checked + label:before {
      content: '‚ñº';
    }

    .xr-section-summary-in:checked + label > span {
      display: none;
    }

    .xr-section-summary,
    .xr-section-inline-details {
      padding-top: 4px;
      padding-bottom: 4px;
    }

    .xr-section-inline-details {
      grid-column: 2 / -1;
    }

    .xr-section-details {
      display: none;
      grid-column: 1 / -1;
      margin-bottom: 5px;
    }

    .xr-section-summary-in:checked ~ .xr-section-details {
      display: contents;
    }

    .xr-array-wrap {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 20px auto;
    }

    .xr-array-wrap > label {
      grid-column: 1;
      vertical-align: top;
    }

    .xr-preview {
      color: var(--xr-font-color3);
    }

    .xr-array-preview,
    .xr-array-data {
      padding: 0 5px !important;
      grid-column: 2;
    }

    .xr-array-data,
    .xr-array-in:checked ~ .xr-array-preview {
      display: none;
    }

    .xr-array-in:checked ~ .xr-array-data,
    .xr-array-preview {
      display: inline-block;
    }

    .xr-dim-list {
      display: inline-block !important;
      list-style: none;
      padding: 0 !important;
      margin: 0;
    }

    .xr-dim-list li {
      display: inline-block;
      padding: 0;
      margin: 0;
    }

    .xr-dim-list:before {
      content: '(';
    }

    .xr-dim-list:after {
      content: ')';
    }

    .xr-dim-list li:not(:last-child):after {
      content: ',';
      padding-right: 5px;
    }

    .xr-has-index {
      font-weight: bold;
    }

    .xr-var-list,
    .xr-var-item {
      display: contents;
    }

    .xr-var-item > div,
    .xr-var-item label,
    .xr-var-item > .xr-var-name span {
      background-color: var(--xr-background-color-row-even);
      margin-bottom: 0;
    }

    .xr-var-item > .xr-var-name:hover span {
      padding-right: 5px;
    }

    .xr-var-list > li:nth-child(odd) > div,
    .xr-var-list > li:nth-child(odd) > label,
    .xr-var-list > li:nth-child(odd) > .xr-var-name span {
      background-color: var(--xr-background-color-row-odd);
    }

    .xr-var-name {
      grid-column: 1;
    }

    .xr-var-dims {
      grid-column: 2;
    }

    .xr-var-dtype {
      grid-column: 3;
      text-align: right;
      color: var(--xr-font-color2);
    }

    .xr-var-preview {
      grid-column: 4;
    }

    .xr-index-preview {
      grid-column: 2 / 5;
      color: var(--xr-font-color2);
    }

    .xr-var-name,
    .xr-var-dims,
    .xr-var-dtype,
    .xr-preview,
    .xr-attrs dt {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-right: 10px;
    }

    .xr-var-name:hover,
    .xr-var-dims:hover,
    .xr-var-dtype:hover,
    .xr-attrs dt:hover {
      overflow: visible;
      width: auto;
      z-index: 1;
    }

    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      display: none;
      background-color: var(--xr-background-color) !important;
      padding-bottom: 5px !important;
    }

    .xr-var-attrs-in:checked ~ .xr-var-attrs,
    .xr-var-data-in:checked ~ .xr-var-data,
    .xr-index-data-in:checked ~ .xr-index-data {
      display: block;
    }

    .xr-var-data > table {
      float: right;
    }

    .xr-var-name span,
    .xr-var-data,
    .xr-index-name div,
    .xr-index-data,
    .xr-attrs {
      padding-left: 25px !important;
    }

    .xr-attrs,
    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      grid-column: 1 / -1;
    }

    dl.xr-attrs {
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: 125px auto;
    }

    .xr-attrs dt,
    .xr-attrs dd {
      padding: 0;
      margin: 0;
      float: left;
      padding-right: 10px;
      width: auto;
    }

    .xr-attrs dt {
      font-weight: normal;
      grid-column: 1;
    }

    .xr-attrs dt:hover span {
      display: inline-block;
      background: var(--xr-background-color);
      padding-right: 10px;
    }

    .xr-attrs dd {
      grid-column: 2;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .xr-icon-database,
    .xr-icon-file-text2,
    .xr-no-icon {
      display: inline-block;
      vertical-align: middle;
      width: 1em;
      height: 1.5em !important;
      stroke-width: 0;
      stroke: currentColor;
      fill: currentColor;
    }
    </style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (ch: 58)&gt;
    array([8.93687054e-06, 2.87245544e-05, 3.14011006e-05, 1.28314962e-05,
           7.00429062e-05, 2.39990291e-06, 5.66747677e-06, 7.48221788e-06,
           5.48034453e-06, 5.00716548e-06, 6.35190446e-06, 5.43024247e-06,
           1.36550710e-05, 3.53380772e-06, 6.30115857e-06, 3.28572795e-06,
           2.53866870e-06, 3.19189476e-06, 3.36856823e-06, 2.89326470e-06,
           2.61416925e-06, 4.22313806e-06, 4.74037991e-06, 4.55525072e-06,
           2.61874367e-06, 2.41378768e-06, 1.19689790e-05, 2.63449228e-06,
           3.37914354e-06, 3.03666768e-06, 2.36525392e-06, 3.60106597e-06,
           2.90544781e-06, 4.62028805e-06, 4.17896872e-06, 2.67829676e-06,
           2.41001443e-06, 2.62248837e-06, 3.27220269e-06, 2.82973837e-06,
           6.62711797e-06, 4.70645579e-06, 3.53771843e-06, 2.85102737e-06,
           3.89038180e-06, 2.50874236e-06, 2.88236057e-06, 2.67749062e-06,
           2.68606769e-06, 3.97613025e-06, 3.23382339e-06, 3.23382339e-06,
           3.30659379e-06, 4.42659986e-06, 3.24802107e-06, 3.76011821e-06,
           3.83722100e-06, 4.91570866e-06])
    Coordinates:
      * ch        (ch) &lt;U7 &#x27;EEG 003&#x27; &#x27;EEG 004&#x27; &#x27;EEG 005&#x27; ... &#x27;EEG 059&#x27; &#x27;EEG 060&#x27;
        quantile  float64 0.5</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>ch</span>: 58</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-5ecd1dc8-18aa-4166-aeb1-0f5842b2c7be' class='xr-array-in' type='checkbox' checked><label for='section-5ecd1dc8-18aa-4166-aeb1-0f5842b2c7be' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>8.937e-06 2.872e-05 3.14e-05 ... 3.76e-06 3.837e-06 4.916e-06</span></div><div class='xr-array-data'><pre>array([8.93687054e-06, 2.87245544e-05, 3.14011006e-05, 1.28314962e-05,
           7.00429062e-05, 2.39990291e-06, 5.66747677e-06, 7.48221788e-06,
           5.48034453e-06, 5.00716548e-06, 6.35190446e-06, 5.43024247e-06,
           1.36550710e-05, 3.53380772e-06, 6.30115857e-06, 3.28572795e-06,
           2.53866870e-06, 3.19189476e-06, 3.36856823e-06, 2.89326470e-06,
           2.61416925e-06, 4.22313806e-06, 4.74037991e-06, 4.55525072e-06,
           2.61874367e-06, 2.41378768e-06, 1.19689790e-05, 2.63449228e-06,
           3.37914354e-06, 3.03666768e-06, 2.36525392e-06, 3.60106597e-06,
           2.90544781e-06, 4.62028805e-06, 4.17896872e-06, 2.67829676e-06,
           2.41001443e-06, 2.62248837e-06, 3.27220269e-06, 2.82973837e-06,
           6.62711797e-06, 4.70645579e-06, 3.53771843e-06, 2.85102737e-06,
           3.89038180e-06, 2.50874236e-06, 2.88236057e-06, 2.67749062e-06,
           2.68606769e-06, 3.97613025e-06, 3.23382339e-06, 3.23382339e-06,
           3.30659379e-06, 4.42659986e-06, 3.24802107e-06, 3.76011821e-06,
           3.83722100e-06, 4.91570866e-06])</pre></div></div></li><li class='xr-section-item'><input id='section-0f7d4735-ab19-4380-8091-9133ac8701a9' class='xr-section-summary-in' type='checkbox'  checked><label for='section-0f7d4735-ab19-4380-8091-9133ac8701a9' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>ch</span></div><div class='xr-var-dims'>(ch)</div><div class='xr-var-dtype'>&lt;U7</div><div class='xr-var-preview xr-preview'>&#x27;EEG 003&#x27; &#x27;EEG 004&#x27; ... &#x27;EEG 060&#x27;</div><input id='attrs-4463365f-35f8-4eeb-bbf3-17cd517ffeab' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-4463365f-35f8-4eeb-bbf3-17cd517ffeab' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-fceba88c-e715-4524-80b1-35b995716495' class='xr-var-data-in' type='checkbox'><label for='data-fceba88c-e715-4524-80b1-35b995716495' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;EEG 003&#x27;, &#x27;EEG 004&#x27;, &#x27;EEG 005&#x27;, &#x27;EEG 006&#x27;, &#x27;EEG 007&#x27;, &#x27;EEG 008&#x27;,
           &#x27;EEG 009&#x27;, &#x27;EEG 010&#x27;, &#x27;EEG 011&#x27;, &#x27;EEG 012&#x27;, &#x27;EEG 013&#x27;, &#x27;EEG 014&#x27;,
           &#x27;EEG 015&#x27;, &#x27;EEG 016&#x27;, &#x27;EEG 017&#x27;, &#x27;EEG 018&#x27;, &#x27;EEG 019&#x27;, &#x27;EEG 020&#x27;,
           &#x27;EEG 021&#x27;, &#x27;EEG 022&#x27;, &#x27;EEG 023&#x27;, &#x27;EEG 024&#x27;, &#x27;EEG 025&#x27;, &#x27;EEG 026&#x27;,
           &#x27;EEG 027&#x27;, &#x27;EEG 028&#x27;, &#x27;EEG 029&#x27;, &#x27;EEG 030&#x27;, &#x27;EEG 031&#x27;, &#x27;EEG 032&#x27;,
           &#x27;EEG 033&#x27;, &#x27;EEG 034&#x27;, &#x27;EEG 035&#x27;, &#x27;EEG 036&#x27;, &#x27;EEG 037&#x27;, &#x27;EEG 038&#x27;,
           &#x27;EEG 039&#x27;, &#x27;EEG 040&#x27;, &#x27;EEG 041&#x27;, &#x27;EEG 042&#x27;, &#x27;EEG 043&#x27;, &#x27;EEG 044&#x27;,
           &#x27;EEG 045&#x27;, &#x27;EEG 046&#x27;, &#x27;EEG 047&#x27;, &#x27;EEG 048&#x27;, &#x27;EEG 049&#x27;, &#x27;EEG 050&#x27;,
           &#x27;EEG 051&#x27;, &#x27;EEG 052&#x27;, &#x27;EEG 053&#x27;, &#x27;EEG 054&#x27;, &#x27;EEG 055&#x27;, &#x27;EEG 056&#x27;,
           &#x27;EEG 057&#x27;, &#x27;EEG 058&#x27;, &#x27;EEG 059&#x27;, &#x27;EEG 060&#x27;], dtype=&#x27;&lt;U7&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>quantile</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.5</div><input id='attrs-b0e17db4-dafd-4aaa-b642-8f72b3799687' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-b0e17db4-dafd-4aaa-b642-8f72b3799687' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7c5ed78a-40d6-4ca0-b3fe-c0e8c23a2c2d' class='xr-var-data-in' type='checkbox'><label for='data-7c5ed78a-40d6-4ca0-b3fe-c0e8c23a2c2d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0.5)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-e886ee4e-eeb2-41b0-94c4-ffa342f1119a' class='xr-section-summary-in' type='checkbox'  ><label for='section-e886ee4e-eeb2-41b0-94c4-ffa342f1119a' class='xr-section-summary' >Indexes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>ch</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-8b6b3d04-ed3b-4779-9303-b25517cb59e3' class='xr-index-data-in' type='checkbox'/><label for='index-8b6b3d04-ed3b-4779-9303-b25517cb59e3' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;EEG 003&#x27;, &#x27;EEG 004&#x27;, &#x27;EEG 005&#x27;, &#x27;EEG 006&#x27;, &#x27;EEG 007&#x27;, &#x27;EEG 008&#x27;,
           &#x27;EEG 009&#x27;, &#x27;EEG 010&#x27;, &#x27;EEG 011&#x27;, &#x27;EEG 012&#x27;, &#x27;EEG 013&#x27;, &#x27;EEG 014&#x27;,
           &#x27;EEG 015&#x27;, &#x27;EEG 016&#x27;, &#x27;EEG 017&#x27;, &#x27;EEG 018&#x27;, &#x27;EEG 019&#x27;, &#x27;EEG 020&#x27;,
           &#x27;EEG 021&#x27;, &#x27;EEG 022&#x27;, &#x27;EEG 023&#x27;, &#x27;EEG 024&#x27;, &#x27;EEG 025&#x27;, &#x27;EEG 026&#x27;,
           &#x27;EEG 027&#x27;, &#x27;EEG 028&#x27;, &#x27;EEG 029&#x27;, &#x27;EEG 030&#x27;, &#x27;EEG 031&#x27;, &#x27;EEG 032&#x27;,
           &#x27;EEG 033&#x27;, &#x27;EEG 034&#x27;, &#x27;EEG 035&#x27;, &#x27;EEG 036&#x27;, &#x27;EEG 037&#x27;, &#x27;EEG 038&#x27;,
           &#x27;EEG 039&#x27;, &#x27;EEG 040&#x27;, &#x27;EEG 041&#x27;, &#x27;EEG 042&#x27;, &#x27;EEG 043&#x27;, &#x27;EEG 044&#x27;,
           &#x27;EEG 045&#x27;, &#x27;EEG 046&#x27;, &#x27;EEG 047&#x27;, &#x27;EEG 048&#x27;, &#x27;EEG 049&#x27;, &#x27;EEG 050&#x27;,
           &#x27;EEG 051&#x27;, &#x27;EEG 052&#x27;, &#x27;EEG 053&#x27;, &#x27;EEG 054&#x27;, &#x27;EEG 055&#x27;, &#x27;EEG 056&#x27;,
           &#x27;EEG 057&#x27;, &#x27;EEG 058&#x27;, &#x27;EEG 059&#x27;, &#x27;EEG 060&#x27;],
          dtype=&#x27;object&#x27;, name=&#x27;ch&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-e10a2c41-b8a2-4fc8-b324-747522e3c9a4' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-e10a2c41-b8a2-4fc8-b324-747522e3c9a4' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 345-363

d) Identify Outlier indices
^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The indicator matrix is defined by:

.. math::
   c_{ij} =
   \begin{cases}
   0 & \text{if } x^{\sigma_{t}}_{ij} < \tau^e_i \\
   1 & \text{if } x^{\sigma_{t}}_{ij} \geq \tau^e_i
   \end{cases}


To identify outlier **epochs**, we average across the **sensor** dimension of our
indicator matrix :math:`C` and obtain
:math:`C^{\mu_s} \in \mathbb{R}^{E_\mathcal{G}}`, which is a vector of numbers
:math:`c^{\mu_s}_j` representing the percentage of **sensors** for which that epoch
is an outlier.

.. GENERATED FROM PYTHON SOURCE LINES 363-366

.. code-block:: default

    outlier_mask = trim_ch_sd > upper_threshold
    outlier_mask






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
    <defs>
    <symbol id="icon-database" viewBox="0 0 32 32">
    <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
    <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    </symbol>
    <symbol id="icon-file-text2" viewBox="0 0 32 32">
    <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
    <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    </symbol>
    </defs>
    </svg>
    <style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
     *
     */

    :root {
      --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
      --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
      --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
      --xr-border-color: var(--jp-border-color2, #e0e0e0);
      --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
      --xr-background-color: var(--jp-layout-color0, white);
      --xr-background-color-row-even: var(--jp-layout-color1, white);
      --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
    }

    html[theme=dark],
    body[data-theme=dark],
    body.vscode-dark {
      --xr-font-color0: rgba(255, 255, 255, 1);
      --xr-font-color2: rgba(255, 255, 255, 0.54);
      --xr-font-color3: rgba(255, 255, 255, 0.38);
      --xr-border-color: #1F1F1F;
      --xr-disabled-color: #515151;
      --xr-background-color: #111111;
      --xr-background-color-row-even: #111111;
      --xr-background-color-row-odd: #313131;
    }

    .xr-wrap {
      display: block !important;
      min-width: 300px;
      max-width: 700px;
    }

    .xr-text-repr-fallback {
      /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
      display: none;
    }

    .xr-header {
      padding-top: 6px;
      padding-bottom: 6px;
      margin-bottom: 4px;
      border-bottom: solid 1px var(--xr-border-color);
    }

    .xr-header > div,
    .xr-header > ul {
      display: inline;
      margin-top: 0;
      margin-bottom: 0;
    }

    .xr-obj-type,
    .xr-array-name {
      margin-left: 2px;
      margin-right: 10px;
    }

    .xr-obj-type {
      color: var(--xr-font-color2);
    }

    .xr-sections {
      padding-left: 0 !important;
      display: grid;
      grid-template-columns: 150px auto auto 1fr 20px 20px;
    }

    .xr-section-item {
      display: contents;
    }

    .xr-section-item input {
      display: none;
    }

    .xr-section-item input + label {
      color: var(--xr-disabled-color);
    }

    .xr-section-item input:enabled + label {
      cursor: pointer;
      color: var(--xr-font-color2);
    }

    .xr-section-item input:enabled + label:hover {
      color: var(--xr-font-color0);
    }

    .xr-section-summary {
      grid-column: 1;
      color: var(--xr-font-color2);
      font-weight: 500;
    }

    .xr-section-summary > span {
      display: inline-block;
      padding-left: 0.5em;
    }

    .xr-section-summary-in:disabled + label {
      color: var(--xr-font-color2);
    }

    .xr-section-summary-in + label:before {
      display: inline-block;
      content: '‚ñ∫';
      font-size: 11px;
      width: 15px;
      text-align: center;
    }

    .xr-section-summary-in:disabled + label:before {
      color: var(--xr-disabled-color);
    }

    .xr-section-summary-in:checked + label:before {
      content: '‚ñº';
    }

    .xr-section-summary-in:checked + label > span {
      display: none;
    }

    .xr-section-summary,
    .xr-section-inline-details {
      padding-top: 4px;
      padding-bottom: 4px;
    }

    .xr-section-inline-details {
      grid-column: 2 / -1;
    }

    .xr-section-details {
      display: none;
      grid-column: 1 / -1;
      margin-bottom: 5px;
    }

    .xr-section-summary-in:checked ~ .xr-section-details {
      display: contents;
    }

    .xr-array-wrap {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 20px auto;
    }

    .xr-array-wrap > label {
      grid-column: 1;
      vertical-align: top;
    }

    .xr-preview {
      color: var(--xr-font-color3);
    }

    .xr-array-preview,
    .xr-array-data {
      padding: 0 5px !important;
      grid-column: 2;
    }

    .xr-array-data,
    .xr-array-in:checked ~ .xr-array-preview {
      display: none;
    }

    .xr-array-in:checked ~ .xr-array-data,
    .xr-array-preview {
      display: inline-block;
    }

    .xr-dim-list {
      display: inline-block !important;
      list-style: none;
      padding: 0 !important;
      margin: 0;
    }

    .xr-dim-list li {
      display: inline-block;
      padding: 0;
      margin: 0;
    }

    .xr-dim-list:before {
      content: '(';
    }

    .xr-dim-list:after {
      content: ')';
    }

    .xr-dim-list li:not(:last-child):after {
      content: ',';
      padding-right: 5px;
    }

    .xr-has-index {
      font-weight: bold;
    }

    .xr-var-list,
    .xr-var-item {
      display: contents;
    }

    .xr-var-item > div,
    .xr-var-item label,
    .xr-var-item > .xr-var-name span {
      background-color: var(--xr-background-color-row-even);
      margin-bottom: 0;
    }

    .xr-var-item > .xr-var-name:hover span {
      padding-right: 5px;
    }

    .xr-var-list > li:nth-child(odd) > div,
    .xr-var-list > li:nth-child(odd) > label,
    .xr-var-list > li:nth-child(odd) > .xr-var-name span {
      background-color: var(--xr-background-color-row-odd);
    }

    .xr-var-name {
      grid-column: 1;
    }

    .xr-var-dims {
      grid-column: 2;
    }

    .xr-var-dtype {
      grid-column: 3;
      text-align: right;
      color: var(--xr-font-color2);
    }

    .xr-var-preview {
      grid-column: 4;
    }

    .xr-index-preview {
      grid-column: 2 / 5;
      color: var(--xr-font-color2);
    }

    .xr-var-name,
    .xr-var-dims,
    .xr-var-dtype,
    .xr-preview,
    .xr-attrs dt {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-right: 10px;
    }

    .xr-var-name:hover,
    .xr-var-dims:hover,
    .xr-var-dtype:hover,
    .xr-attrs dt:hover {
      overflow: visible;
      width: auto;
      z-index: 1;
    }

    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      display: none;
      background-color: var(--xr-background-color) !important;
      padding-bottom: 5px !important;
    }

    .xr-var-attrs-in:checked ~ .xr-var-attrs,
    .xr-var-data-in:checked ~ .xr-var-data,
    .xr-index-data-in:checked ~ .xr-index-data {
      display: block;
    }

    .xr-var-data > table {
      float: right;
    }

    .xr-var-name span,
    .xr-var-data,
    .xr-index-name div,
    .xr-index-data,
    .xr-attrs {
      padding-left: 25px !important;
    }

    .xr-attrs,
    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      grid-column: 1 / -1;
    }

    dl.xr-attrs {
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: 125px auto;
    }

    .xr-attrs dt,
    .xr-attrs dd {
      padding: 0;
      margin: 0;
      float: left;
      padding-right: 10px;
      width: auto;
    }

    .xr-attrs dt {
      font-weight: normal;
      grid-column: 1;
    }

    .xr-attrs dt:hover span {
      display: inline-block;
      background: var(--xr-background-color);
      padding-right: 10px;
    }

    .xr-attrs dd {
      grid-column: 2;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .xr-icon-database,
    .xr-icon-file-text2,
    .xr-no-icon {
      display: inline-block;
      vertical-align: middle;
      width: 1em;
      height: 1.5em !important;
      stroke-width: 0;
      stroke: currentColor;
      fill: currentColor;
    }
    </style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (epoch: 19, ch: 58)&gt;
    array([[False, False, False, ..., False, False, False],
           [False, False, False, ..., False, False, False],
           [ True, False, False, ...,  True,  True,  True],
           ...,
           [False, False, False, ..., False, False, False],
           [False, False, False, ..., False, False, False],
           [False, False, False, ..., False, False, False]])
    Coordinates:
      * epoch     (epoch) int64 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18
      * ch        (ch) &lt;U7 &#x27;EEG 003&#x27; &#x27;EEG 004&#x27; &#x27;EEG 005&#x27; ... &#x27;EEG 059&#x27; &#x27;EEG 060&#x27;
        quantile  float64 0.5</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>epoch</span>: 19</li><li><span class='xr-has-index'>ch</span>: 58</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-6b59d112-00f3-4e9a-9654-78b4fea027ff' class='xr-array-in' type='checkbox' checked><label for='section-6b59d112-00f3-4e9a-9654-78b4fea027ff' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>False False False False False False ... False False False False False</span></div><div class='xr-array-data'><pre>array([[False, False, False, ..., False, False, False],
           [False, False, False, ..., False, False, False],
           [ True, False, False, ...,  True,  True,  True],
           ...,
           [False, False, False, ..., False, False, False],
           [False, False, False, ..., False, False, False],
           [False, False, False, ..., False, False, False]])</pre></div></div></li><li class='xr-section-item'><input id='section-ffe0e855-27ad-42c3-8a85-2215297753a6' class='xr-section-summary-in' type='checkbox'  checked><label for='section-ffe0e855-27ad-42c3-8a85-2215297753a6' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>epoch</span></div><div class='xr-var-dims'>(epoch)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5 6 ... 13 14 15 16 17 18</div><input id='attrs-70e6de4d-66ff-4385-952b-96c4d9fe1438' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-70e6de4d-66ff-4385-952b-96c4d9fe1438' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1de1d57e-5271-4973-b2b2-694ba53b392f' class='xr-var-data-in' type='checkbox'><label for='data-1de1d57e-5271-4973-b2b2-694ba53b392f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17,
           18])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>ch</span></div><div class='xr-var-dims'>(ch)</div><div class='xr-var-dtype'>&lt;U7</div><div class='xr-var-preview xr-preview'>&#x27;EEG 003&#x27; &#x27;EEG 004&#x27; ... &#x27;EEG 060&#x27;</div><input id='attrs-c56470df-9164-4b26-b782-e93f8fd077f4' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-c56470df-9164-4b26-b782-e93f8fd077f4' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-63767ebf-3a5c-4440-821d-7f2a3d6addfc' class='xr-var-data-in' type='checkbox'><label for='data-63767ebf-3a5c-4440-821d-7f2a3d6addfc' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;EEG 003&#x27;, &#x27;EEG 004&#x27;, &#x27;EEG 005&#x27;, &#x27;EEG 006&#x27;, &#x27;EEG 007&#x27;, &#x27;EEG 008&#x27;,
           &#x27;EEG 009&#x27;, &#x27;EEG 010&#x27;, &#x27;EEG 011&#x27;, &#x27;EEG 012&#x27;, &#x27;EEG 013&#x27;, &#x27;EEG 014&#x27;,
           &#x27;EEG 015&#x27;, &#x27;EEG 016&#x27;, &#x27;EEG 017&#x27;, &#x27;EEG 018&#x27;, &#x27;EEG 019&#x27;, &#x27;EEG 020&#x27;,
           &#x27;EEG 021&#x27;, &#x27;EEG 022&#x27;, &#x27;EEG 023&#x27;, &#x27;EEG 024&#x27;, &#x27;EEG 025&#x27;, &#x27;EEG 026&#x27;,
           &#x27;EEG 027&#x27;, &#x27;EEG 028&#x27;, &#x27;EEG 029&#x27;, &#x27;EEG 030&#x27;, &#x27;EEG 031&#x27;, &#x27;EEG 032&#x27;,
           &#x27;EEG 033&#x27;, &#x27;EEG 034&#x27;, &#x27;EEG 035&#x27;, &#x27;EEG 036&#x27;, &#x27;EEG 037&#x27;, &#x27;EEG 038&#x27;,
           &#x27;EEG 039&#x27;, &#x27;EEG 040&#x27;, &#x27;EEG 041&#x27;, &#x27;EEG 042&#x27;, &#x27;EEG 043&#x27;, &#x27;EEG 044&#x27;,
           &#x27;EEG 045&#x27;, &#x27;EEG 046&#x27;, &#x27;EEG 047&#x27;, &#x27;EEG 048&#x27;, &#x27;EEG 049&#x27;, &#x27;EEG 050&#x27;,
           &#x27;EEG 051&#x27;, &#x27;EEG 052&#x27;, &#x27;EEG 053&#x27;, &#x27;EEG 054&#x27;, &#x27;EEG 055&#x27;, &#x27;EEG 056&#x27;,
           &#x27;EEG 057&#x27;, &#x27;EEG 058&#x27;, &#x27;EEG 059&#x27;, &#x27;EEG 060&#x27;], dtype=&#x27;&lt;U7&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>quantile</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.5</div><input id='attrs-9e0b3fc9-87fb-445c-a988-e399d451c9ae' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-9e0b3fc9-87fb-445c-a988-e399d451c9ae' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c92f720a-7f88-46dd-984a-b4e6b937b4fe' class='xr-var-data-in' type='checkbox'><label for='data-c92f720a-7f88-46dd-984a-b4e6b937b4fe' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0.5)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-b212dbdb-7e58-48b4-8485-0f71dc07a86b' class='xr-section-summary-in' type='checkbox'  ><label for='section-b212dbdb-7e58-48b4-8485-0f71dc07a86b' class='xr-section-summary' >Indexes: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>epoch</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-40abbd0a-82bd-40ae-9fb1-4addaa50e458' class='xr-index-data-in' type='checkbox'/><label for='index-40abbd0a-82bd-40ae-9fb1-4addaa50e458' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18], dtype=&#x27;int64&#x27;, name=&#x27;epoch&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>ch</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-ab71d024-6980-4d9e-9517-5a170056b937' class='xr-index-data-in' type='checkbox'/><label for='index-ab71d024-6980-4d9e-9517-5a170056b937' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;EEG 003&#x27;, &#x27;EEG 004&#x27;, &#x27;EEG 005&#x27;, &#x27;EEG 006&#x27;, &#x27;EEG 007&#x27;, &#x27;EEG 008&#x27;,
           &#x27;EEG 009&#x27;, &#x27;EEG 010&#x27;, &#x27;EEG 011&#x27;, &#x27;EEG 012&#x27;, &#x27;EEG 013&#x27;, &#x27;EEG 014&#x27;,
           &#x27;EEG 015&#x27;, &#x27;EEG 016&#x27;, &#x27;EEG 017&#x27;, &#x27;EEG 018&#x27;, &#x27;EEG 019&#x27;, &#x27;EEG 020&#x27;,
           &#x27;EEG 021&#x27;, &#x27;EEG 022&#x27;, &#x27;EEG 023&#x27;, &#x27;EEG 024&#x27;, &#x27;EEG 025&#x27;, &#x27;EEG 026&#x27;,
           &#x27;EEG 027&#x27;, &#x27;EEG 028&#x27;, &#x27;EEG 029&#x27;, &#x27;EEG 030&#x27;, &#x27;EEG 031&#x27;, &#x27;EEG 032&#x27;,
           &#x27;EEG 033&#x27;, &#x27;EEG 034&#x27;, &#x27;EEG 035&#x27;, &#x27;EEG 036&#x27;, &#x27;EEG 037&#x27;, &#x27;EEG 038&#x27;,
           &#x27;EEG 039&#x27;, &#x27;EEG 040&#x27;, &#x27;EEG 041&#x27;, &#x27;EEG 042&#x27;, &#x27;EEG 043&#x27;, &#x27;EEG 044&#x27;,
           &#x27;EEG 045&#x27;, &#x27;EEG 046&#x27;, &#x27;EEG 047&#x27;, &#x27;EEG 048&#x27;, &#x27;EEG 049&#x27;, &#x27;EEG 050&#x27;,
           &#x27;EEG 051&#x27;, &#x27;EEG 052&#x27;, &#x27;EEG 053&#x27;, &#x27;EEG 054&#x27;, &#x27;EEG 055&#x27;, &#x27;EEG 056&#x27;,
           &#x27;EEG 057&#x27;, &#x27;EEG 058&#x27;, &#x27;EEG 059&#x27;, &#x27;EEG 060&#x27;],
          dtype=&#x27;object&#x27;, name=&#x27;ch&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-6a27df68-ff2f-46de-ab09-9432c451152d' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-6a27df68-ff2f-46de-ab09-9432c451152d' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 367-370

.. code-block:: default

    percent_outliers = outlier_mask.astype(float).mean("ch")
    percent_outliers






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
    <defs>
    <symbol id="icon-database" viewBox="0 0 32 32">
    <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
    <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    </symbol>
    <symbol id="icon-file-text2" viewBox="0 0 32 32">
    <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
    <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    </symbol>
    </defs>
    </svg>
    <style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
     *
     */

    :root {
      --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
      --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
      --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
      --xr-border-color: var(--jp-border-color2, #e0e0e0);
      --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
      --xr-background-color: var(--jp-layout-color0, white);
      --xr-background-color-row-even: var(--jp-layout-color1, white);
      --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
    }

    html[theme=dark],
    body[data-theme=dark],
    body.vscode-dark {
      --xr-font-color0: rgba(255, 255, 255, 1);
      --xr-font-color2: rgba(255, 255, 255, 0.54);
      --xr-font-color3: rgba(255, 255, 255, 0.38);
      --xr-border-color: #1F1F1F;
      --xr-disabled-color: #515151;
      --xr-background-color: #111111;
      --xr-background-color-row-even: #111111;
      --xr-background-color-row-odd: #313131;
    }

    .xr-wrap {
      display: block !important;
      min-width: 300px;
      max-width: 700px;
    }

    .xr-text-repr-fallback {
      /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
      display: none;
    }

    .xr-header {
      padding-top: 6px;
      padding-bottom: 6px;
      margin-bottom: 4px;
      border-bottom: solid 1px var(--xr-border-color);
    }

    .xr-header > div,
    .xr-header > ul {
      display: inline;
      margin-top: 0;
      margin-bottom: 0;
    }

    .xr-obj-type,
    .xr-array-name {
      margin-left: 2px;
      margin-right: 10px;
    }

    .xr-obj-type {
      color: var(--xr-font-color2);
    }

    .xr-sections {
      padding-left: 0 !important;
      display: grid;
      grid-template-columns: 150px auto auto 1fr 20px 20px;
    }

    .xr-section-item {
      display: contents;
    }

    .xr-section-item input {
      display: none;
    }

    .xr-section-item input + label {
      color: var(--xr-disabled-color);
    }

    .xr-section-item input:enabled + label {
      cursor: pointer;
      color: var(--xr-font-color2);
    }

    .xr-section-item input:enabled + label:hover {
      color: var(--xr-font-color0);
    }

    .xr-section-summary {
      grid-column: 1;
      color: var(--xr-font-color2);
      font-weight: 500;
    }

    .xr-section-summary > span {
      display: inline-block;
      padding-left: 0.5em;
    }

    .xr-section-summary-in:disabled + label {
      color: var(--xr-font-color2);
    }

    .xr-section-summary-in + label:before {
      display: inline-block;
      content: '‚ñ∫';
      font-size: 11px;
      width: 15px;
      text-align: center;
    }

    .xr-section-summary-in:disabled + label:before {
      color: var(--xr-disabled-color);
    }

    .xr-section-summary-in:checked + label:before {
      content: '‚ñº';
    }

    .xr-section-summary-in:checked + label > span {
      display: none;
    }

    .xr-section-summary,
    .xr-section-inline-details {
      padding-top: 4px;
      padding-bottom: 4px;
    }

    .xr-section-inline-details {
      grid-column: 2 / -1;
    }

    .xr-section-details {
      display: none;
      grid-column: 1 / -1;
      margin-bottom: 5px;
    }

    .xr-section-summary-in:checked ~ .xr-section-details {
      display: contents;
    }

    .xr-array-wrap {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 20px auto;
    }

    .xr-array-wrap > label {
      grid-column: 1;
      vertical-align: top;
    }

    .xr-preview {
      color: var(--xr-font-color3);
    }

    .xr-array-preview,
    .xr-array-data {
      padding: 0 5px !important;
      grid-column: 2;
    }

    .xr-array-data,
    .xr-array-in:checked ~ .xr-array-preview {
      display: none;
    }

    .xr-array-in:checked ~ .xr-array-data,
    .xr-array-preview {
      display: inline-block;
    }

    .xr-dim-list {
      display: inline-block !important;
      list-style: none;
      padding: 0 !important;
      margin: 0;
    }

    .xr-dim-list li {
      display: inline-block;
      padding: 0;
      margin: 0;
    }

    .xr-dim-list:before {
      content: '(';
    }

    .xr-dim-list:after {
      content: ')';
    }

    .xr-dim-list li:not(:last-child):after {
      content: ',';
      padding-right: 5px;
    }

    .xr-has-index {
      font-weight: bold;
    }

    .xr-var-list,
    .xr-var-item {
      display: contents;
    }

    .xr-var-item > div,
    .xr-var-item label,
    .xr-var-item > .xr-var-name span {
      background-color: var(--xr-background-color-row-even);
      margin-bottom: 0;
    }

    .xr-var-item > .xr-var-name:hover span {
      padding-right: 5px;
    }

    .xr-var-list > li:nth-child(odd) > div,
    .xr-var-list > li:nth-child(odd) > label,
    .xr-var-list > li:nth-child(odd) > .xr-var-name span {
      background-color: var(--xr-background-color-row-odd);
    }

    .xr-var-name {
      grid-column: 1;
    }

    .xr-var-dims {
      grid-column: 2;
    }

    .xr-var-dtype {
      grid-column: 3;
      text-align: right;
      color: var(--xr-font-color2);
    }

    .xr-var-preview {
      grid-column: 4;
    }

    .xr-index-preview {
      grid-column: 2 / 5;
      color: var(--xr-font-color2);
    }

    .xr-var-name,
    .xr-var-dims,
    .xr-var-dtype,
    .xr-preview,
    .xr-attrs dt {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-right: 10px;
    }

    .xr-var-name:hover,
    .xr-var-dims:hover,
    .xr-var-dtype:hover,
    .xr-attrs dt:hover {
      overflow: visible;
      width: auto;
      z-index: 1;
    }

    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      display: none;
      background-color: var(--xr-background-color) !important;
      padding-bottom: 5px !important;
    }

    .xr-var-attrs-in:checked ~ .xr-var-attrs,
    .xr-var-data-in:checked ~ .xr-var-data,
    .xr-index-data-in:checked ~ .xr-index-data {
      display: block;
    }

    .xr-var-data > table {
      float: right;
    }

    .xr-var-name span,
    .xr-var-data,
    .xr-index-name div,
    .xr-index-data,
    .xr-attrs {
      padding-left: 25px !important;
    }

    .xr-attrs,
    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      grid-column: 1 / -1;
    }

    dl.xr-attrs {
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: 125px auto;
    }

    .xr-attrs dt,
    .xr-attrs dd {
      padding: 0;
      margin: 0;
      float: left;
      padding-right: 10px;
      width: auto;
    }

    .xr-attrs dt {
      font-weight: normal;
      grid-column: 1;
    }

    .xr-attrs dt:hover span {
      display: inline-block;
      background: var(--xr-background-color);
      padding-right: 10px;
    }

    .xr-attrs dd {
      grid-column: 2;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .xr-icon-database,
    .xr-icon-file-text2,
    .xr-no-icon {
      display: inline-block;
      vertical-align: middle;
      width: 1em;
      height: 1.5em !important;
      stroke-width: 0;
      stroke: currentColor;
      fill: currentColor;
    }
    </style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (epoch: 19)&gt;
    array([0.        , 0.        , 0.93103448, 0.01724138, 0.        ,
           0.        , 0.        , 0.        , 0.0862069 , 0.        ,
           0.        , 0.        , 0.        , 0.        , 0.        ,
           0.        , 0.        , 0.        , 0.01724138])
    Coordinates:
      * epoch     (epoch) int64 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18
        quantile  float64 0.5</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>epoch</span>: 19</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-260b1d61-f855-47bd-abcd-beb25adee493' class='xr-array-in' type='checkbox' checked><label for='section-260b1d61-f855-47bd-abcd-beb25adee493' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>0.0 0.0 0.931 0.01724 0.0 0.0 0.0 ... 0.0 0.0 0.0 0.0 0.0 0.0 0.01724</span></div><div class='xr-array-data'><pre>array([0.        , 0.        , 0.93103448, 0.01724138, 0.        ,
           0.        , 0.        , 0.        , 0.0862069 , 0.        ,
           0.        , 0.        , 0.        , 0.        , 0.        ,
           0.        , 0.        , 0.        , 0.01724138])</pre></div></div></li><li class='xr-section-item'><input id='section-d20fe91f-cf32-4cd7-9bc5-e014ee75a999' class='xr-section-summary-in' type='checkbox'  checked><label for='section-d20fe91f-cf32-4cd7-9bc5-e014ee75a999' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>epoch</span></div><div class='xr-var-dims'>(epoch)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5 6 ... 13 14 15 16 17 18</div><input id='attrs-70f5e114-0caa-46c3-84ec-fbe4fcbd494c' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-70f5e114-0caa-46c3-84ec-fbe4fcbd494c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3204bb2c-563d-4223-86e2-82e1c410dd98' class='xr-var-data-in' type='checkbox'><label for='data-3204bb2c-563d-4223-86e2-82e1c410dd98' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17,
           18])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>quantile</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.5</div><input id='attrs-4d40bff6-5aa9-4c69-bdb7-4a7b96d6e1cd' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-4d40bff6-5aa9-4c69-bdb7-4a7b96d6e1cd' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8c97c000-18f9-4780-b18e-aadc24a4956d' class='xr-var-data-in' type='checkbox'><label for='data-8c97c000-18f9-4780-b18e-aadc24a4956d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(0.5)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-3222dbc0-ebf3-438c-be5b-c1a62c9f2488' class='xr-section-summary-in' type='checkbox'  ><label for='section-3222dbc0-ebf3-438c-be5b-c1a62c9f2488' class='xr-section-summary' >Indexes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>epoch</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-d607ed3d-5d90-4d84-b0ec-a58078ac468f' class='xr-index-data-in' type='checkbox'/><label for='index-d607ed3d-5d90-4d84-b0ec-a58078ac468f' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18], dtype=&#x27;int64&#x27;, name=&#x27;epoch&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-c431777b-18a3-4007-a0cd-8f8af308631e' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-c431777b-18a3-4007-a0cd-8f8af308631e' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 371-377

e) Identify noisy epochs
^^^^^^^^^^^^^^^^^^^^^^^^

Next, we define a fractional threshold :math:`\tau^{p}` as a cutoff point for
determining if a epoch should be marked artifactual. The epoch :math:`j` is flagged
as noisy if :math:`c^{\mu_s}_j > \tau^{p}`.

.. GENERATED FROM PYTHON SOURCE LINES 377-380

.. code-block:: default

    bad_epochs = percent_outliers[percent_outliers > p_threshold].coords.to_index().values
    bad_epochs





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    array([2])



.. GENERATED FROM PYTHON SOURCE LINES 381-386

f) Add the noisy epochs to the pipeline flags
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Let's add the outlier epochs to our flags
These will be added directly as :class:`mne.Annotations` to the raw data.

.. GENERATED FROM PYTHON SOURCE LINES 386-391

.. code-block:: default

    pipeline.flags["epoch"].add_flag_cat(
        kind="ch_sd", bad_epoch_inds=bad_epochs, epochs=epochs
    )
    pipeline.raw.annotations.description





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    array(['bad_pylossless_ch_sd'], dtype='<U20')



.. GENERATED FROM PYTHON SOURCE LINES 392-394

.. code-block:: default

    pipeline.raw.plot()




.. image-sg:: /auto_examples/images/sphx_glr_plot_0_implementation_002.png
   :alt: plot 0 implementation
   :srcset: /auto_examples/images/sphx_glr_plot_0_implementation_002.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <MNEBrowseFigure size 1440x844 with 4 Axes>



.. GENERATED FROM PYTHON SOURCE LINES 395-403

Filtering
---------

After flagging noisy sensors and epochs, we filter the data. By default,
The pipeline uses a 1-100Hz bandpass filter. This is because 1), ICA decompositions
are more stable when low frequency drifts are removed, and 2) the ICLabel classifier
is trained on data that has been filtered between 1-100Hz. A notch filter can also be
optionally specified.

.. GENERATED FROM PYTHON SOURCE LINES 403-406

.. code-block:: default

    pipeline.config["filtering"]["notch_filter_args"]["freqs"] = [50]
    pipeline.filter()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    LOSSLESS: üö© filter.
    Filtering raw data in 1 contiguous segment
    Setting up band-pass filter from 1 - 1e+02 Hz

    FIR filter parameters
    ---------------------
    Designing a one-pass, zero-phase, non-causal bandpass filter:
    - Windowed time-domain design (firwin) method
    - Hamming window with 0.0194 passband ripple and 53 dB stopband attenuation
    - Lower passband edge: 1.00
    - Lower transition bandwidth: 1.00 Hz (-6 dB cutoff frequency: 0.50 Hz)
    - Upper passband edge: 100.00 Hz
    - Upper transition bandwidth: 25.00 Hz (-6 dB cutoff frequency: 112.50 Hz)
    - Filter length: 1983 samples (3.302 sec)

    [Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.
    [Parallel(n_jobs=1)]: Done   1 out of   1 | elapsed:    0.0s remaining:    0.0s
    [Parallel(n_jobs=1)]: Done   2 out of   2 | elapsed:    0.0s remaining:    0.0s
    [Parallel(n_jobs=1)]: Done   3 out of   3 | elapsed:    0.0s remaining:    0.0s
    [Parallel(n_jobs=1)]: Done   4 out of   4 | elapsed:    0.0s remaining:    0.0s
    [Parallel(n_jobs=1)]: Done  60 out of  60 | elapsed:    0.1s finished
    Setting up band-stop filter from 49 - 51 Hz

    FIR filter parameters
    ---------------------
    Designing a one-pass, zero-phase, non-causal bandstop filter:
    - Windowed time-domain design (firwin) method
    - Hamming window with 0.0194 passband ripple and 53 dB stopband attenuation
    - Lower passband edge: 49.38
    - Lower transition bandwidth: 0.50 Hz (-6 dB cutoff frequency: 49.12 Hz)
    - Upper passband edge: 50.62 Hz
    - Upper transition bandwidth: 0.50 Hz (-6 dB cutoff frequency: 50.88 Hz)
    - Filter length: 3965 samples (6.602 sec)

    [Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.
    [Parallel(n_jobs=1)]: Done   1 out of   1 | elapsed:    0.0s remaining:    0.0s
    [Parallel(n_jobs=1)]: Done   2 out of   2 | elapsed:    0.0s remaining:    0.0s
    [Parallel(n_jobs=1)]: Done   3 out of   3 | elapsed:    0.0s remaining:    0.0s
    [Parallel(n_jobs=1)]: Done   4 out of   4 | elapsed:    0.0s remaining:    0.0s
    [Parallel(n_jobs=1)]: Done  60 out of  60 | elapsed:    0.1s finished
    Setting up band-stop filter from 49 - 51 Hz

    FIR filter parameters
    ---------------------
    Designing a one-pass, zero-phase, non-causal bandstop filter:
    - Windowed time-domain design (firwin) method
    - Hamming window with 0.0194 passband ripple and 53 dB stopband attenuation
    - Lower passband edge: 49.38
    - Lower transition bandwidth: 0.50 Hz (-6 dB cutoff frequency: 49.12 Hz)
    - Upper passband edge: 50.62 Hz
    - Upper transition bandwidth: 0.50 Hz (-6 dB cutoff frequency: 50.88 Hz)
    - Filter length: 3965 samples (6.602 sec)

    [Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.
    [Parallel(n_jobs=1)]: Done   1 out of   1 | elapsed:    0.0s remaining:    0.0s
    [Parallel(n_jobs=1)]: Done   2 out of   2 | elapsed:    0.0s remaining:    0.0s
    [Parallel(n_jobs=1)]: Done   3 out of   3 | elapsed:    0.0s remaining:    0.0s
    [Parallel(n_jobs=1)]: Done   4 out of   4 | elapsed:    0.0s remaining:    0.0s
    [Parallel(n_jobs=1)]: Done  60 out of  60 | elapsed:    0.1s finished
    LOSSLESS: üèÅ Finished filter after 0.39 seconds.




.. GENERATED FROM PYTHON SOURCE LINES 407-417

Find Nearest Neighbours & return Maximum Correlation
----------------------------------------------------

.. figure:: https://raw.githubusercontent.com/scott-huberty/wip_pipeline-figures/main/Nearest_neighbors.png
   :align: center
   :alt: Nearest Neighbors graphic.

   Nearest Neighbors. The figure shows the steps for finding nearest neighbors. See the text below
   for descriptions of mathematical notation.


.. GENERATED FROM PYTHON SOURCE LINES 419-423

Whereas :ref:`noisy_sensors` and :ref:`noisy_epochs` operated on a 2D matrix of
standard deviation values, The next few steps will operate on correlation
coefficients. Here we describe the procedure for defining the 2D matrix of correlation
coefficients.

.. GENERATED FROM PYTHON SOURCE LINES 425-427

.. code-block:: default

    from pylossless.pipeline import chan_neighbour_r








.. GENERATED FROM PYTHON SOURCE LINES 428-429

Notice that our flagged epochs are dropped.

.. GENERATED FROM PYTHON SOURCE LINES 430-432

.. code-block:: default

    epochs = pipeline.get_epochs()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    üßπ Epoching..
    Not setting metadata
    19 matching events found
    No baseline correction applied
    0 projection items activated
    Using data from preloaded Raw for 19 events and 601 original time points ...
    2 bad epochs dropped
    üîç Detecting channels to leave out of reference.
    EEG channel type selected for re-referencing
    Applying a custom ('EEG',) reference.




.. GENERATED FROM PYTHON SOURCE LINES 433-459

a) Calculate Correlation Coefficients between each Sensor and its neighboring eighbors
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

- For each good sensor $i$ in :math:`S_{\mathcal{G}}`, we select its :math:`N` nearest
  neighbors. I.e. the :math:`N` sensors that are closest to it.

- We call the sensor :math:`i` the *origin*, and its nearest neighbors :math`\hat{s_l}`
  with :math:`l \in \{1, 2, \ldots, N\}`

- Then, for each epoch :math:`j`, we calculate the correlation coefficient
  :math:`\rho^t_{(i,\hat{s_l}),j}` between origin sensor :math:`i` and each neighbor
  :math:`\hat{s_l}` across dimension :math:`t` (samples), returning a 3D matrice of
  correlation coefficients:

.. math::
   \mathrm{P}^t = \{\rho^t_{(i, \hat{s_l}),j}\} \in \mathbb{R}^{S_G \times E_G \times n}

Finally, we select the maximum correlation coefficient across the neighbor dimension
:math:`n`:

.. math::
   \mathrm{P}^{t,{\text{max}}^n}= \max\limits_{\hat{s_l}}  \rho^t_{(i, \hat{s_l}),j}

Returning a 2D matrix where each value at :math:`(i, j)` is the maximum correlation
coefficient between sensor :math:`i` and its :math:`N` nearest neighbors, at each epoch
:math:`j`

.. GENERATED FROM PYTHON SOURCE LINES 461-465

.. code-block:: default

    data_r_ch = chan_neighbour_r(epochs, nneigbr=3, method="max")
    # maximum correlation out of correlations between ch and its 3 neighbors
    data_r_ch





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|          | 0/58 [00:00<?, ?it/s]      7%|6         | 4/58 [00:00<00:01, 39.40it/s]     14%|#3        | 8/58 [00:00<00:01, 39.63it/s]     22%|##2       | 13/58 [00:00<00:01, 42.93it/s]     31%|###1      | 18/58 [00:00<00:00, 44.36it/s]     40%|###9      | 23/58 [00:00<00:00, 44.00it/s]     48%|####8     | 28/58 [00:00<00:00, 45.32it/s]     57%|#####6    | 33/58 [00:00<00:00, 45.69it/s]     66%|######5   | 38/58 [00:00<00:00, 45.05it/s]     74%|#######4  | 43/58 [00:00<00:00, 44.38it/s]     83%|########2 | 48/58 [00:01<00:00, 44.31it/s]     91%|#########1| 53/58 [00:01<00:00, 44.23it/s]    100%|##########| 58/58 [00:01<00:00, 44.46it/s]    100%|##########| 58/58 [00:01<00:00, 44.19it/s]


.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
    <defs>
    <symbol id="icon-database" viewBox="0 0 32 32">
    <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
    <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    </symbol>
    <symbol id="icon-file-text2" viewBox="0 0 32 32">
    <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
    <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    </symbol>
    </defs>
    </svg>
    <style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
     *
     */

    :root {
      --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
      --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
      --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
      --xr-border-color: var(--jp-border-color2, #e0e0e0);
      --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
      --xr-background-color: var(--jp-layout-color0, white);
      --xr-background-color-row-even: var(--jp-layout-color1, white);
      --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
    }

    html[theme=dark],
    body[data-theme=dark],
    body.vscode-dark {
      --xr-font-color0: rgba(255, 255, 255, 1);
      --xr-font-color2: rgba(255, 255, 255, 0.54);
      --xr-font-color3: rgba(255, 255, 255, 0.38);
      --xr-border-color: #1F1F1F;
      --xr-disabled-color: #515151;
      --xr-background-color: #111111;
      --xr-background-color-row-even: #111111;
      --xr-background-color-row-odd: #313131;
    }

    .xr-wrap {
      display: block !important;
      min-width: 300px;
      max-width: 700px;
    }

    .xr-text-repr-fallback {
      /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
      display: none;
    }

    .xr-header {
      padding-top: 6px;
      padding-bottom: 6px;
      margin-bottom: 4px;
      border-bottom: solid 1px var(--xr-border-color);
    }

    .xr-header > div,
    .xr-header > ul {
      display: inline;
      margin-top: 0;
      margin-bottom: 0;
    }

    .xr-obj-type,
    .xr-array-name {
      margin-left: 2px;
      margin-right: 10px;
    }

    .xr-obj-type {
      color: var(--xr-font-color2);
    }

    .xr-sections {
      padding-left: 0 !important;
      display: grid;
      grid-template-columns: 150px auto auto 1fr 20px 20px;
    }

    .xr-section-item {
      display: contents;
    }

    .xr-section-item input {
      display: none;
    }

    .xr-section-item input + label {
      color: var(--xr-disabled-color);
    }

    .xr-section-item input:enabled + label {
      cursor: pointer;
      color: var(--xr-font-color2);
    }

    .xr-section-item input:enabled + label:hover {
      color: var(--xr-font-color0);
    }

    .xr-section-summary {
      grid-column: 1;
      color: var(--xr-font-color2);
      font-weight: 500;
    }

    .xr-section-summary > span {
      display: inline-block;
      padding-left: 0.5em;
    }

    .xr-section-summary-in:disabled + label {
      color: var(--xr-font-color2);
    }

    .xr-section-summary-in + label:before {
      display: inline-block;
      content: '‚ñ∫';
      font-size: 11px;
      width: 15px;
      text-align: center;
    }

    .xr-section-summary-in:disabled + label:before {
      color: var(--xr-disabled-color);
    }

    .xr-section-summary-in:checked + label:before {
      content: '‚ñº';
    }

    .xr-section-summary-in:checked + label > span {
      display: none;
    }

    .xr-section-summary,
    .xr-section-inline-details {
      padding-top: 4px;
      padding-bottom: 4px;
    }

    .xr-section-inline-details {
      grid-column: 2 / -1;
    }

    .xr-section-details {
      display: none;
      grid-column: 1 / -1;
      margin-bottom: 5px;
    }

    .xr-section-summary-in:checked ~ .xr-section-details {
      display: contents;
    }

    .xr-array-wrap {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 20px auto;
    }

    .xr-array-wrap > label {
      grid-column: 1;
      vertical-align: top;
    }

    .xr-preview {
      color: var(--xr-font-color3);
    }

    .xr-array-preview,
    .xr-array-data {
      padding: 0 5px !important;
      grid-column: 2;
    }

    .xr-array-data,
    .xr-array-in:checked ~ .xr-array-preview {
      display: none;
    }

    .xr-array-in:checked ~ .xr-array-data,
    .xr-array-preview {
      display: inline-block;
    }

    .xr-dim-list {
      display: inline-block !important;
      list-style: none;
      padding: 0 !important;
      margin: 0;
    }

    .xr-dim-list li {
      display: inline-block;
      padding: 0;
      margin: 0;
    }

    .xr-dim-list:before {
      content: '(';
    }

    .xr-dim-list:after {
      content: ')';
    }

    .xr-dim-list li:not(:last-child):after {
      content: ',';
      padding-right: 5px;
    }

    .xr-has-index {
      font-weight: bold;
    }

    .xr-var-list,
    .xr-var-item {
      display: contents;
    }

    .xr-var-item > div,
    .xr-var-item label,
    .xr-var-item > .xr-var-name span {
      background-color: var(--xr-background-color-row-even);
      margin-bottom: 0;
    }

    .xr-var-item > .xr-var-name:hover span {
      padding-right: 5px;
    }

    .xr-var-list > li:nth-child(odd) > div,
    .xr-var-list > li:nth-child(odd) > label,
    .xr-var-list > li:nth-child(odd) > .xr-var-name span {
      background-color: var(--xr-background-color-row-odd);
    }

    .xr-var-name {
      grid-column: 1;
    }

    .xr-var-dims {
      grid-column: 2;
    }

    .xr-var-dtype {
      grid-column: 3;
      text-align: right;
      color: var(--xr-font-color2);
    }

    .xr-var-preview {
      grid-column: 4;
    }

    .xr-index-preview {
      grid-column: 2 / 5;
      color: var(--xr-font-color2);
    }

    .xr-var-name,
    .xr-var-dims,
    .xr-var-dtype,
    .xr-preview,
    .xr-attrs dt {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-right: 10px;
    }

    .xr-var-name:hover,
    .xr-var-dims:hover,
    .xr-var-dtype:hover,
    .xr-attrs dt:hover {
      overflow: visible;
      width: auto;
      z-index: 1;
    }

    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      display: none;
      background-color: var(--xr-background-color) !important;
      padding-bottom: 5px !important;
    }

    .xr-var-attrs-in:checked ~ .xr-var-attrs,
    .xr-var-data-in:checked ~ .xr-var-data,
    .xr-index-data-in:checked ~ .xr-index-data {
      display: block;
    }

    .xr-var-data > table {
      float: right;
    }

    .xr-var-name span,
    .xr-var-data,
    .xr-index-name div,
    .xr-index-data,
    .xr-attrs {
      padding-left: 25px !important;
    }

    .xr-attrs,
    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      grid-column: 1 / -1;
    }

    dl.xr-attrs {
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: 125px auto;
    }

    .xr-attrs dt,
    .xr-attrs dd {
      padding: 0;
      margin: 0;
      float: left;
      padding-right: 10px;
      width: auto;
    }

    .xr-attrs dt {
      font-weight: normal;
      grid-column: 1;
    }

    .xr-attrs dt:hover span {
      display: inline-block;
      background: var(--xr-background-color);
      padding-right: 10px;
    }

    .xr-attrs dd {
      grid-column: 2;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .xr-icon-database,
    .xr-icon-file-text2,
    .xr-no-icon {
      display: inline-block;
      vertical-align: middle;
      width: 1em;
      height: 1.5em !important;
      stroke-width: 0;
      stroke: currentColor;
      fill: currentColor;
    }
    </style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (ch: 58, epoch: 17)&gt;
    array([[0.43866056, 0.14553338, 0.92146594, 0.21124047, 0.4095126 ,
            0.15250306, 0.96321641, 0.75479821, 0.73969339, 0.18287992,
            0.30397015, 0.11793687, 0.4081516 , 0.07738212, 0.5064397 ,
            0.18777674, 0.94772735],
           [0.06156345, 0.13348796, 0.95716877, 0.27845968, 0.15554332,
            0.10134582, 0.98332016, 0.83355635, 0.90468205, 0.09308467,
            0.15375557, 0.06604402, 0.15377766, 0.21897691, 0.2608765 ,
            0.2656993 , 0.97505486],
           [0.12904976, 0.21496437, 0.95716877, 0.27845968, 0.10764917,
            0.1101966 , 0.98332016, 0.83355635, 0.90468205, 0.02169976,
            0.22092604, 0.08129005, 0.36628463, 0.21897691, 0.25693387,
            0.2656993 , 0.97505486],
           [0.43866056, 0.15203423, 0.95001732, 0.09339404, 0.4095126 ,
            0.15250306, 0.97559431, 0.84612402, 0.81397881, 0.14279805,
            0.40714657, 0.07360633, 0.4081516 , 0.04175781, 0.5064397 ,
            0.26556433, 0.95484653],
           [0.22456669, 0.15203423, 0.95001732, 0.28969062, 0.32569984,
            0.13601462, 0.97559431, 0.84612402, 0.84713855, 0.18287992,
            0.22435981, 0.10917912, 0.39854106, 0.07738212, 0.21392411,
            0.27847946, 0.95484653],
    ...
           [0.33914732, 0.21073026, 0.54843395, 0.12758548, 0.36296385,
            0.17868857, 0.76558666, 0.24868636, 0.39178594, 0.14533567,
            0.23895021, 0.11511981, 0.30195919, 0.10767846, 0.3505198 ,
            0.11174796, 0.63948113],
           [0.3168016 , 0.09290203, 0.5501744 , 0.13625256, 0.37443509,
            0.09976059, 0.72456344, 0.11712827, 0.37978025, 0.01499466,
            0.28967373, 0.16571638, 0.2685378 , 0.12452942, 0.40792206,
            0.12454686, 0.56835975],
           [0.31848436, 0.07511145, 0.61338028, 0.18451051, 0.38246404,
            0.17161487, 0.72437621, 0.2649723 , 0.52931197, 0.05165881,
            0.28402858, 0.17020906, 0.39659258, 0.12214776, 0.40792206,
            0.14345212, 0.66615009],
           [0.33914732, 0.19254268, 0.61338028, 0.18451051, 0.36296385,
            0.17161487, 0.73679679, 0.16889135, 0.52931197, 0.14533567,
            0.23895021, 0.11373764, 0.31428712, 0.05634673, 0.3505198 ,
            0.12423584, 0.66615009],
           [0.37340526, 0.10187667, 0.65503946, 0.04951742, 0.46677751,
            0.19443441, 0.75962701, 0.2649723 , 0.40071483, 0.0243162 ,
            0.46151994, 0.17020906, 0.48177881, 0.12214776, 0.23614833,
            0.14345212, 0.72227636]])
    Coordinates:
      * epoch    (epoch) int64 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16
      * ch       (ch) &lt;U7 &#x27;EEG 003&#x27; &#x27;EEG 004&#x27; &#x27;EEG 005&#x27; ... &#x27;EEG 059&#x27; &#x27;EEG 060&#x27;</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>ch</span>: 58</li><li><span class='xr-has-index'>epoch</span>: 17</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-6bb0e279-86ab-42ee-ac0d-d1d7cc40a084' class='xr-array-in' type='checkbox' checked><label for='section-6bb0e279-86ab-42ee-ac0d-d1d7cc40a084' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>0.4387 0.1455 0.9215 0.2112 0.4095 ... 0.1221 0.2361 0.1435 0.7223</span></div><div class='xr-array-data'><pre>array([[0.43866056, 0.14553338, 0.92146594, 0.21124047, 0.4095126 ,
            0.15250306, 0.96321641, 0.75479821, 0.73969339, 0.18287992,
            0.30397015, 0.11793687, 0.4081516 , 0.07738212, 0.5064397 ,
            0.18777674, 0.94772735],
           [0.06156345, 0.13348796, 0.95716877, 0.27845968, 0.15554332,
            0.10134582, 0.98332016, 0.83355635, 0.90468205, 0.09308467,
            0.15375557, 0.06604402, 0.15377766, 0.21897691, 0.2608765 ,
            0.2656993 , 0.97505486],
           [0.12904976, 0.21496437, 0.95716877, 0.27845968, 0.10764917,
            0.1101966 , 0.98332016, 0.83355635, 0.90468205, 0.02169976,
            0.22092604, 0.08129005, 0.36628463, 0.21897691, 0.25693387,
            0.2656993 , 0.97505486],
           [0.43866056, 0.15203423, 0.95001732, 0.09339404, 0.4095126 ,
            0.15250306, 0.97559431, 0.84612402, 0.81397881, 0.14279805,
            0.40714657, 0.07360633, 0.4081516 , 0.04175781, 0.5064397 ,
            0.26556433, 0.95484653],
           [0.22456669, 0.15203423, 0.95001732, 0.28969062, 0.32569984,
            0.13601462, 0.97559431, 0.84612402, 0.84713855, 0.18287992,
            0.22435981, 0.10917912, 0.39854106, 0.07738212, 0.21392411,
            0.27847946, 0.95484653],
    ...
           [0.33914732, 0.21073026, 0.54843395, 0.12758548, 0.36296385,
            0.17868857, 0.76558666, 0.24868636, 0.39178594, 0.14533567,
            0.23895021, 0.11511981, 0.30195919, 0.10767846, 0.3505198 ,
            0.11174796, 0.63948113],
           [0.3168016 , 0.09290203, 0.5501744 , 0.13625256, 0.37443509,
            0.09976059, 0.72456344, 0.11712827, 0.37978025, 0.01499466,
            0.28967373, 0.16571638, 0.2685378 , 0.12452942, 0.40792206,
            0.12454686, 0.56835975],
           [0.31848436, 0.07511145, 0.61338028, 0.18451051, 0.38246404,
            0.17161487, 0.72437621, 0.2649723 , 0.52931197, 0.05165881,
            0.28402858, 0.17020906, 0.39659258, 0.12214776, 0.40792206,
            0.14345212, 0.66615009],
           [0.33914732, 0.19254268, 0.61338028, 0.18451051, 0.36296385,
            0.17161487, 0.73679679, 0.16889135, 0.52931197, 0.14533567,
            0.23895021, 0.11373764, 0.31428712, 0.05634673, 0.3505198 ,
            0.12423584, 0.66615009],
           [0.37340526, 0.10187667, 0.65503946, 0.04951742, 0.46677751,
            0.19443441, 0.75962701, 0.2649723 , 0.40071483, 0.0243162 ,
            0.46151994, 0.17020906, 0.48177881, 0.12214776, 0.23614833,
            0.14345212, 0.72227636]])</pre></div></div></li><li class='xr-section-item'><input id='section-e7e0e909-d2a6-4e39-822f-d72ffef1f506' class='xr-section-summary-in' type='checkbox'  checked><label for='section-e7e0e909-d2a6-4e39-822f-d72ffef1f506' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>epoch</span></div><div class='xr-var-dims'>(epoch)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5 6 ... 11 12 13 14 15 16</div><input id='attrs-ea415281-184a-489d-bea7-0ce7b275185c' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ea415281-184a-489d-bea7-0ce7b275185c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-46f4d1fc-aca4-4c29-94b9-6f3edf7857be' class='xr-var-data-in' type='checkbox'><label for='data-46f4d1fc-aca4-4c29-94b9-6f3edf7857be' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>ch</span></div><div class='xr-var-dims'>(ch)</div><div class='xr-var-dtype'>&lt;U7</div><div class='xr-var-preview xr-preview'>&#x27;EEG 003&#x27; &#x27;EEG 004&#x27; ... &#x27;EEG 060&#x27;</div><input id='attrs-a8063331-c2f8-48a7-8a2b-81d8329a634b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-a8063331-c2f8-48a7-8a2b-81d8329a634b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-21d22de3-171b-448d-a1e4-bd03acb9df93' class='xr-var-data-in' type='checkbox'><label for='data-21d22de3-171b-448d-a1e4-bd03acb9df93' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;EEG 003&#x27;, &#x27;EEG 004&#x27;, &#x27;EEG 005&#x27;, &#x27;EEG 006&#x27;, &#x27;EEG 007&#x27;, &#x27;EEG 008&#x27;,
           &#x27;EEG 009&#x27;, &#x27;EEG 010&#x27;, &#x27;EEG 011&#x27;, &#x27;EEG 012&#x27;, &#x27;EEG 013&#x27;, &#x27;EEG 014&#x27;,
           &#x27;EEG 015&#x27;, &#x27;EEG 016&#x27;, &#x27;EEG 017&#x27;, &#x27;EEG 018&#x27;, &#x27;EEG 019&#x27;, &#x27;EEG 020&#x27;,
           &#x27;EEG 021&#x27;, &#x27;EEG 022&#x27;, &#x27;EEG 023&#x27;, &#x27;EEG 024&#x27;, &#x27;EEG 025&#x27;, &#x27;EEG 026&#x27;,
           &#x27;EEG 027&#x27;, &#x27;EEG 028&#x27;, &#x27;EEG 029&#x27;, &#x27;EEG 030&#x27;, &#x27;EEG 031&#x27;, &#x27;EEG 032&#x27;,
           &#x27;EEG 033&#x27;, &#x27;EEG 034&#x27;, &#x27;EEG 035&#x27;, &#x27;EEG 036&#x27;, &#x27;EEG 037&#x27;, &#x27;EEG 038&#x27;,
           &#x27;EEG 039&#x27;, &#x27;EEG 040&#x27;, &#x27;EEG 041&#x27;, &#x27;EEG 042&#x27;, &#x27;EEG 043&#x27;, &#x27;EEG 044&#x27;,
           &#x27;EEG 045&#x27;, &#x27;EEG 046&#x27;, &#x27;EEG 047&#x27;, &#x27;EEG 048&#x27;, &#x27;EEG 049&#x27;, &#x27;EEG 050&#x27;,
           &#x27;EEG 051&#x27;, &#x27;EEG 052&#x27;, &#x27;EEG 053&#x27;, &#x27;EEG 054&#x27;, &#x27;EEG 055&#x27;, &#x27;EEG 056&#x27;,
           &#x27;EEG 057&#x27;, &#x27;EEG 058&#x27;, &#x27;EEG 059&#x27;, &#x27;EEG 060&#x27;], dtype=&#x27;&lt;U7&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-c7130320-7f22-4cc8-8b3a-8552598390e9' class='xr-section-summary-in' type='checkbox'  ><label for='section-c7130320-7f22-4cc8-8b3a-8552598390e9' class='xr-section-summary' >Indexes: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>epoch</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-142e8b1b-f2e0-434c-a96b-4fb910d48cd3' class='xr-index-data-in' type='checkbox'/><label for='index-142e8b1b-f2e0-434c-a96b-4fb910d48cd3' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16], dtype=&#x27;int64&#x27;, name=&#x27;epoch&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>ch</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-cd4b9294-b006-4850-9b71-52343d6a1966' class='xr-index-data-in' type='checkbox'/><label for='index-cd4b9294-b006-4850-9b71-52343d6a1966' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;EEG 003&#x27;, &#x27;EEG 004&#x27;, &#x27;EEG 005&#x27;, &#x27;EEG 006&#x27;, &#x27;EEG 007&#x27;, &#x27;EEG 008&#x27;,
           &#x27;EEG 009&#x27;, &#x27;EEG 010&#x27;, &#x27;EEG 011&#x27;, &#x27;EEG 012&#x27;, &#x27;EEG 013&#x27;, &#x27;EEG 014&#x27;,
           &#x27;EEG 015&#x27;, &#x27;EEG 016&#x27;, &#x27;EEG 017&#x27;, &#x27;EEG 018&#x27;, &#x27;EEG 019&#x27;, &#x27;EEG 020&#x27;,
           &#x27;EEG 021&#x27;, &#x27;EEG 022&#x27;, &#x27;EEG 023&#x27;, &#x27;EEG 024&#x27;, &#x27;EEG 025&#x27;, &#x27;EEG 026&#x27;,
           &#x27;EEG 027&#x27;, &#x27;EEG 028&#x27;, &#x27;EEG 029&#x27;, &#x27;EEG 030&#x27;, &#x27;EEG 031&#x27;, &#x27;EEG 032&#x27;,
           &#x27;EEG 033&#x27;, &#x27;EEG 034&#x27;, &#x27;EEG 035&#x27;, &#x27;EEG 036&#x27;, &#x27;EEG 037&#x27;, &#x27;EEG 038&#x27;,
           &#x27;EEG 039&#x27;, &#x27;EEG 040&#x27;, &#x27;EEG 041&#x27;, &#x27;EEG 042&#x27;, &#x27;EEG 043&#x27;, &#x27;EEG 044&#x27;,
           &#x27;EEG 045&#x27;, &#x27;EEG 046&#x27;, &#x27;EEG 047&#x27;, &#x27;EEG 048&#x27;, &#x27;EEG 049&#x27;, &#x27;EEG 050&#x27;,
           &#x27;EEG 051&#x27;, &#x27;EEG 052&#x27;, &#x27;EEG 053&#x27;, &#x27;EEG 054&#x27;, &#x27;EEG 055&#x27;, &#x27;EEG 056&#x27;,
           &#x27;EEG 057&#x27;, &#x27;EEG 058&#x27;, &#x27;EEG 059&#x27;, &#x27;EEG 060&#x27;],
          dtype=&#x27;object&#x27;, name=&#x27;ch&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-759adba7-d9ce-4108-8220-980f5714cd1a' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-759adba7-d9ce-4108-8220-980f5714cd1a' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 466-467

This matrix :math:`\mathrm{P}^{t,{\text{max}}^n}`  will be used in the steps below.

.. GENERATED FROM PYTHON SOURCE LINES 469-479

Flag Bridged Sensors
--------------------

.. figure:: https://raw.githubusercontent.com/scott-huberty/wip_pipeline-figures/main/Flag_bridged_sensors.png
   :align: center
   :alt: Flag Bridged Sensors graphic.

   Flag Bridged Sensors. The figure shows the steps for flagging bridged sensors.
   See the text below for descriptions of mathematical notation.


.. GENERATED FROM PYTHON SOURCE LINES 481-502

a) Calculate the 50th, 75th quantile and IQR across epochs
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. math::
   IQR^e = \mathrm{P}^{t,{\text{max}}^nQ75^e} - \mathrm{P}^{t,{\text{max}}^nQ25^e}

For each sensor, divide the median across epochs by the IQR across epochs. Bridged
channels should have a high median correlation but a low IQR of the correlation.
We call this measure the bridge-indicator.

.. math::
   \mathcal{B}_s = \frac{\mathrm{P}^{t,{\text{max}}^nQ50^e}}{IQR^e}

b) Define a bridging threshold
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Now, take the 25th, 50th, and 75th quantile of :math:`\mathcal{B}_s` across sensors,
And calculate the :math:`IQR^s`. A channel :math:`i` is bridged if

.. math::
   \mathcal{B}_i > B^{Q50^s} +k \times IQR^s


.. GENERATED FROM PYTHON SOURCE LINES 504-507

.. code-block:: default

    import scipy
    from functools import partial








.. GENERATED FROM PYTHON SOURCE LINES 508-529

.. code-block:: default

    msr = data_r_ch.median("epoch") / data_r_ch.reduce(scipy.stats.iqr, dim="epoch")
    # msr is a 1D vector of size n_sensors
    config_trim = 40
    config_bridge_z = 6
    #
    trim = config_trim
    if trim >= 1:
        trim /= 100
    trim /= 2  # .20 and will be used as (.20, .20)
    #
    trim_mean = partial(scipy.stats.mstats.trimmed_mean, limits=(trim, trim))
    trim_std = partial(scipy.stats.mstats.trimmed_std, limits=(trim, trim))
    #
    z_val = config_bridge_z  # 6
    mask = msr > msr.reduce(trim_mean, dim="ch") + z_val * msr.reduce(
        trim_std, dim="ch"
    )  # bridged chans
    #
    bridged_ch_names = data_r_ch.ch.values[mask]
    bridged_ch_names





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    array(['EEG 019', 'EEG 040', 'EEG 053', 'EEG 054'], dtype='<U7')



.. GENERATED FROM PYTHON SOURCE LINES 530-531

Let's add the outlier channels to our flags

.. GENERATED FROM PYTHON SOURCE LINES 531-535

.. code-block:: default

    bad_chs = bridged_ch_names
    pipeline.flags["ch"].add_flag_cat(kind="bridge", bad_ch_names=bad_chs)
    pipeline.flags["ch"]





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    Flagged channels: |
      Noisy: ['EEG 001' 'EEG 002']
      Bridged: ['EEG 019' 'EEG 040' 'EEG 053' 'EEG 054']
      Uncorrelated: None
      Rank: None




.. GENERATED FROM PYTHON SOURCE LINES 536-558

Identify the Rank Channel
-------------------------

Because the pipeline uses an average reference before the ICA decomposition, it is
necessary to account for rank deficiency (i.e., every sensor in the montage is
linearly dependent on the other channels due to the common average reference). To
account for this, the pipeline flags the sensor (out of the remaining good sensors)
with the highest median of the max correlation coefficient with its neighbors
(across epochs):

.. math::
   \begin{equation}
   i = \text{arg}\max\limits_i \rho_{i}^{t,{\text{max}}^n,median^j}
   \end{equation}

This sensor has the least unique time-series out of the remaining set of good sensors
:math:`S_\mathcal{G}` and is flagged by the pipeline as ``‚Äùrank‚Äù``. Note that this
sensor is not flagged because it contains artifact, but only because one of the
remaining sensors needs to be removed to address rank deficiency before ICA
decomposition is performed. By choosing this sensor, we are likely to lose little
information because of its high correlation with its neighbors. This sensor can be
reintroduced after the ICA has been applied for artifact corrections.

.. GENERATED FROM PYTHON SOURCE LINES 560-569

.. code-block:: default

    good_chs = [
        ch for ch in data_r_ch.ch.values if ch not in pipeline.flags["ch"].get_flagged()
    ]
    data_r_ch_good = data_r_ch.sel(ch=good_chs)

    flag_ch = [str(data_r_ch_good.median("epoch").idxmax(dim="ch").to_numpy())]
    pipeline.flags["ch"].add_flag_cat(kind="rank", bad_ch_names=flag_ch)
    pipeline.flags["ch"]





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    Flagged channels: |
      Noisy: ['EEG 001' 'EEG 002']
      Bridged: ['EEG 019' 'EEG 040' 'EEG 053' 'EEG 054']
      Uncorrelated: None
      Rank: ['EEG 003']




.. GENERATED FROM PYTHON SOURCE LINES 570-605

Flag low correlation Epochs
---------------------------

This step is designed to identify time periods in which many sensors are
uncorrelated with neighboring sensors. It is similar to the :ref:`noisy_sensors` step,

Again we calculate the 25th and 50th quantile
of :math:`\mathrm{P}^{t,{\text{max}}^n}`, across the epochs dimension, and calculate
the lower quantile range :math:`LQR^s`. This results in vectors
:math:`\mathrm{P}^{t,{\text{max}}^nQ25^e}` and
:math:`\mathrm{P}^{t,{\text{max}}^nQ50^e}` of size :math:`S_\mathcal{G}`. As for previous
steps, we define  sensor-specific thresholds for flagging epochs:

.. math::
   \begin{equation}
   \tau^e = \mathrm{P}^{t,{\text{max}}^nQ50^e} - LQR^e\times k
   \end{equation}

And the corresponding indicator matrix:

.. math::
   \begin{equation}
   c_{ij} =
   \begin{cases}
   1 & \text{if } \rho^{t,{\text{max}}^n}_{ij} < \tau^e_i \\
   0 & \text{if } \rho^{t,{\text{max}}^n}_{ij} \geq \tau^e_i
   \end{cases}
   \end{equation}

We average the indicator matrix across sensors and obtain a vector :math:`C^{\mu_s}`
that we use to flag uncorrelated epochs using the following criterion:

.. math::
   c^{\mu_e}_i > \tau^{p}.


.. GENERATED FROM PYTHON SOURCE LINES 607-608

Step a

.. GENERATED FROM PYTHON SOURCE LINES 608-630

.. code-block:: default

    q25, q50 = data_r_ch.quantile([0.25, 0.5], dim="epoch")
    #
    # Define the LQR
    lqr = q50 - q25
    #
    # define a threshold
    k = 3
    lower_threshold = q50 - lqr * k
    #
    outlier_mask = data_r_ch < lower_threshold
    #
    percent_outliers = outlier_mask.astype(float).mean("ch")
    #
    p_threshold = 0.2
    bad_epochs = percent_outliers[percent_outliers > p_threshold].coords.to_index().values
    #
    # Add the outlier epochs to our flags
    pipeline.flags["epoch"].add_flag_cat(
        kind="uncorrelated", bad_epoch_inds=bad_epochs, epochs=epochs
    )
    pipeline.raw.annotations.description





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    array(['bad_pylossless_ch_sd'], dtype='<U20')



.. GENERATED FROM PYTHON SOURCE LINES 631-633

in this case, no epochs were flagged as uncorrelated.


.. GENERATED FROM PYTHON SOURCE LINES 635-650

Flag low correlation Sensors
-----------------------------

.. figure:: https://raw.githubusercontent.com/scott-huberty/wip_pipeline-figures/main/Flag_uncorrelated_sensors.png
   :align: center
   :alt: Flag Uncorrelated Sensors graphic.

   Flag Uncorrelated Sensors. The figure shows the steps for flagging uncorrelated
   sensors. See the text below for descriptions of mathematical notation.

This step is designed to identify sensors that have an unusually low correlation with
neighboring sensors. The operations involved by this step are similar to those of the
:ref:`noisy_sensors` step, except we use maximal nearest neighbor correlations instead
of dispersion and the left instead of the right tail of the distribution to set
the threshold for outliers.

.. GENERATED FROM PYTHON SOURCE LINES 652-668

a) Take lower quantile range and defined sensor-specific thresholds
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

We get the indicator matrix as described previously, using

.. math::
   \tau^e_i = \mathrm{P}^{t,{\text{max}}^nQ50^e} - LQR^e\times k

and

.. math::
   c_{ij} =
   \begin{cases}
   1 & \text{if } \rho^{t,{\text{max}}^n}_{ij} < \tau^e_i \\
   0 & \text{if } \rho^{t,{\text{max}}^n}_{ij} \geq \tau^e_i
   \end{cases}

.. GENERATED FROM PYTHON SOURCE LINES 670-675

b) Identify uncorrelated sensors
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

We define a threshold as we did in the previous step and flag uncorrelated epochs
:math:`j` if :math:`c^{\mu_s}_j > \tau^{p}`.

.. GENERATED FROM PYTHON SOURCE LINES 677-697

.. code-block:: default

    q25, q50 = data_r_ch.quantile([0.25, 0.5], dim="ch")
    #
    # Define LQR
    lqr = q50 - q25
    #
    # define a threshold
    k = 3
    lower_threshold = q50 - lqr * k
    #
    # Identify correlations less than the threshold
    outlier_mask = data_r_ch < lower_threshold
    percent_outliers = outlier_mask.astype(float).mean("epoch")
    #
    p_threshold = 0.2
    bad_chs = percent_outliers[percent_outliers > p_threshold].coords.to_index().values
    #
    # Add the outlier channels to our flags
    pipeline.flags["ch"].add_flag_cat(kind="uncorrelated", bad_ch_names=bad_chs)
    pipeline.flags["ch"]





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    Flagged channels: |
      Noisy: ['EEG 001' 'EEG 002']
      Bridged: ['EEG 019' 'EEG 040' 'EEG 053' 'EEG 054']
      Uncorrelated: None
      Rank: ['EEG 003']




.. GENERATED FROM PYTHON SOURCE LINES 698-699

In this case, no sensors were flagged as uncorrelated.

.. GENERATED FROM PYTHON SOURCE LINES 701-707

Run Initial ICA
---------------

The pipeline by runs ICA two times. The first ICA is only used to identify
noisy periods in its IC activation time-series. For this reason, the pipeline
uses the FastICA algorithm for speed.

.. GENERATED FROM PYTHON SOURCE LINES 709-711

.. code-block:: default

    pipeline.run_ica("run1")





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    LOSSLESS: üö© run_ica.
    üßπ Epoching..
    Not setting metadata
    19 matching events found
    No baseline correction applied
    0 projection items activated
    Using data from preloaded Raw for 19 events and 601 original time points ...
    2 bad epochs dropped
    üîç Detecting channels to leave out of reference.
    EEG channel type selected for re-referencing
    Applying a custom ('EEG',) reference.
    Fitting ICA to data using 53 channels (please be patient, this may take a while)
    Selecting by non-zero PCA components: 52 components
    /Users/shuberty/github_repos/my_envs/pylossless/lib/python3.11/site-packages/sklearn/decomposition/_fastica.py:123: ConvergenceWarning: FastICA did not converge. Consider increasing tolerance or the maximum number of iterations.
      warnings.warn(
    Fitting ICA took 29.6s.
    LOSSLESS: üèÅ Finished run_ica after 29.66 seconds.




.. GENERATED FROM PYTHON SOURCE LINES 712-721

Flag Noisy IC Activation time-periods
-------------------------------------

This step follows the same procedure as the :ref:`noisy_sensors` step, except that
the data is now the IC activation time-series. thus we start with a 3D matrix
:math:`X_{ica} \in \mathbb{R}^{I_\mathcal{G} \times E_\mathcal{G} \times T}` of
IC time-courses rather than scalp EEG data and where :math:`I` is the set of
independent components.


.. GENERATED FROM PYTHON SOURCE LINES 723-725

.. code-block:: default

    pipeline.flag_epoch_ic_sd1()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    LOSSLESS: üö© flag_epoch_ic_sd1.
    üßπ Epoching..
    Not setting metadata
    19 matching events found
    No baseline correction applied
    0 projection items activated
    Using data from preloaded Raw for 19 events and 601 original time points ...
    2 bad epochs dropped
    üîç Detecting channels to leave out of reference.
    EEG channel type selected for re-referencing
    Applying a custom ('EEG',) reference.
    LOSSLESS: üèÅ Finished flag_epoch_ic_sd1 after 0.22 seconds.




.. GENERATED FROM PYTHON SOURCE LINES 726-728

.. code-block:: default

    pipeline.raw.annotations.description





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    array(['bad_pylossless_ch_sd'], dtype='<U20')



.. GENERATED FROM PYTHON SOURCE LINES 729-736

Run Final ICA
-------------

Now The pipeline runs the final ICA decomposition, this time using the extended
Infomax algorithm. Note that any sensors or time-periods that have been flagged
up to this point will not be passed into the ICA decomposition. For the sake of
time, we will not run the second ICA here, as there are no more pipeline calculations.

.. GENERATED FROM PYTHON SOURCE LINES 738-751

Run ICLabel Classifier
----------------------

The pipeline will run the ICLabel classifier on the final ICA, which will produce a
label for each IC, one of ``"brain"``, ``"muscle"``, ``"eog"`` (eye), ``"ecg"``
(heart), ``line_noise``, or ``"channel_noise"``.


Conclusion
----------
And that's all! See the other pylossless tutorials for brief examples on running the
pipeline on your own data, and rejecting the flagged data.



.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  37.282 seconds)


.. _sphx_glr_download_auto_examples_plot_0_implementation.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example




    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_0_implementation.py <plot_0_implementation.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_0_implementation.ipynb <plot_0_implementation.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
